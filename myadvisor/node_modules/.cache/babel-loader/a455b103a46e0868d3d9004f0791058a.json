{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = useParseAdaptiveCardJSON;\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _botframeworkWebchatComponent = require(\"botframework-webchat-component\");\n\nvar _react = require(\"react\");\n\nvar _useAdaptiveCardsPackage = _interopRequireDefault(require(\"../useAdaptiveCardsPackage\"));\n\nvar useDirection = _botframeworkWebchatComponent.hooks.useDirection,\n    useStyleOptions = _botframeworkWebchatComponent.hooks.useStyleOptions;\n\nfunction updateRTLInline(element, rtl, adaptiveCardsPackage) {\n  if (element instanceof adaptiveCardsPackage.Container) {\n    element.rtl = rtl;\n  } // Tree traversal to add rtl boolean to child elements\n\n\n  if (element.getItemAt && element.getItemCount) {\n    var count = element.getItemCount();\n\n    for (var index = 0; index < count; index++) {\n      var child = element.getItemAt(index);\n      updateRTLInline(child, rtl, adaptiveCardsPackage);\n    }\n  }\n}\n\nfunction useParseAdaptiveCardJSON() {\n  var _useAdaptiveCardsPack = (0, _useAdaptiveCardsPackage.default)(),\n      _useAdaptiveCardsPack2 = (0, _slicedToArray2.default)(_useAdaptiveCardsPack, 1),\n      adaptiveCardsPackage = _useAdaptiveCardsPack2[0];\n\n  var _useDirection = useDirection(),\n      _useDirection2 = (0, _slicedToArray2.default)(_useDirection, 1),\n      direction = _useDirection2[0];\n\n  var _useStyleOptions = useStyleOptions(),\n      _useStyleOptions2 = (0, _slicedToArray2.default)(_useStyleOptions, 1),\n      adaptiveCardsParserMaxVersion = _useStyleOptions2[0].adaptiveCardsParserMaxVersion;\n\n  var AdaptiveCard = adaptiveCardsPackage.AdaptiveCard,\n      SerializationContext = adaptiveCardsPackage.SerializationContext,\n      Version = adaptiveCardsPackage.Version;\n  var maxVersion = (0, _react.useMemo)(function () {\n    var maxVersion = Version.parse(adaptiveCardsParserMaxVersion, new SerializationContext());\n\n    if (maxVersion && !maxVersion.isValid) {\n      return console.warn('botframework-webchat: \"adaptiveCardsParserMaxVersion\" specified is not a valid version.');\n    }\n\n    return maxVersion;\n  }, [adaptiveCardsParserMaxVersion, SerializationContext, Version]);\n  return (0, _react.useCallback)(function (content) {\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n        _ref$ignoreErrors = _ref.ignoreErrors,\n        ignoreErrors = _ref$ignoreErrors === void 0 ? false : _ref$ignoreErrors;\n\n    if (!content) {\n      return;\n    }\n\n    var card = new AdaptiveCard();\n    var errors = [];\n    var serializationContext = new SerializationContext(maxVersion);\n    card.parse(content, serializationContext);\n    var eventCount = serializationContext.eventCount;\n\n    for (var i = 0; i < eventCount; i++) {\n      errors.push(serializationContext.getEventAt(i));\n    }\n\n    if (!ignoreErrors && errors.length) {\n      console.error('botframework-webchat: Failed to parse Adaptive Card', {\n        errors: errors\n      });\n      throw new Error('botframework-webchat: Failed to parse Adaptive Card');\n    }\n\n    updateRTLInline(card, direction === 'rtl', adaptiveCardsPackage);\n    return card;\n  }, [AdaptiveCard, adaptiveCardsPackage, direction, maxVersion, SerializationContext]);\n}","map":{"version":3,"sources":["../../../../src/adaptiveCards/hooks/internal/useParseAdaptiveCardJSON.js"],"names":["useDirection","useStyleOptions","hooks","element","adaptiveCardsPackage","count","index","child","updateRTLInline","direction","adaptiveCardsParserMaxVersion","AdaptiveCard","SerializationContext","Version","maxVersion","console","ignoreErrors","card","errors","serializationContext","eventCount","i"],"mappings":";;;;;;;;;;;AAAA,IAAA,6BAAA,GAAA,OAAA,CAAA,gCAAA,CAAA;;AACA,IAAA,MAAA,GAAA,OAAA,CAAA,OAAA,CAAA;;AAEA,IAAA,wBAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,4BAAA,CAAA,CAAA;;IAEQA,Y,GAAkCE,6BAAAA,CAAAA,KAAAA,CAAlCF,Y;IAAcC,e,GAAoBC,6BAAAA,CAAAA,KAAAA,CAApBD,e;;AAEtB,SAAA,eAAA,CAAA,OAAA,EAAA,GAAA,EAAA,oBAAA,EAA6D;AAC3D,MAAIE,OAAO,YAAYC,oBAAoB,CAA3C,SAAA,EAAuD;AACrDD,IAAAA,OAAO,CAAPA,GAAAA,GAAAA,GAAAA;AAFyD,GAAA,CAK3D;;;AACA,MAAIA,OAAO,CAAPA,SAAAA,IAAqBA,OAAO,CAAhC,YAAA,EAA+C;AAC7C,QAAME,KAAK,GAAGF,OAAO,CAArB,YAAcA,EAAd;;AAEA,SAAK,IAAIG,KAAK,GAAd,CAAA,EAAoBA,KAAK,GAAzB,KAAA,EAAmCA,KAAnC,EAAA,EAA4C;AAC1C,UAAMC,KAAK,GAAGJ,OAAO,CAAPA,SAAAA,CAAd,KAAcA,CAAd;AAEAK,MAAAA,eAAe,CAAA,KAAA,EAAA,GAAA,EAAfA,oBAAe,CAAfA;AACD;AACF;AACF;;AAEc,SAAA,wBAAA,GAAoC;AAAA,MAAA,qBAAA,GAClB,CAAA,GAAA,wBAAA,CADkB,OAClB,GADkB;AAAA,MAAA,sBAAA,GAAA,CAAA,GAAA,eAAA,CAAA,OAAA,EAAA,qBAAA,EAAA,CAAA,CAAA;AAAA,MAC1CJ,oBAD0C,GAAA,sBAAA,CAAA,CAAA,CAAA;;AAAA,MAAA,aAAA,GAE7BJ,YAF6B,EAAA;AAAA,MAAA,cAAA,GAAA,CAAA,GAAA,eAAA,CAAA,OAAA,EAAA,aAAA,EAAA,CAAA,CAAA;AAAA,MAE1CS,SAF0C,GAAA,cAAA,CAAA,CAAA,CAAA;;AAAA,MAAA,gBAAA,GAGLR,eAHK,EAAA;AAAA,MAAA,iBAAA,GAAA,CAAA,GAAA,eAAA,CAAA,OAAA,EAAA,gBAAA,EAAA,CAAA,CAAA;AAAA,MAGxCS,6BAHwC,GAAA,iBAAA,CAAA,CAAA,CAAA,CAAA,6BAAA;;AAAA,MAKzCC,YALyC,GAKOP,oBALP,CAAA,YAAA;AAAA,MAK3BQ,oBAL2B,GAKOR,oBALP,CAAA,oBAAA;AAAA,MAKLS,OALK,GAKOT,oBALP,CAAA,OAAA;AAOjD,MAAMU,UAAU,GAAG,CAAA,GAAA,MAAA,CAAA,OAAA,EAAQ,YAAM;AAC/B,QAAMA,UAAU,GAAGD,OAAO,CAAPA,KAAAA,CAAAA,6BAAAA,EAA6C,IAAhE,oBAAgE,EAA7CA,CAAnB;;AAEA,QAAIC,UAAU,IAAI,CAACA,UAAU,CAA7B,OAAA,EAAuC;AACrC,aAAOC,OAAO,CAAPA,IAAAA,CAAP,yFAAOA,CAAP;AACD;;AAED,WAAA,UAAA;AAPiB,GAAA,EAQhB,CAAA,6BAAA,EAAA,oBAAA,EARH,OAQG,CARgB,CAAnB;AAUA,SAAO,CAAA,GAAA,MAAA,CAAA,WAAA,EACL,UAAA,OAAA,EAA4C;AAAA,QAAA,IAAA,GAAA,SAAA,CAAA,MAAA,GAAA,CAAA,IAAA,SAAA,CAAA,CAAA,CAAA,KAAA,SAAA,GAAA,SAAA,CAAA,CAAA,CAAA,GAAP,EAAO;AAAA,QAAA,iBAAA,GAAA,IAAA,CAAhCC,YAAgC;AAAA,QAAhCA,YAAgC,GAAA,iBAAA,KAAA,KAAA,CAAA,GAAjB,KAAiB,GAAA,iBAAA;;AAC1C,QAAI,CAAJ,OAAA,EAAc;AACZ;AACD;;AAED,QAAMC,IAAI,GAAG,IAAb,YAAa,EAAb;AACA,QAAMC,MAAM,GAAZ,EAAA;AACA,QAAMC,oBAAoB,GAAG,IAAA,oBAAA,CAA7B,UAA6B,CAA7B;AAEAF,IAAAA,IAAI,CAAJA,KAAAA,CAAAA,OAAAA,EAAAA,oBAAAA;AAT0C,QAWlCG,UAXkC,GAWnBD,oBAXmB,CAAA,UAAA;;AAa1C,SAAK,IAAIE,CAAC,GAAV,CAAA,EAAgBA,CAAC,GAAjB,UAAA,EAAgCA,CAAhC,EAAA,EAAqC;AACnCH,MAAAA,MAAM,CAANA,IAAAA,CAAYC,oBAAoB,CAApBA,UAAAA,CAAZD,CAAYC,CAAZD;AACD;;AAED,QAAI,CAAA,YAAA,IAAiBA,MAAM,CAA3B,MAAA,EAAoC;AAClCH,MAAAA,OAAO,CAAPA,KAAAA,CAAAA,qDAAAA,EAAqE;AAAEG,QAAAA,MAAM,EAANA;AAAF,OAArEH;AAEA,YAAM,IAAA,KAAA,CAAN,qDAAM,CAAN;AACD;;AAEDP,IAAAA,eAAe,CAAA,IAAA,EAAOC,SAAS,KAAhB,KAAA,EAAfD,oBAAe,CAAfA;AAEA,WAAA,IAAA;AA1BG,GAAA,EA4BL,CAAA,YAAA,EAAA,oBAAA,EAAA,SAAA,EAAA,UAAA,EA5BF,oBA4BE,CA5BK,CAAP;AA8BD","sourcesContent":["import { hooks } from 'botframework-webchat-component';\nimport { useCallback, useMemo } from 'react';\n\nimport useAdaptiveCardsPackage from '../useAdaptiveCardsPackage';\n\nconst { useDirection, useStyleOptions } = hooks;\n\nfunction updateRTLInline(element, rtl, adaptiveCardsPackage) {\n  if (element instanceof adaptiveCardsPackage.Container) {\n    element.rtl = rtl;\n  }\n\n  // Tree traversal to add rtl boolean to child elements\n  if (element.getItemAt && element.getItemCount) {\n    const count = element.getItemCount();\n\n    for (let index = 0; index < count; index++) {\n      const child = element.getItemAt(index);\n\n      updateRTLInline(child, rtl, adaptiveCardsPackage);\n    }\n  }\n}\n\nexport default function useParseAdaptiveCardJSON() {\n  const [adaptiveCardsPackage] = useAdaptiveCardsPackage();\n  const [direction] = useDirection();\n  const [{ adaptiveCardsParserMaxVersion }] = useStyleOptions();\n\n  const { AdaptiveCard, SerializationContext, Version } = adaptiveCardsPackage;\n\n  const maxVersion = useMemo(() => {\n    const maxVersion = Version.parse(adaptiveCardsParserMaxVersion, new SerializationContext());\n\n    if (maxVersion && !maxVersion.isValid) {\n      return console.warn('botframework-webchat: \"adaptiveCardsParserMaxVersion\" specified is not a valid version.');\n    }\n\n    return maxVersion;\n  }, [adaptiveCardsParserMaxVersion, SerializationContext, Version]);\n\n  return useCallback(\n    (content, { ignoreErrors = false } = {}) => {\n      if (!content) {\n        return;\n      }\n\n      const card = new AdaptiveCard();\n      const errors = [];\n      const serializationContext = new SerializationContext(maxVersion);\n\n      card.parse(content, serializationContext);\n\n      const { eventCount } = serializationContext;\n\n      for (let i = 0; i < eventCount; i++) {\n        errors.push(serializationContext.getEventAt(i));\n      }\n\n      if (!ignoreErrors && errors.length) {\n        console.error('botframework-webchat: Failed to parse Adaptive Card', { errors });\n\n        throw new Error('botframework-webchat: Failed to parse Adaptive Card');\n      }\n\n      updateRTLInline(card, direction === 'rtl', adaptiveCardsPackage);\n\n      return card;\n    },\n    [AdaptiveCard, adaptiveCardsPackage, direction, maxVersion, SerializationContext]\n  );\n}\n"],"sourceRoot":"bundle:///"},"metadata":{},"sourceType":"script"}