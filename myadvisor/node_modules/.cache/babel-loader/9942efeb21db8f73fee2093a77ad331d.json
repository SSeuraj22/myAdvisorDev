{"ast":null,"code":"\"use strict\"; // Copyright (c) Microsoft Corporation. All rights reserved.\n// Licensed under the MIT license.\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PromiseToEmptyCallback = exports.request = exports.extractHeaderValue = void 0;\n\nvar RestConfigBase_1 = require(\"../../common.browser/RestConfigBase\"); // Node.JS specific xmlhttprequest / browser support.\n\n\nvar XHR = __importStar(require(\"xmlhttprequest-ts\"));\n/**\n * Config settings for Conversation Translator\n */\n\n/**\n * Helpers for sending / receiving HTTPS requests / responses.\n * @param params\n */\n\n\nfunction queryParams(params) {\n  if (params === void 0) {\n    params = {};\n  }\n\n  return Object.keys(params).map(function (k) {\n    return encodeURIComponent(k) + \"=\" + encodeURIComponent(params[k]);\n  }).join(\"&\");\n}\n\nfunction withQuery(url, params) {\n  if (params === void 0) {\n    params = {};\n  }\n\n  var queryString = queryParams(params);\n  return queryString ? url + (url.indexOf(\"?\") === -1 ? \"?\" : \"&\") + queryString : url;\n}\n\nfunction parseXHRResult(xhr) {\n  return {\n    data: xhr.responseText,\n    headers: xhr.getAllResponseHeaders(),\n    json: function () {\n      return JSON.parse(xhr.responseText);\n    },\n    ok: xhr.status >= 200 && xhr.status < 300,\n    status: xhr.status,\n    statusText: xhr.statusText\n  };\n}\n\nfunction errorResponse(xhr, message) {\n  if (message === void 0) {\n    message = null;\n  }\n\n  return {\n    data: message || xhr.statusText,\n    headers: xhr.getAllResponseHeaders(),\n    json: function () {\n      return JSON.parse(message || \"\\\"\" + xhr.statusText + \"\\\"\");\n    },\n    ok: false,\n    status: xhr.status,\n    statusText: xhr.statusText\n  };\n}\n\nfunction extractHeaderValue(headerKey, headers) {\n  var headerValue = \"\";\n\n  try {\n    var arr = headers.trim().split(/[\\r\\n]+/);\n    var headerMap_1 = {};\n    arr.forEach(function (line) {\n      var parts = line.split(\": \");\n      var header = parts.shift().toLowerCase();\n      var value = parts.join(\": \");\n      headerMap_1[header] = value;\n    });\n    headerValue = headerMap_1[headerKey.toLowerCase()];\n  } catch (e) {// ignore the error\n  }\n\n  return headerValue;\n}\n\nexports.extractHeaderValue = extractHeaderValue;\n\nfunction request(method, url, queryParams, body, options, callback) {\n  if (queryParams === void 0) {\n    queryParams = {};\n  }\n\n  if (body === void 0) {\n    body = null;\n  }\n\n  if (options === void 0) {\n    options = {};\n  }\n\n  var defaultRequestOptions = RestConfigBase_1.RestConfigBase.requestOptions;\n  var ignoreCache = options.ignoreCache || defaultRequestOptions.ignoreCache;\n  var headers = options.headers || defaultRequestOptions.headers;\n  var timeout = options.timeout || defaultRequestOptions.timeout;\n  var xhr;\n\n  if (typeof window === \"undefined\") {\n    // Node\n    xhr = new XHR.XMLHttpRequest();\n  } else {\n    xhr = new XMLHttpRequest();\n  }\n\n  xhr.open(method, withQuery(url, queryParams), true);\n\n  if (headers) {\n    Object.keys(headers).forEach(function (key) {\n      return xhr.setRequestHeader(key, headers[key]);\n    });\n  }\n\n  if (ignoreCache) {\n    xhr.setRequestHeader(\"Cache-Control\", \"no-cache\");\n  }\n\n  xhr.timeout = timeout;\n\n  xhr.onload = function (evt) {\n    callback(parseXHRResult(xhr));\n  };\n\n  xhr.onerror = function (evt) {\n    callback(errorResponse(xhr, \"Failed to make request.\"));\n  };\n\n  xhr.ontimeout = function (evt) {\n    callback(errorResponse(xhr, \"Request took longer than expected.\"));\n  };\n\n  if (method === \"post\" && body) {\n    xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n    xhr.send(JSON.stringify(body));\n  } else {\n    xhr.send();\n  }\n}\n\nexports.request = request;\n\nfunction PromiseToEmptyCallback(promise, cb, err) {\n  if (!!promise) {\n    promise.then(function (result) {\n      try {\n        if (!!cb) {\n          cb();\n        }\n      } catch (e) {\n        if (!!err) {\n          err(\"'Unhandled error on promise callback: \" + e + \"'\");\n        }\n      }\n    }, function (reason) {\n      try {\n        if (!!err) {\n          err(reason);\n        }\n        /* tslint:disable:no-empty */\n\n      } catch (error) {}\n    });\n  } else {\n    if (!!err) {\n      err(\"Null promise\");\n    }\n  }\n}\n\nexports.PromiseToEmptyCallback = PromiseToEmptyCallback;","map":{"version":3,"sources":["src/common.speech/Transcription/ConversationUtils.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { IResponse } from \"./ConversationTranslatorInterfaces\";\r\n\r\nimport { IRequestOptions, RestConfigBase } from \"../../common.browser/RestConfigBase\";\r\nimport { Callback } from \"../../sdk/Transcription/IConversation\";\r\n\r\n// Node.JS specific xmlhttprequest / browser support.\r\nimport * as XHR from \"xmlhttprequest-ts\";\r\n\r\n/**\r\n * Config settings for Conversation Translator\r\n */\r\n/**\r\n * Helpers for sending / receiving HTTPS requests / responses.\r\n * @param params\r\n */\r\nfunction queryParams(params: any = {}): any {\r\n    return Object.keys(params)\r\n        .map((k: any) => encodeURIComponent(k) + \"=\" + encodeURIComponent(params[k]))\r\n        .join(\"&\");\r\n}\r\n\r\nfunction withQuery(url: string, params: any = {}): any {\r\n    const queryString = queryParams(params);\r\n    return queryString ? url + (url.indexOf(\"?\") === -1 ? \"?\" : \"&\") + queryString : url;\r\n}\r\n\r\nfunction parseXHRResult(xhr: XMLHttpRequest | XHR.XMLHttpRequest): IResponse {\r\n    return {\r\n        data: xhr.responseText,\r\n        headers: xhr.getAllResponseHeaders(),\r\n        json: <T>() => JSON.parse(xhr.responseText) as T,\r\n        ok: xhr.status >= 200 && xhr.status < 300,\r\n        status: xhr.status,\r\n        statusText: xhr.statusText,\r\n    };\r\n}\r\n\r\nfunction errorResponse(xhr: XMLHttpRequest | XHR.XMLHttpRequest, message: string | null = null): IResponse {\r\n    return {\r\n        data: message || xhr.statusText,\r\n        headers: xhr.getAllResponseHeaders(),\r\n        json: <T>() => JSON.parse(message || (\"\\\"\" + xhr.statusText + \"\\\"\")) as T,\r\n        ok: false,\r\n        status: xhr.status,\r\n        statusText: xhr.statusText,\r\n    };\r\n}\r\n\r\nexport function extractHeaderValue(headerKey: string, headers: string): string {\r\n\r\n    let headerValue: string = \"\";\r\n\r\n    try {\r\n        const arr = headers.trim().split(/[\\r\\n]+/);\r\n        const headerMap: any = {};\r\n        arr.forEach((line: any) => {\r\n            const parts = line.split(\": \");\r\n            const header = parts.shift().toLowerCase();\r\n            const value = parts.join(\": \");\r\n            headerMap[header] = value;\r\n        });\r\n\r\n        headerValue = headerMap[headerKey.toLowerCase()];\r\n    } catch (e) {\r\n        // ignore the error\r\n    }\r\n\r\n    return headerValue;\r\n}\r\n\r\nexport function request(\r\n    method: \"get\" | \"post\" | \"delete\",\r\n    url: string,\r\n    queryParams: any = {},\r\n    body: any = null,\r\n    options: IRequestOptions = {},\r\n    callback: any): any {\r\n\r\n    const defaultRequestOptions = RestConfigBase.requestOptions;\r\n\r\n    const ignoreCache = options.ignoreCache || defaultRequestOptions.ignoreCache;\r\n    const headers = options.headers || defaultRequestOptions.headers;\r\n    const timeout = options.timeout || defaultRequestOptions.timeout;\r\n\r\n    let xhr: XMLHttpRequest | XHR.XMLHttpRequest;\r\n    if (typeof window === \"undefined\") { // Node\r\n        xhr = new XHR.XMLHttpRequest();\r\n\r\n    } else {\r\n        xhr = new XMLHttpRequest();\r\n    }\r\n    xhr.open(method, withQuery(url, queryParams), true);\r\n\r\n    if (headers) {\r\n        Object.keys(headers).forEach((key: any) => xhr.setRequestHeader(key, headers[key]));\r\n    }\r\n\r\n    if (ignoreCache) {\r\n        xhr.setRequestHeader(\"Cache-Control\", \"no-cache\");\r\n    }\r\n\r\n    xhr.timeout = timeout;\r\n\r\n    xhr.onload = (evt: any) => {\r\n        callback(parseXHRResult(xhr));\r\n    };\r\n\r\n    xhr.onerror = (evt: any) => {\r\n        callback(errorResponse(xhr, \"Failed to make request.\"));\r\n    };\r\n\r\n    xhr.ontimeout = (evt: any) => {\r\n        callback(errorResponse(xhr, \"Request took longer than expected.\"));\r\n    };\r\n\r\n    if (method === \"post\" && body) {\r\n        xhr.setRequestHeader(\"Content-Type\", \"application/json\");\r\n        xhr.send(JSON.stringify(body));\r\n    } else {\r\n        xhr.send();\r\n    }\r\n}\r\n\r\nexport function PromiseToEmptyCallback<T>(promise: Promise<T>, cb?: Callback, err?: Callback): void {\r\n    if (!!promise) {\r\n        promise.then((result: T): void => {\r\n            try {\r\n                if (!!cb) {\r\n                    cb();\r\n                }\r\n            } catch (e) {\r\n                if (!!err) {\r\n                    err(`'Unhandled error on promise callback: ${e}'`);\r\n                }\r\n            }\r\n        }, (reason: any) => {\r\n            try {\r\n                if (!!err) {\r\n                    err(reason);\r\n                }\r\n                /* tslint:disable:no-empty */\r\n            } catch (error) {\r\n            }\r\n        });\r\n    } else {\r\n        if (!!err) {\r\n            err(\"Null promise\");\r\n        }\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"script"}