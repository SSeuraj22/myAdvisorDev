{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = render;\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _markdownItForInline = _interopRequireDefault(require(\"markdown-it-for-inline\"));\n\nvar _markdownIt = _interopRequireDefault(require(\"markdown-it\"));\n\nvar _markdownItAttrsEs = _interopRequireDefault(require(\"markdown-it-attrs-es5\"));\n\nvar _sanitizeHtml = _interopRequireDefault(require(\"sanitize-html\"));\n/* eslint no-magic-numbers: [\"error\", { \"ignore\": [0, 1, 2] }] */\n\n\nvar SANITIZE_HTML_OPTIONS = {\n  allowedAttributes: {\n    a: ['aria-label', 'href', 'name', 'rel', 'target', 'title'],\n    img: ['alt', 'class', 'src']\n  },\n  allowedSchemes: ['data', 'http', 'https', 'ftp', 'mailto', 'sip', 'tel'],\n  allowedTags: ['a', 'b', 'blockquote', 'br', 'caption', 'code', 'del', 'div', 'em', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'hr', 'i', 'img', 'ins', 'li', 'nl', 'ol', 'p', 'pre', 's', 'span', 'strike', 'strong', 'table', 'tbody', 'td', 'tfoot', 'th', 'thead', 'tr', 'ul']\n}; // Put a transparent pixel instead of the \"open in new window\" icon, so developers can easily modify the icon in CSS.\n\nvar TRANSPARENT_GIF = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'; // This is used for parsing Markdown for external links.\n\nvar internalMarkdownIt = new _markdownIt.default();\n\nfunction render(markdown, _ref) {\n  var markdownRespectCRLF = _ref.markdownRespectCRLF;\n\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref2$externalLinkAlt = _ref2.externalLinkAlt,\n      externalLinkAlt = _ref2$externalLinkAlt === void 0 ? '' : _ref2$externalLinkAlt;\n\n  if (markdownRespectCRLF) {\n    markdown = markdown.replace(/\\n\\r|\\r\\n/g, function (carriageReturn) {\n      return carriageReturn === '\\n\\r' ? '\\r\\n' : '\\n\\r';\n    });\n  }\n\n  var html = new _markdownIt.default({\n    breaks: false,\n    html: false,\n    linkify: true,\n    typographer: true,\n    xhtmlOut: true\n  }).use(_markdownItAttrsEs.default).use(_markdownItForInline.default, 'url_new_win', 'link_open', function (tokens, index) {\n    var token = tokens[index];\n    token.attrSet('rel', 'noopener noreferrer');\n    token.attrSet('target', '_blank');\n    var linkOpenToken = tokens.find(function (_ref3) {\n      var type = _ref3.type;\n      return type === 'link_open';\n    });\n\n    var _linkOpenToken$attrs$ = linkOpenToken.attrs.find(function (_ref4) {\n      var _ref5 = (0, _slicedToArray2.default)(_ref4, 1),\n          name = _ref5[0];\n\n      return name === 'href';\n    }),\n        _linkOpenToken$attrs$2 = (0, _slicedToArray2.default)(_linkOpenToken$attrs$, 2),\n        href = _linkOpenToken$attrs$2[1]; // Adds a new icon if the link is http: or https:.\n    // Don't add if it's a phone number, etc.\n\n\n    if (/^http[s\\u017F]?:/i.test(href)) {\n      externalLinkAlt && token.attrSet('title', externalLinkAlt);\n      var iconTokens = internalMarkdownIt.parseInline(\"![\".concat(externalLinkAlt, \"](\").concat(TRANSPARENT_GIF, \")\"))[0].children;\n      iconTokens[0].attrJoin('class', 'webchat__markdown__external-link-icon');\n      tokens.splice.apply(tokens, [index + 2, 0].concat((0, _toConsumableArray2.default)(iconTokens)));\n    }\n  }).render(markdown);\n  return (0, _sanitizeHtml.default)(html, SANITIZE_HTML_OPTIONS);\n}","map":{"version":3,"sources":["../src/renderMarkdown.js"],"names":["SANITIZE_HTML_OPTIONS","allowedAttributes","a","img","allowedSchemes","allowedTags","TRANSPARENT_GIF","internalMarkdownIt","MarkdownIt","markdownRespectCRLF","externalLinkAlt","markdown","carriageReturn","html","breaks","linkify","typographer","xhtmlOut","markdownItAttrs","iterator","token","tokens","linkOpenToken","type","href","name","iconTokens","index"],"mappings":"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","sourcesContent":["/* eslint no-magic-numbers: [\"error\", { \"ignore\": [0, 1, 2] }] */\n\nimport iterator from 'markdown-it-for-inline';\nimport MarkdownIt from 'markdown-it';\nimport markdownItAttrs from 'markdown-it-attrs-es5';\nimport sanitizeHTML from 'sanitize-html';\n\nconst SANITIZE_HTML_OPTIONS = {\n  allowedAttributes: {\n    a: ['aria-label', 'href', 'name', 'rel', 'target', 'title'],\n    img: ['alt', 'class', 'src']\n  },\n  allowedSchemes: ['data', 'http', 'https', 'ftp', 'mailto', 'sip', 'tel'],\n  allowedTags: [\n    'a',\n    'b',\n    'blockquote',\n    'br',\n    'caption',\n    'code',\n    'del',\n    'div',\n    'em',\n    'h1',\n    'h2',\n    'h3',\n    'h4',\n    'h5',\n    'h6',\n    'hr',\n    'i',\n    'img',\n    'ins',\n    'li',\n    'nl',\n    'ol',\n    'p',\n    'pre',\n    's',\n    'span',\n    'strike',\n    'strong',\n    'table',\n    'tbody',\n    'td',\n    'tfoot',\n    'th',\n    'thead',\n    'tr',\n    'ul'\n  ]\n};\n\n// Put a transparent pixel instead of the \"open in new window\" icon, so developers can easily modify the icon in CSS.\nconst TRANSPARENT_GIF = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n\n// This is used for parsing Markdown for external links.\nconst internalMarkdownIt = new MarkdownIt();\n\nexport default function render(markdown, { markdownRespectCRLF }, { externalLinkAlt = '' } = {}) {\n  if (markdownRespectCRLF) {\n    markdown = markdown.replace(/\\n\\r|\\r\\n/gu, carriageReturn => (carriageReturn === '\\n\\r' ? '\\r\\n' : '\\n\\r'));\n  }\n\n  const html = new MarkdownIt({\n    breaks: false,\n    html: false,\n    linkify: true,\n    typographer: true,\n    xhtmlOut: true\n  })\n    .use(markdownItAttrs)\n    .use(iterator, 'url_new_win', 'link_open', (tokens, index) => {\n      const token = tokens[index];\n\n      token.attrSet('rel', 'noopener noreferrer');\n      token.attrSet('target', '_blank');\n\n      const linkOpenToken = tokens.find(({ type }) => type === 'link_open');\n      const [, href] = linkOpenToken.attrs.find(([name]) => name === 'href');\n\n      // Adds a new icon if the link is http: or https:.\n      // Don't add if it's a phone number, etc.\n      if (/^https?:/iu.test(href)) {\n        externalLinkAlt && token.attrSet('title', externalLinkAlt);\n\n        const iconTokens = internalMarkdownIt.parseInline(`![${externalLinkAlt}](${TRANSPARENT_GIF})`)[0].children;\n\n        iconTokens[0].attrJoin('class', 'webchat__markdown__external-link-icon');\n\n        tokens.splice(index + 2, 0, ...iconTokens);\n      }\n    })\n    .render(markdown);\n\n  return sanitizeHTML(html, SANITIZE_HTML_OPTIONS);\n}\n"],"sourceRoot":"bundle:///"},"metadata":{},"sourceType":"script"}