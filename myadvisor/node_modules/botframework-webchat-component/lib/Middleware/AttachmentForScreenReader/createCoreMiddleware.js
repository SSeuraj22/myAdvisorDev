"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createCoreMiddleware;

var _react = _interopRequireDefault(require("react"));

var _AudioAttachment = _interopRequireDefault(require("./AudioAttachment"));

var _FileAttachment = _interopRequireDefault(require("./FileAttachment"));

var _ImageAttachment = _interopRequireDefault(require("./ImageAttachment"));

var _TextAttachment = _interopRequireDefault(require("./TextAttachment"));

var _VideoAttachment = _interopRequireDefault(require("./VideoAttachment"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function createCoreMiddleware() {
  return [function () {
    return function (next) {
      return function () {
        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
          args[_key] = arguments[_key];
        }

        var _args$ = args[0],
            _args$$activity = _args$.activity;
        _args$$activity = _args$$activity === void 0 ? {} : _args$$activity;
        var _args$$activity$from = _args$$activity.from;
        _args$$activity$from = _args$$activity$from === void 0 ? {} : _args$$activity$from;
        var role = _args$$activity$from.role,
            attachment = _args$.attachment,
            _args$$attachment = _args$.attachment;
        _args$$attachment = _args$$attachment === void 0 ? {} : _args$$attachment;
        var contentType = _args$$attachment.contentType,
            contentUrl = _args$$attachment.contentUrl,
            thumbnailUrl = _args$$attachment.thumbnailUrl;
        var isText = /^text\//.test(contentType);
        return (isText ? !attachment.content : role === 'user' && !thumbnailUrl) ? function () {
          return /*#__PURE__*/_react.default.createElement(_FileAttachment.default, {
            attachment: attachment
          });
        } : /^audio\//.test(contentType) ? function () {
          return /*#__PURE__*/_react.default.createElement(_AudioAttachment.default, null);
        } : /^image\//.test(contentType) ? function () {
          return /*#__PURE__*/_react.default.createElement(_ImageAttachment.default, null);
        } : /^video\//.test(contentType) ? function () {
          return /*#__PURE__*/_react.default.createElement(_VideoAttachment.default, null);
        } : contentUrl || contentType === 'application/octet-stream' ? function () {
          return /*#__PURE__*/_react.default.createElement(_FileAttachment.default, {
            attachment: attachment
          });
        } : isText ? function () {
          return /*#__PURE__*/_react.default.createElement(_TextAttachment.default, {
            attachment: attachment
          });
        } : next.apply(void 0, args);
      };
    };
  }];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9NaWRkbGV3YXJlL0F0dGFjaG1lbnRGb3JTY3JlZW5SZWFkZXIvY3JlYXRlQ29yZU1pZGRsZXdhcmUuanMiXSwibmFtZXMiOlsiY3JlYXRlQ29yZU1pZGRsZXdhcmUiLCJuZXh0IiwiYXJncyIsImFjdGl2aXR5IiwiZnJvbSIsInJvbGUiLCJhdHRhY2htZW50IiwiY29udGVudFR5cGUiLCJjb250ZW50VXJsIiwidGh1bWJuYWlsVXJsIiwiaXNUZXh0IiwidGVzdCIsImNvbnRlbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVlLFNBQVNBLG9CQUFULEdBQWdDO0FBQzdDLFNBQU8sQ0FDTDtBQUFBLFdBQU0sVUFBQUMsSUFBSTtBQUFBLGFBQUksWUFBYTtBQUFBLDBDQUFUQyxJQUFTO0FBQVRBLFVBQUFBLElBQVM7QUFBQTs7QUFBQSxxQkFPckJBLElBUHFCO0FBQUEscUNBR3JCQyxRQUhxQjtBQUFBLHVEQUdlLEVBSGY7QUFBQSxtREFHVEMsSUFIUztBQUFBLGlFQUdRLEVBSFI7QUFBQSxZQUdEQyxJQUhDLHdCQUdEQSxJQUhDO0FBQUEsWUFJckJDLFVBSnFCLFVBSXJCQSxVQUpxQjtBQUFBLHVDQUtyQkEsVUFMcUI7QUFBQSwyREFLbUMsRUFMbkM7QUFBQSxZQUtQQyxXQUxPLHFCQUtQQSxXQUxPO0FBQUEsWUFLTUMsVUFMTixxQkFLTUEsVUFMTjtBQUFBLFlBS2tCQyxZQUxsQixxQkFLa0JBLFlBTGxCO0FBU3pCLFlBQU1DLE1BQU0sR0FBRyxVQUFXQyxJQUFYLENBQWdCSixXQUFoQixDQUFmO0FBRUEsZUFBTyxDQUFDRyxNQUFNLEdBQUcsQ0FBQ0osVUFBVSxDQUFDTSxPQUFmLEdBQXlCUCxJQUFJLEtBQUssTUFBVCxJQUFtQixDQUFDSSxZQUFwRCxJQUNIO0FBQUEsOEJBQU0sNkJBQUMsdUJBQUQ7QUFBZ0IsWUFBQSxVQUFVLEVBQUVIO0FBQTVCLFlBQU47QUFBQSxTQURHLEdBRUgsV0FBWUssSUFBWixDQUFpQkosV0FBakIsSUFDQTtBQUFBLDhCQUFNLDZCQUFDLHdCQUFELE9BQU47QUFBQSxTQURBLEdBRUEsV0FBWUksSUFBWixDQUFpQkosV0FBakIsSUFDQTtBQUFBLDhCQUFNLDZCQUFDLHdCQUFELE9BQU47QUFBQSxTQURBLEdBRUEsV0FBWUksSUFBWixDQUFpQkosV0FBakIsSUFDQTtBQUFBLDhCQUFNLDZCQUFDLHdCQUFELE9BQU47QUFBQSxTQURBLEdBRUFDLFVBQVUsSUFBSUQsV0FBVyxLQUFLLDBCQUE5QixHQUNBO0FBQUEsOEJBQU0sNkJBQUMsdUJBQUQ7QUFBZ0IsWUFBQSxVQUFVLEVBQUVEO0FBQTVCLFlBQU47QUFBQSxTQURBLEdBRUFJLE1BQU0sR0FDTjtBQUFBLDhCQUFNLDZCQUFDLHVCQUFEO0FBQWdCLFlBQUEsVUFBVSxFQUFFSjtBQUE1QixZQUFOO0FBQUEsU0FETSxHQUVOTCxJQUFJLE1BQUosU0FBUUMsSUFBUixDQVpKO0FBYUQsT0F4QlM7QUFBQSxLQUFWO0FBQUEsR0FESyxDQUFQO0FBMkJEIiwic291cmNlUm9vdCI6ImNvbXBvbmVudDovLy8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgQXVkaW9BdHRhY2htZW50IGZyb20gJy4vQXVkaW9BdHRhY2htZW50JztcbmltcG9ydCBGaWxlQXR0YWNobWVudCBmcm9tICcuL0ZpbGVBdHRhY2htZW50JztcbmltcG9ydCBJbWFnZUF0dGFjaG1lbnQgZnJvbSAnLi9JbWFnZUF0dGFjaG1lbnQnO1xuaW1wb3J0IFRleHRBdHRhY2htZW50IGZyb20gJy4vVGV4dEF0dGFjaG1lbnQnO1xuaW1wb3J0IFZpZGVvQXR0YWNobWVudCBmcm9tICcuL1ZpZGVvQXR0YWNobWVudCc7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNyZWF0ZUNvcmVNaWRkbGV3YXJlKCkge1xuICByZXR1cm4gW1xuICAgICgpID0+IG5leHQgPT4gKC4uLmFyZ3MpID0+IHtcbiAgICAgIGNvbnN0IFtcbiAgICAgICAge1xuICAgICAgICAgIGFjdGl2aXR5OiB7IGZyb206IHsgcm9sZSB9ID0ge30gfSA9IHt9LFxuICAgICAgICAgIGF0dGFjaG1lbnQsXG4gICAgICAgICAgYXR0YWNobWVudDogeyBjb250ZW50VHlwZSwgY29udGVudFVybCwgdGh1bWJuYWlsVXJsIH0gPSB7fVxuICAgICAgICB9XG4gICAgICBdID0gYXJncztcblxuICAgICAgY29uc3QgaXNUZXh0ID0gL150ZXh0XFwvL3UudGVzdChjb250ZW50VHlwZSk7XG5cbiAgICAgIHJldHVybiAoaXNUZXh0ID8gIWF0dGFjaG1lbnQuY29udGVudCA6IHJvbGUgPT09ICd1c2VyJyAmJiAhdGh1bWJuYWlsVXJsKVxuICAgICAgICA/ICgpID0+IDxGaWxlQXR0YWNobWVudCBhdHRhY2htZW50PXthdHRhY2htZW50fSAvPlxuICAgICAgICA6IC9eYXVkaW9cXC8vdS50ZXN0KGNvbnRlbnRUeXBlKVxuICAgICAgICA/ICgpID0+IDxBdWRpb0F0dGFjaG1lbnQgLz5cbiAgICAgICAgOiAvXmltYWdlXFwvL3UudGVzdChjb250ZW50VHlwZSlcbiAgICAgICAgPyAoKSA9PiA8SW1hZ2VBdHRhY2htZW50IC8+XG4gICAgICAgIDogL152aWRlb1xcLy91LnRlc3QoY29udGVudFR5cGUpXG4gICAgICAgID8gKCkgPT4gPFZpZGVvQXR0YWNobWVudCAvPlxuICAgICAgICA6IGNvbnRlbnRVcmwgfHwgY29udGVudFR5cGUgPT09ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nXG4gICAgICAgID8gKCkgPT4gPEZpbGVBdHRhY2htZW50IGF0dGFjaG1lbnQ9e2F0dGFjaG1lbnR9IC8+XG4gICAgICAgIDogaXNUZXh0XG4gICAgICAgID8gKCkgPT4gPFRleHRBdHRhY2htZW50IGF0dGFjaG1lbnQ9e2F0dGFjaG1lbnR9IC8+XG4gICAgICAgIDogbmV4dCguLi5hcmdzKTtcbiAgICB9XG4gIF07XG59XG4iXX0=