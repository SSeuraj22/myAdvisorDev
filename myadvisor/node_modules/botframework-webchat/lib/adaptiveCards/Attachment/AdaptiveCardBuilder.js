"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _adaptivecards = require("adaptivecards");

function addCardAction(cardAction, includesOAuthButtons) {
  var type = cardAction.type;
  var action;

  if (type === 'imBack' || type === 'messageBack' || type === 'postBack' || type === 'signin' && includesOAuthButtons) {
    action = new _adaptivecards.SubmitAction();
    action.data = {
      __isBotFrameworkCardAction: true,
      cardAction: cardAction
    };
    action.title = cardAction.title;
  } else {
    action = new _adaptivecards.OpenUrlAction();
    action.title = cardAction.title;
    action.url = cardAction.type === 'call' ? "tel:".concat(cardAction.value) : cardAction.value;
  }

  return action;
}

var AdaptiveCardBuilder = /*#__PURE__*/function () {
  function AdaptiveCardBuilder(adaptiveCards, styleOptions) {
    var direction = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'ltr';
    (0, _classCallCheck2.default)(this, AdaptiveCardBuilder);
    (0, _defineProperty2.default)(this, "card", void 0);
    (0, _defineProperty2.default)(this, "container", void 0);
    (0, _defineProperty2.default)(this, "styleOptions", void 0);
    this.card = new adaptiveCards.AdaptiveCard();
    this.container = new _adaptivecards.Container();
    this.container.rtl = direction === 'rtl';
    this.styleOptions = styleOptions;
    this.card.addItem(this.container);
  }

  (0, _createClass2.default)(AdaptiveCardBuilder, [{
    key: "addColumnSet",
    value: function addColumnSet(sizes) {
      var container = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.container;
      var selectAction = arguments.length > 2 ? arguments[2] : undefined;
      var columnSet = new _adaptivecards.ColumnSet();
      columnSet.selectAction = selectAction && addCardAction(selectAction);
      container.addItem(columnSet);
      return sizes.map(function (size) {
        var column = new _adaptivecards.Column();
        column.width = new _adaptivecards.SizeAndUnit(size, _adaptivecards.SizeUnit.Weight);
        columnSet.addColumn(column);
        return column;
      });
    }
  }, {
    key: "addItems",
    value: function addItems(cardElements) {
      var container = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.container;
      cardElements.forEach(function (cardElement) {
        return container.addItem(cardElement);
      });
    }
  }, {
    key: "addTextBlock",
    value: function addTextBlock(text, template) {
      var container = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.container;

      if (typeof text !== 'undefined') {
        var textblock = new _adaptivecards.TextBlock(); // tslint:disable-next-line:forin

        for (var prop in template) {
          textblock[prop] = template[prop];
        }

        textblock.text = text;
        container.addItem(textblock);
      }
    }
  }, {
    key: "addButtons",
    value: function addButtons(cardActions, includesOAuthButtons) {
      var _this = this;

      cardActions && cardActions.forEach(function (cardAction) {
        _this.card.addAction(addCardAction(cardAction, includesOAuthButtons));
      });
    }
  }, {
    key: "addCommonHeaders",
    value: function addCommonHeaders(content) {
      var richCardWrapTitle = this.styleOptions.richCardWrapTitle;
      this.addTextBlock(content.title, {
        color: _adaptivecards.TextColor.Dark,
        size: _adaptivecards.TextSize.Medium,
        weight: _adaptivecards.TextWeight.Bolder,
        wrap: richCardWrapTitle
      });
      this.addTextBlock(content.subtitle, {
        color: _adaptivecards.TextColor.Dark,
        isSubtle: true,
        wrap: richCardWrapTitle
      });
      this.addTextBlock(content.text, {
        color: _adaptivecards.TextColor.Dark,
        wrap: true
      });
    }
  }, {
    key: "addCommon",
    value: function addCommon(content) {
      this.addCommonHeaders(content);
      this.addButtons(content.buttons);
    }
  }, {
    key: "addImage",
    value: function addImage(url, container, selectAction, altText) {
      container = container || this.container;
      var image = new _adaptivecards.Image();
      image.altText = altText;
      image.url = url;
      image.selectAction = selectAction && addCardAction(selectAction);
      image.size = _adaptivecards.Size.Stretch;
      container.addItem(image);
    }
  }]);
  return AdaptiveCardBuilder;
}();

exports.default = AdaptiveCardBuilder;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hZGFwdGl2ZUNhcmRzL0F0dGFjaG1lbnQvQWRhcHRpdmVDYXJkQnVpbGRlci50cyJdLCJuYW1lcyI6WyJhZGRDYXJkQWN0aW9uIiwiY2FyZEFjdGlvbiIsImluY2x1ZGVzT0F1dGhCdXR0b25zIiwidHlwZSIsImFjdGlvbiIsIlN1Ym1pdEFjdGlvbiIsImRhdGEiLCJfX2lzQm90RnJhbWV3b3JrQ2FyZEFjdGlvbiIsInRpdGxlIiwiT3BlblVybEFjdGlvbiIsInVybCIsInZhbHVlIiwiQWRhcHRpdmVDYXJkQnVpbGRlciIsImFkYXB0aXZlQ2FyZHMiLCJzdHlsZU9wdGlvbnMiLCJkaXJlY3Rpb24iLCJjYXJkIiwiQWRhcHRpdmVDYXJkIiwiY29udGFpbmVyIiwiQ29udGFpbmVyIiwicnRsIiwiYWRkSXRlbSIsInNpemVzIiwic2VsZWN0QWN0aW9uIiwiY29sdW1uU2V0IiwiQ29sdW1uU2V0IiwibWFwIiwic2l6ZSIsImNvbHVtbiIsIkNvbHVtbiIsIndpZHRoIiwiU2l6ZUFuZFVuaXQiLCJTaXplVW5pdCIsIldlaWdodCIsImFkZENvbHVtbiIsImNhcmRFbGVtZW50cyIsImZvckVhY2giLCJjYXJkRWxlbWVudCIsInRleHQiLCJ0ZW1wbGF0ZSIsInRleHRibG9jayIsIlRleHRCbG9jayIsInByb3AiLCJjYXJkQWN0aW9ucyIsImFkZEFjdGlvbiIsImNvbnRlbnQiLCJyaWNoQ2FyZFdyYXBUaXRsZSIsImFkZFRleHRCbG9jayIsImNvbG9yIiwiVGV4dENvbG9yIiwiRGFyayIsIlRleHRTaXplIiwiTWVkaXVtIiwid2VpZ2h0IiwiVGV4dFdlaWdodCIsIkJvbGRlciIsIndyYXAiLCJzdWJ0aXRsZSIsImlzU3VidGxlIiwiYWRkQ29tbW9uSGVhZGVycyIsImFkZEJ1dHRvbnMiLCJidXR0b25zIiwiYWx0VGV4dCIsImltYWdlIiwiSW1hZ2UiLCJTaXplIiwiU3RyZXRjaCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBeUJBLFNBQVNBLGFBQVQsQ0FBdUJDLFVBQXZCLEVBQStDQyxvQkFBL0MsRUFBK0U7QUFBQSxNQUNyRUMsSUFEcUUsR0FDNURGLFVBRDRELENBQ3JFRSxJQURxRTtBQUU3RSxNQUFJQyxNQUFKOztBQUVBLE1BQ0VELElBQUksS0FBSyxRQUFULElBQ0FBLElBQUksS0FBSyxhQURULElBRUFBLElBQUksS0FBSyxVQUZULElBR0NBLElBQUksS0FBSyxRQUFULElBQXFCRCxvQkFKeEIsRUFLRTtBQUNBRSxJQUFBQSxNQUFNLEdBQUcsSUFBSUMsMkJBQUosRUFBVDtBQUVBRCxJQUFBQSxNQUFNLENBQUNFLElBQVAsR0FBYztBQUNaQyxNQUFBQSwwQkFBMEIsRUFBRSxJQURoQjtBQUVaTixNQUFBQSxVQUFVLEVBQVZBO0FBRlksS0FBZDtBQUtBRyxJQUFBQSxNQUFNLENBQUNJLEtBQVAsR0FBZVAsVUFBVSxDQUFDTyxLQUExQjtBQUNELEdBZEQsTUFjTztBQUNMSixJQUFBQSxNQUFNLEdBQUcsSUFBSUssNEJBQUosRUFBVDtBQUVBTCxJQUFBQSxNQUFNLENBQUNJLEtBQVAsR0FBZVAsVUFBVSxDQUFDTyxLQUExQjtBQUNBSixJQUFBQSxNQUFNLENBQUNNLEdBQVAsR0FBYVQsVUFBVSxDQUFDRSxJQUFYLEtBQW9CLE1BQXBCLGlCQUFvQ0YsVUFBVSxDQUFDVSxLQUEvQyxJQUF5RFYsVUFBVSxDQUFDVSxLQUFqRjtBQUNEOztBQUVELFNBQU9QLE1BQVA7QUFDRDs7SUFFb0JRLG1CO0FBS25CLCtCQUFZQyxhQUFaLEVBQTJCQyxZQUEzQixFQUE0RDtBQUFBLFFBQW5CQyxTQUFtQix1RUFBUCxLQUFPO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDMUQsU0FBS0MsSUFBTCxHQUFZLElBQUlILGFBQWEsQ0FBQ0ksWUFBbEIsRUFBWjtBQUNBLFNBQUtDLFNBQUwsR0FBaUIsSUFBSUMsd0JBQUosRUFBakI7QUFDQSxTQUFLRCxTQUFMLENBQWVFLEdBQWYsR0FBcUJMLFNBQVMsS0FBSyxLQUFuQztBQUNBLFNBQUtELFlBQUwsR0FBb0JBLFlBQXBCO0FBRUEsU0FBS0UsSUFBTCxDQUFVSyxPQUFWLENBQWtCLEtBQUtILFNBQXZCO0FBQ0Q7Ozs7V0FFRCxzQkFBYUksS0FBYixFQUFnRztBQUFBLFVBQWxFSixTQUFrRSx1RUFBM0MsS0FBS0EsU0FBc0M7QUFBQSxVQUEzQkssWUFBMkI7QUFDOUYsVUFBTUMsU0FBUyxHQUFHLElBQUlDLHdCQUFKLEVBQWxCO0FBRUFELE1BQUFBLFNBQVMsQ0FBQ0QsWUFBVixHQUF5QkEsWUFBWSxJQUFJdkIsYUFBYSxDQUFDdUIsWUFBRCxDQUF0RDtBQUNBTCxNQUFBQSxTQUFTLENBQUNHLE9BQVYsQ0FBa0JHLFNBQWxCO0FBRUEsYUFBT0YsS0FBSyxDQUFDSSxHQUFOLENBQVUsVUFBQUMsSUFBSSxFQUFJO0FBQ3ZCLFlBQU1DLE1BQU0sR0FBRyxJQUFJQyxxQkFBSixFQUFmO0FBRUFELFFBQUFBLE1BQU0sQ0FBQ0UsS0FBUCxHQUFlLElBQUlDLDBCQUFKLENBQWdCSixJQUFoQixFQUFzQkssd0JBQVNDLE1BQS9CLENBQWY7QUFFQVQsUUFBQUEsU0FBUyxDQUFDVSxTQUFWLENBQW9CTixNQUFwQjtBQUVBLGVBQU9BLE1BQVA7QUFDRCxPQVJNLENBQVA7QUFTRDs7O1dBRUQsa0JBQVNPLFlBQVQsRUFBNkU7QUFBQSxVQUF2Q2pCLFNBQXVDLHVFQUFoQixLQUFLQSxTQUFXO0FBQzNFaUIsTUFBQUEsWUFBWSxDQUFDQyxPQUFiLENBQXFCLFVBQUFDLFdBQVc7QUFBQSxlQUFJbkIsU0FBUyxDQUFDRyxPQUFWLENBQWtCZ0IsV0FBbEIsQ0FBSjtBQUFBLE9BQWhDO0FBQ0Q7OztXQUVELHNCQUFhQyxJQUFiLEVBQTJCQyxRQUEzQixFQUFnRztBQUFBLFVBQXZDckIsU0FBdUMsdUVBQWhCLEtBQUtBLFNBQVc7O0FBQzlGLFVBQUksT0FBT29CLElBQVAsS0FBZ0IsV0FBcEIsRUFBaUM7QUFDL0IsWUFBTUUsU0FBUyxHQUFHLElBQUlDLHdCQUFKLEVBQWxCLENBRCtCLENBRy9COztBQUNBLGFBQUssSUFBTUMsSUFBWCxJQUFtQkgsUUFBbkIsRUFBNkI7QUFDM0JDLFVBQUFBLFNBQVMsQ0FBQ0UsSUFBRCxDQUFULEdBQWtCSCxRQUFRLENBQUNHLElBQUQsQ0FBMUI7QUFDRDs7QUFFREYsUUFBQUEsU0FBUyxDQUFDRixJQUFWLEdBQWlCQSxJQUFqQjtBQUVBcEIsUUFBQUEsU0FBUyxDQUFDRyxPQUFWLENBQWtCbUIsU0FBbEI7QUFDRDtBQUNGOzs7V0FFRCxvQkFBV0csV0FBWCxFQUFzQ3pDLG9CQUF0QyxFQUFzRTtBQUFBOztBQUNwRXlDLE1BQUFBLFdBQVcsSUFDVEEsV0FBVyxDQUFDUCxPQUFaLENBQW9CLFVBQUFuQyxVQUFVLEVBQUk7QUFDaEMsUUFBQSxLQUFJLENBQUNlLElBQUwsQ0FBVTRCLFNBQVYsQ0FBb0I1QyxhQUFhLENBQUNDLFVBQUQsRUFBYUMsb0JBQWIsQ0FBakM7QUFDRCxPQUZELENBREY7QUFJRDs7O1dBRUQsMEJBQWlCMkMsT0FBakIsRUFBMEM7QUFBQSxVQUNoQ0MsaUJBRGdDLEdBQ1YsS0FBS2hDLFlBREssQ0FDaENnQyxpQkFEZ0M7QUFFeEMsV0FBS0MsWUFBTCxDQUFrQkYsT0FBTyxDQUFDckMsS0FBMUIsRUFBaUM7QUFDL0J3QyxRQUFBQSxLQUFLLEVBQUVDLHlCQUFVQyxJQURjO0FBRS9CdkIsUUFBQUEsSUFBSSxFQUFFd0Isd0JBQVNDLE1BRmdCO0FBRy9CQyxRQUFBQSxNQUFNLEVBQUVDLDBCQUFXQyxNQUhZO0FBSS9CQyxRQUFBQSxJQUFJLEVBQUVWO0FBSnlCLE9BQWpDO0FBTUEsV0FBS0MsWUFBTCxDQUFrQkYsT0FBTyxDQUFDWSxRQUExQixFQUFvQztBQUFFVCxRQUFBQSxLQUFLLEVBQUVDLHlCQUFVQyxJQUFuQjtBQUF5QlEsUUFBQUEsUUFBUSxFQUFFLElBQW5DO0FBQXlDRixRQUFBQSxJQUFJLEVBQUVWO0FBQS9DLE9BQXBDO0FBQ0EsV0FBS0MsWUFBTCxDQUFrQkYsT0FBTyxDQUFDUCxJQUExQixFQUFnQztBQUFFVSxRQUFBQSxLQUFLLEVBQUVDLHlCQUFVQyxJQUFuQjtBQUF5Qk0sUUFBQUEsSUFBSSxFQUFFO0FBQS9CLE9BQWhDO0FBQ0Q7OztXQUVELG1CQUFVWCxPQUFWLEVBQW1DO0FBQ2pDLFdBQUtjLGdCQUFMLENBQXNCZCxPQUF0QjtBQUNBLFdBQUtlLFVBQUwsQ0FBZ0JmLE9BQU8sQ0FBQ2dCLE9BQXhCO0FBQ0Q7OztXQUVELGtCQUFTbkQsR0FBVCxFQUFzQlEsU0FBdEIsRUFBNkNLLFlBQTdDLEVBQXdFdUMsT0FBeEUsRUFBMEY7QUFDeEY1QyxNQUFBQSxTQUFTLEdBQUdBLFNBQVMsSUFBSSxLQUFLQSxTQUE5QjtBQUVBLFVBQU02QyxLQUFLLEdBQUcsSUFBSUMsb0JBQUosRUFBZDtBQUVBRCxNQUFBQSxLQUFLLENBQUNELE9BQU4sR0FBZ0JBLE9BQWhCO0FBQ0FDLE1BQUFBLEtBQUssQ0FBQ3JELEdBQU4sR0FBWUEsR0FBWjtBQUNBcUQsTUFBQUEsS0FBSyxDQUFDeEMsWUFBTixHQUFxQkEsWUFBWSxJQUFJdkIsYUFBYSxDQUFDdUIsWUFBRCxDQUFsRDtBQUNBd0MsTUFBQUEsS0FBSyxDQUFDcEMsSUFBTixHQUFhc0Msb0JBQUtDLE9BQWxCO0FBRUFoRCxNQUFBQSxTQUFTLENBQUNHLE9BQVYsQ0FBa0IwQyxLQUFsQjtBQUNEIiwic291cmNlUm9vdCI6ImJ1bmRsZTovLy8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZGFwdGl2ZUNhcmQsXG4gIENhcmRFbGVtZW50LFxuICBDb2x1bW4sXG4gIENvbHVtblNldCxcbiAgQ29udGFpbmVyLFxuICBJbWFnZSxcbiAgT3BlblVybEFjdGlvbixcbiAgU2l6ZSxcbiAgU2l6ZUFuZFVuaXQsXG4gIFNpemVVbml0LFxuICBTdWJtaXRBY3Rpb24sXG4gIFRleHRCbG9jayxcbiAgVGV4dENvbG9yLFxuICBUZXh0U2l6ZSxcbiAgVGV4dFdlaWdodFxufSBmcm9tICdhZGFwdGl2ZWNhcmRzJztcblxuaW1wb3J0IHsgQ2FyZEFjdGlvbiB9IGZyb20gJ2JvdGZyYW1ld29yay1kaXJlY3RsaW5lanMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEJvdEZyYW1ld29ya0NhcmRBY3Rpb24ge1xuICBfX2lzQm90RnJhbWV3b3JrQ2FyZEFjdGlvbjogYm9vbGVhbjtcbiAgY2FyZEFjdGlvbjogQ2FyZEFjdGlvbjtcbn1cblxuZnVuY3Rpb24gYWRkQ2FyZEFjdGlvbihjYXJkQWN0aW9uOiBDYXJkQWN0aW9uLCBpbmNsdWRlc09BdXRoQnV0dG9ucz86IGJvb2xlYW4pIHtcbiAgY29uc3QgeyB0eXBlIH0gPSBjYXJkQWN0aW9uO1xuICBsZXQgYWN0aW9uO1xuXG4gIGlmIChcbiAgICB0eXBlID09PSAnaW1CYWNrJyB8fFxuICAgIHR5cGUgPT09ICdtZXNzYWdlQmFjaycgfHxcbiAgICB0eXBlID09PSAncG9zdEJhY2snIHx8XG4gICAgKHR5cGUgPT09ICdzaWduaW4nICYmIGluY2x1ZGVzT0F1dGhCdXR0b25zKVxuICApIHtcbiAgICBhY3Rpb24gPSBuZXcgU3VibWl0QWN0aW9uKCk7XG5cbiAgICBhY3Rpb24uZGF0YSA9IHtcbiAgICAgIF9faXNCb3RGcmFtZXdvcmtDYXJkQWN0aW9uOiB0cnVlLFxuICAgICAgY2FyZEFjdGlvblxuICAgIH07XG5cbiAgICBhY3Rpb24udGl0bGUgPSBjYXJkQWN0aW9uLnRpdGxlO1xuICB9IGVsc2Uge1xuICAgIGFjdGlvbiA9IG5ldyBPcGVuVXJsQWN0aW9uKCk7XG5cbiAgICBhY3Rpb24udGl0bGUgPSBjYXJkQWN0aW9uLnRpdGxlO1xuICAgIGFjdGlvbi51cmwgPSBjYXJkQWN0aW9uLnR5cGUgPT09ICdjYWxsJyA/IGB0ZWw6JHtjYXJkQWN0aW9uLnZhbHVlfWAgOiBjYXJkQWN0aW9uLnZhbHVlO1xuICB9XG5cbiAgcmV0dXJuIGFjdGlvbjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQWRhcHRpdmVDYXJkQnVpbGRlciB7XG4gIGNhcmQ6IEFkYXB0aXZlQ2FyZDtcbiAgY29udGFpbmVyOiBDb250YWluZXI7XG4gIHN0eWxlT3B0aW9uczogYW55O1xuXG4gIGNvbnN0cnVjdG9yKGFkYXB0aXZlQ2FyZHMsIHN0eWxlT3B0aW9ucywgZGlyZWN0aW9uID0gJ2x0cicpIHtcbiAgICB0aGlzLmNhcmQgPSBuZXcgYWRhcHRpdmVDYXJkcy5BZGFwdGl2ZUNhcmQoKTtcbiAgICB0aGlzLmNvbnRhaW5lciA9IG5ldyBDb250YWluZXIoKTtcbiAgICB0aGlzLmNvbnRhaW5lci5ydGwgPSBkaXJlY3Rpb24gPT09ICdydGwnO1xuICAgIHRoaXMuc3R5bGVPcHRpb25zID0gc3R5bGVPcHRpb25zO1xuXG4gICAgdGhpcy5jYXJkLmFkZEl0ZW0odGhpcy5jb250YWluZXIpO1xuICB9XG5cbiAgYWRkQ29sdW1uU2V0KHNpemVzOiBudW1iZXJbXSwgY29udGFpbmVyOiBDb250YWluZXIgPSB0aGlzLmNvbnRhaW5lciwgc2VsZWN0QWN0aW9uPzogQ2FyZEFjdGlvbikge1xuICAgIGNvbnN0IGNvbHVtblNldCA9IG5ldyBDb2x1bW5TZXQoKTtcblxuICAgIGNvbHVtblNldC5zZWxlY3RBY3Rpb24gPSBzZWxlY3RBY3Rpb24gJiYgYWRkQ2FyZEFjdGlvbihzZWxlY3RBY3Rpb24pO1xuICAgIGNvbnRhaW5lci5hZGRJdGVtKGNvbHVtblNldCk7XG5cbiAgICByZXR1cm4gc2l6ZXMubWFwKHNpemUgPT4ge1xuICAgICAgY29uc3QgY29sdW1uID0gbmV3IENvbHVtbigpO1xuXG4gICAgICBjb2x1bW4ud2lkdGggPSBuZXcgU2l6ZUFuZFVuaXQoc2l6ZSwgU2l6ZVVuaXQuV2VpZ2h0KTtcblxuICAgICAgY29sdW1uU2V0LmFkZENvbHVtbihjb2x1bW4pO1xuXG4gICAgICByZXR1cm4gY29sdW1uO1xuICAgIH0pO1xuICB9XG5cbiAgYWRkSXRlbXMoY2FyZEVsZW1lbnRzOiBDYXJkRWxlbWVudFtdLCBjb250YWluZXI6IENvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyKSB7XG4gICAgY2FyZEVsZW1lbnRzLmZvckVhY2goY2FyZEVsZW1lbnQgPT4gY29udGFpbmVyLmFkZEl0ZW0oY2FyZEVsZW1lbnQpKTtcbiAgfVxuXG4gIGFkZFRleHRCbG9jayh0ZXh0OiBzdHJpbmcsIHRlbXBsYXRlOiBQYXJ0aWFsPFRleHRCbG9jaz4sIGNvbnRhaW5lcjogQ29udGFpbmVyID0gdGhpcy5jb250YWluZXIpIHtcbiAgICBpZiAodHlwZW9mIHRleHQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBjb25zdCB0ZXh0YmxvY2sgPSBuZXcgVGV4dEJsb2NrKCk7XG5cbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpmb3JpblxuICAgICAgZm9yIChjb25zdCBwcm9wIGluIHRlbXBsYXRlKSB7XG4gICAgICAgIHRleHRibG9ja1twcm9wXSA9IHRlbXBsYXRlW3Byb3BdO1xuICAgICAgfVxuXG4gICAgICB0ZXh0YmxvY2sudGV4dCA9IHRleHQ7XG5cbiAgICAgIGNvbnRhaW5lci5hZGRJdGVtKHRleHRibG9jayk7XG4gICAgfVxuICB9XG5cbiAgYWRkQnV0dG9ucyhjYXJkQWN0aW9uczogQ2FyZEFjdGlvbltdLCBpbmNsdWRlc09BdXRoQnV0dG9ucz86IGJvb2xlYW4pIHtcbiAgICBjYXJkQWN0aW9ucyAmJlxuICAgICAgY2FyZEFjdGlvbnMuZm9yRWFjaChjYXJkQWN0aW9uID0+IHtcbiAgICAgICAgdGhpcy5jYXJkLmFkZEFjdGlvbihhZGRDYXJkQWN0aW9uKGNhcmRBY3Rpb24sIGluY2x1ZGVzT0F1dGhCdXR0b25zKSk7XG4gICAgICB9KTtcbiAgfVxuXG4gIGFkZENvbW1vbkhlYWRlcnMoY29udGVudDogSUNvbW1vbkNvbnRlbnQpIHtcbiAgICBjb25zdCB7IHJpY2hDYXJkV3JhcFRpdGxlIH0gPSB0aGlzLnN0eWxlT3B0aW9ucztcbiAgICB0aGlzLmFkZFRleHRCbG9jayhjb250ZW50LnRpdGxlLCB7XG4gICAgICBjb2xvcjogVGV4dENvbG9yLkRhcmssXG4gICAgICBzaXplOiBUZXh0U2l6ZS5NZWRpdW0sXG4gICAgICB3ZWlnaHQ6IFRleHRXZWlnaHQuQm9sZGVyLFxuICAgICAgd3JhcDogcmljaENhcmRXcmFwVGl0bGVcbiAgICB9KTtcbiAgICB0aGlzLmFkZFRleHRCbG9jayhjb250ZW50LnN1YnRpdGxlLCB7IGNvbG9yOiBUZXh0Q29sb3IuRGFyaywgaXNTdWJ0bGU6IHRydWUsIHdyYXA6IHJpY2hDYXJkV3JhcFRpdGxlIH0pO1xuICAgIHRoaXMuYWRkVGV4dEJsb2NrKGNvbnRlbnQudGV4dCwgeyBjb2xvcjogVGV4dENvbG9yLkRhcmssIHdyYXA6IHRydWUgfSk7XG4gIH1cblxuICBhZGRDb21tb24oY29udGVudDogSUNvbW1vbkNvbnRlbnQpIHtcbiAgICB0aGlzLmFkZENvbW1vbkhlYWRlcnMoY29udGVudCk7XG4gICAgdGhpcy5hZGRCdXR0b25zKGNvbnRlbnQuYnV0dG9ucyk7XG4gIH1cblxuICBhZGRJbWFnZSh1cmw6IHN0cmluZywgY29udGFpbmVyPzogQ29udGFpbmVyLCBzZWxlY3RBY3Rpb24/OiBDYXJkQWN0aW9uLCBhbHRUZXh0Pzogc3RyaW5nKSB7XG4gICAgY29udGFpbmVyID0gY29udGFpbmVyIHx8IHRoaXMuY29udGFpbmVyO1xuXG4gICAgY29uc3QgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcblxuICAgIGltYWdlLmFsdFRleHQgPSBhbHRUZXh0O1xuICAgIGltYWdlLnVybCA9IHVybDtcbiAgICBpbWFnZS5zZWxlY3RBY3Rpb24gPSBzZWxlY3RBY3Rpb24gJiYgYWRkQ2FyZEFjdGlvbihzZWxlY3RBY3Rpb24pO1xuICAgIGltYWdlLnNpemUgPSBTaXplLlN0cmV0Y2g7XG5cbiAgICBjb250YWluZXIuYWRkSXRlbShpbWFnZSk7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJQ29tbW9uQ29udGVudCB7XG4gIGJ1dHRvbnM/OiBDYXJkQWN0aW9uW107XG4gIHN1YnRpdGxlPzogc3RyaW5nO1xuICB0ZXh0Pzogc3RyaW5nO1xuICB0aXRsZT86IHN0cmluZztcbn1cbiJdfQ==