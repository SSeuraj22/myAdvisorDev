"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
Object.defineProperty(exports, "DirectLineStreaming", {
  enumerable: true,
  get: function get() {
    return _directLineStreaming.DirectLineStreaming;
  }
});
exports.DirectLine = exports.ConnectionStatus = void 0;

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

require("core-js/features/promise");

require("url-search-params-polyfill");

var _BehaviorSubject = require("rxjs/BehaviorSubject");

var _Observable = require("rxjs/Observable");

var _async = require("rxjs/scheduler/async");

var _jwtDecode = _interopRequireWildcard(require("jwt-decode"));

require("rxjs/add/operator/catch");

require("rxjs/add/operator/combineLatest");

require("rxjs/add/operator/count");

require("rxjs/add/operator/delay");

require("rxjs/add/operator/do");

require("rxjs/add/operator/filter");

require("rxjs/add/operator/map");

require("rxjs/add/operator/mergeMap");

require("rxjs/add/operator/concatMap");

require("rxjs/add/operator/retryWhen");

require("rxjs/add/operator/share");

require("rxjs/add/operator/take");

require("rxjs/add/observable/dom/ajax");

require("rxjs/add/observable/empty");

require("rxjs/add/observable/from");

require("rxjs/add/observable/interval");

require("rxjs/add/observable/of");

require("rxjs/add/observable/throw");

var _dedupeFilenames = _interopRequireDefault(require("./dedupeFilenames"));

var _directLineStreaming = require("./directLineStreaming");

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var DIRECT_LINE_VERSION = 'DirectLine/3.0';
// These types are specific to this client library, not to Direct Line 3.0
var ConnectionStatus;
exports.ConnectionStatus = ConnectionStatus;

(function (ConnectionStatus) {
  ConnectionStatus[ConnectionStatus["Uninitialized"] = 0] = "Uninitialized";
  ConnectionStatus[ConnectionStatus["Connecting"] = 1] = "Connecting";
  ConnectionStatus[ConnectionStatus["Online"] = 2] = "Online";
  ConnectionStatus[ConnectionStatus["ExpiredToken"] = 3] = "ExpiredToken";
  ConnectionStatus[ConnectionStatus["FailedToConnect"] = 4] = "FailedToConnect";
  ConnectionStatus[ConnectionStatus["Ended"] = 5] = "Ended";
})(ConnectionStatus || (exports.ConnectionStatus = ConnectionStatus = {}));

var wrapAjaxWithRetry = function wrapAjaxWithRetry(source, scheduler) {
  var notImplemented = function notImplemented() {
    throw new Error('not implemented');
  };

  var inner = function inner(response$) {
    return response$["catch"](function (err) {
      if (err.status === 429) {
        var retryAfterValue = err.xhr.getResponseHeader('Retry-After');
        var retryAfter = Number(retryAfterValue);

        if (!isNaN(retryAfter)) {
          return _Observable.Observable.timer(retryAfter, scheduler).flatMap(function (_) {
            return _Observable.Observable["throw"](err, scheduler);
          });
        }
      }

      return _Observable.Observable["throw"](err, scheduler);
    });
  };

  var outer = function outer(urlOrRequest) {
    return inner(source(urlOrRequest));
  };

  return Object.assign(outer, {
    get: function get(url, headers) {
      return notImplemented();
    },
    post: function post(url, body, headers) {
      return notImplemented();
    },
    put: function put(url, body, headers) {
      return notImplemented();
    },
    patch: function patch(url, body, headers) {
      return notImplemented();
    },
    "delete": function _delete(url, headers) {
      return notImplemented();
    },
    getJSON: function getJSON(url, headers) {
      return notImplemented();
    }
  });
};

var makeServices = function makeServices(services) {
  var scheduler = services.scheduler || _async.async;
  return {
    scheduler: scheduler,
    ajax: wrapAjaxWithRetry(services.ajax || _Observable.Observable.ajax, scheduler),
    WebSocket: services.WebSocket || WebSocket,
    random: services.random || Math.random
  };
};

var lifetimeRefreshToken = 30 * 60 * 1000;
var intervalRefreshToken = lifetimeRefreshToken / 2;
var POLLING_INTERVAL_LOWER_BOUND = 200; //ms

var errorExpiredToken = new Error("expired token");
var errorConversationEnded = new Error("conversation ended");
var errorFailedToConnect = new Error("failed to connect");
var konsole = {
  log: function log(message) {
    var _console;

    for (var _len = arguments.length, optionalParams = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
      optionalParams[_key - 1] = arguments[_key];
    }

    if (typeof window !== 'undefined' && window["botchatDebug"] && message) (_console = console).log.apply(_console, [message].concat(optionalParams));
  }
};

var DirectLine =
/*#__PURE__*/
function () {
  //ms
  function DirectLine(options) {
    (0, _classCallCheck2["default"])(this, DirectLine);
    (0, _defineProperty2["default"])(this, "connectionStatus$", new _BehaviorSubject.BehaviorSubject(ConnectionStatus.Uninitialized));
    (0, _defineProperty2["default"])(this, "activity$", void 0);
    (0, _defineProperty2["default"])(this, "domain", "https://directline.botframework.com/v3/directline");
    (0, _defineProperty2["default"])(this, "webSocket", void 0);
    (0, _defineProperty2["default"])(this, "conversationId", void 0);
    (0, _defineProperty2["default"])(this, "expiredTokenExhaustion", void 0);
    (0, _defineProperty2["default"])(this, "secret", void 0);
    (0, _defineProperty2["default"])(this, "token", void 0);
    (0, _defineProperty2["default"])(this, "watermark", '');
    (0, _defineProperty2["default"])(this, "streamUrl", void 0);
    (0, _defineProperty2["default"])(this, "_botAgent", '');
    (0, _defineProperty2["default"])(this, "services", void 0);
    (0, _defineProperty2["default"])(this, "_userAgent", void 0);
    (0, _defineProperty2["default"])(this, "referenceGrammarId", void 0);
    (0, _defineProperty2["default"])(this, "timeout", 20 * 1000);
    (0, _defineProperty2["default"])(this, "retries", void 0);
    (0, _defineProperty2["default"])(this, "localeOnStartConversation", void 0);
    (0, _defineProperty2["default"])(this, "userIdOnStartConversation", void 0);
    (0, _defineProperty2["default"])(this, "pollingInterval", 1000);
    (0, _defineProperty2["default"])(this, "tokenRefreshSubscription", void 0);
    this.secret = options.secret;
    this.token = options.secret || options.token;
    this.webSocket = (options.webSocket === undefined ? true : options.webSocket) && typeof WebSocket !== 'undefined' && WebSocket !== undefined;

    if (options.conversationStartProperties && options.conversationStartProperties.locale) {
      if (Object.prototype.toString.call(options.conversationStartProperties.locale) === '[object String]') {
        this.localeOnStartConversation = options.conversationStartProperties.locale;
      } else {
        console.warn('DirectLineJS: conversationStartProperties.locale was ignored: the locale name may be a BCP 47 language tag');
      }
    }

    if (options.domain) {
      this.domain = options.domain;
    }

    if (options.conversationId) {
      this.conversationId = options.conversationId;
    }

    if (options.watermark) {
      this.watermark = options.watermark;
    }

    if (options.streamUrl) {
      if (options.token && options.conversationId) {
        this.streamUrl = options.streamUrl;
      } else {
        console.warn('DirectLineJS: streamUrl was ignored: you need to provide a token and a conversationid');
      }
    }

    if (options.timeout !== undefined) {
      this.timeout = options.timeout;
    }

    this.retries = (lifetimeRefreshToken - intervalRefreshToken) / this.timeout;
    this._botAgent = this.getBotAgent(options.botAgent);
    this.services = makeServices(options);
    var parsedPollingInterval = ~~options.pollingInterval;

    if (parsedPollingInterval < POLLING_INTERVAL_LOWER_BOUND) {
      if (typeof options.pollingInterval !== 'undefined') {
        console.warn("DirectLineJS: provided pollingInterval (".concat(options.pollingInterval, ") is under lower bound (200ms), using default of 1000ms"));
      }
    } else {
      this.pollingInterval = parsedPollingInterval;
    }

    this.expiredTokenExhaustion = this.setConnectionStatusFallback(ConnectionStatus.ExpiredToken, ConnectionStatus.FailedToConnect, 5);
    this.activity$ = (this.webSocket ? this.webSocketActivity$() : this.pollingGetActivity$()).share();
  } // Every time we're about to make a Direct Line REST call, we call this first to see check the current connection status.
  // Either throws an error (indicating an error state) or emits a null, indicating a (presumably) healthy connection


  (0, _createClass2["default"])(DirectLine, [{
    key: "checkConnection",
    value: function checkConnection() {
      var _this = this;

      var once = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
      var obs = this.connectionStatus$.flatMap(function (connectionStatus) {
        if (connectionStatus === ConnectionStatus.Uninitialized) {
          _this.connectionStatus$.next(ConnectionStatus.Connecting); //if token and streamUrl are defined it means reconnect has already been done. Skipping it.


          if (_this.token && _this.streamUrl) {
            _this.connectionStatus$.next(ConnectionStatus.Online);

            return _Observable.Observable.of(connectionStatus, _this.services.scheduler);
          } else {
            return _this.startConversation()["do"](function (conversation) {
              _this.conversationId = conversation.conversationId;
              _this.token = _this.secret || conversation.token;
              _this.streamUrl = conversation.streamUrl;
              _this.referenceGrammarId = conversation.referenceGrammarId;
              if (!_this.secret) _this.refreshTokenLoop();

              _this.connectionStatus$.next(ConnectionStatus.Online);
            }, function (error) {
              _this.connectionStatus$.next(ConnectionStatus.FailedToConnect);
            }).map(function (_) {
              return connectionStatus;
            });
          }
        } else {
          return _Observable.Observable.of(connectionStatus, _this.services.scheduler);
        }
      }).filter(function (connectionStatus) {
        return connectionStatus != ConnectionStatus.Uninitialized && connectionStatus != ConnectionStatus.Connecting;
      }).flatMap(function (connectionStatus) {
        switch (connectionStatus) {
          case ConnectionStatus.Ended:
            return _Observable.Observable["throw"](errorConversationEnded, _this.services.scheduler);

          case ConnectionStatus.FailedToConnect:
            return _Observable.Observable["throw"](errorFailedToConnect, _this.services.scheduler);

          case ConnectionStatus.ExpiredToken:
            return _Observable.Observable.of(connectionStatus, _this.services.scheduler);

          default:
            return _Observable.Observable.of(connectionStatus, _this.services.scheduler);
        }
      });
      return once ? obs.take(1) : obs;
    }
  }, {
    key: "setConnectionStatusFallback",
    value: function setConnectionStatusFallback(connectionStatusFrom, connectionStatusTo) {
      var maxAttempts = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 5;
      maxAttempts--;
      var attempts = 0;
      var currStatus = null;
      return function (status) {
        if (status === connectionStatusFrom && currStatus === status && attempts >= maxAttempts) {
          attempts = 0;
          return connectionStatusTo;
        }

        attempts++;
        currStatus = status;
        return status;
      };
    }
  }, {
    key: "expiredToken",
    value: function expiredToken() {
      var connectionStatus = this.connectionStatus$.getValue();
      if (connectionStatus != ConnectionStatus.Ended && connectionStatus != ConnectionStatus.FailedToConnect) this.connectionStatus$.next(ConnectionStatus.ExpiredToken);
      var protectedConnectionStatus = this.expiredTokenExhaustion(this.connectionStatus$.getValue());
      this.connectionStatus$.next(protectedConnectionStatus);
    }
  }, {
    key: "startConversation",
    value: function startConversation() {
      var _this2 = this;

      //if conversationid is set here, it means we need to call the reconnect api, else it is a new conversation
      var url = this.conversationId ? "".concat(this.domain, "/conversations/").concat(this.conversationId, "?watermark=").concat(this.watermark) : "".concat(this.domain, "/conversations");
      var method = this.conversationId ? "GET" : "POST";
      var body = this.conversationId ? undefined : {
        user: {
          id: this.userIdOnStartConversation
        },
        locale: this.localeOnStartConversation
      };
      return this.services.ajax({
        method: method,
        url: url,
        body: body,
        timeout: this.timeout,
        headers: _objectSpread({
          "Accept": "application/json",
          "Content-Type": "application/json"
        }, this.commonHeaders())
      }) //      .do(ajaxResponse => konsole.log("conversation ajaxResponse", ajaxResponse.response))
      .map(function (ajaxResponse) {
        return ajaxResponse.response;
      }).retryWhen(function (error$) {
        return (// for now we deem 4xx and 5xx errors as unrecoverable
          // for everything else (timeouts), retry for a while
          error$.mergeMap(function (error) {
            return error.status >= 400 && error.status < 600 ? _Observable.Observable["throw"](error, _this2.services.scheduler) : _Observable.Observable.of(error, _this2.services.scheduler);
          }).delay(_this2.timeout, _this2.services.scheduler).take(_this2.retries)
        );
      });
    }
  }, {
    key: "refreshTokenLoop",
    value: function refreshTokenLoop() {
      var _this3 = this;

      this.tokenRefreshSubscription = _Observable.Observable.interval(intervalRefreshToken, this.services.scheduler).flatMap(function (_) {
        return _this3.refreshToken();
      }).subscribe(function (token) {
        konsole.log("refreshing token", token, "at", new Date());
        _this3.token = token;
      });
    }
  }, {
    key: "refreshToken",
    value: function refreshToken() {
      var _this4 = this;

      return this.checkConnection(true).flatMap(function (_) {
        return _this4.services.ajax({
          method: "POST",
          url: "".concat(_this4.domain, "/tokens/refresh"),
          timeout: _this4.timeout,
          headers: _objectSpread({}, _this4.commonHeaders())
        }).map(function (ajaxResponse) {
          return ajaxResponse.response.token;
        }).retryWhen(function (error$) {
          return error$.mergeMap(function (error) {
            if (error.status === 403) {
              // if the token is expired there's no reason to keep trying
              _this4.expiredToken();

              return _Observable.Observable["throw"](error, _this4.services.scheduler);
            } else if (error.status === 404) {
              // If the bot is gone, we should stop retrying
              return _Observable.Observable["throw"](error, _this4.services.scheduler);
            }

            return _Observable.Observable.of(error, _this4.services.scheduler);
          }).delay(_this4.timeout, _this4.services.scheduler).take(_this4.retries);
        });
      });
    }
  }, {
    key: "reconnect",
    value: function reconnect(conversation) {
      this.token = conversation.token;
      this.streamUrl = conversation.streamUrl;
      if (this.connectionStatus$.getValue() === ConnectionStatus.ExpiredToken) this.connectionStatus$.next(ConnectionStatus.Online);
    }
  }, {
    key: "end",
    value: function end() {
      if (this.tokenRefreshSubscription) this.tokenRefreshSubscription.unsubscribe();

      try {
        this.connectionStatus$.next(ConnectionStatus.Ended);
      } catch (e) {
        if (e === errorConversationEnded) return;
        throw e;
      }
    }
  }, {
    key: "getSessionId",
    value: function getSessionId() {
      var _this5 = this;

      // If we're not connected to the bot, get connected
      // Will throw an error if we are not connected
      konsole.log("getSessionId");
      return this.checkConnection(true).flatMap(function (_) {
        return _this5.services.ajax({
          method: "GET",
          url: "".concat(_this5.domain, "/session/getsessionid"),
          withCredentials: true,
          timeout: _this5.timeout,
          headers: _objectSpread({
            "Content-Type": "application/json"
          }, _this5.commonHeaders())
        }).map(function (ajaxResponse) {
          if (ajaxResponse && ajaxResponse.response && ajaxResponse.response.sessionId) {
            konsole.log("getSessionId response: " + ajaxResponse.response.sessionId);
            return ajaxResponse.response.sessionId;
          }

          return '';
        })["catch"](function (error) {
          konsole.log("getSessionId error: " + error.status);
          return _Observable.Observable.of('', _this5.services.scheduler);
        });
      })["catch"](function (error) {
        return _this5.catchExpiredToken(error);
      });
    }
  }, {
    key: "postActivity",
    value: function postActivity(activity) {
      var _this6 = this;

      // If user id is set, check if it match activity.from.id and always override it in activity
      if (this.userIdOnStartConversation && activity.from && activity.from.id !== this.userIdOnStartConversation) {
        console.warn('DirectLineJS: Activity.from.id does not match with user id, ignoring activity.from.id');
        activity.from.id = this.userIdOnStartConversation;
      } // Use postMessageWithAttachments for messages with attachments that are local files (e.g. an image to upload)
      // Technically we could use it for *all* activities, but postActivity is much lighter weight
      // So, since WebChat is partially a reference implementation of Direct Line, we implement both.


      if (activity.type === "message" && activity.attachments && activity.attachments.length > 0) return this.postMessageWithAttachments(activity); // If we're not connected to the bot, get connected
      // Will throw an error if we are not connected

      konsole.log("postActivity", activity);
      return this.checkConnection(true).flatMap(function (_) {
        return _this6.services.ajax({
          method: "POST",
          url: "".concat(_this6.domain, "/conversations/").concat(_this6.conversationId, "/activities"),
          body: activity,
          timeout: _this6.timeout,
          headers: _objectSpread({
            "Content-Type": "application/json"
          }, _this6.commonHeaders())
        }).map(function (ajaxResponse) {
          return ajaxResponse.response.id;
        })["catch"](function (error) {
          return _this6.catchPostError(error);
        });
      })["catch"](function (error) {
        return _this6.catchExpiredToken(error);
      });
    }
  }, {
    key: "postMessageWithAttachments",
    value: function postMessageWithAttachments(message) {
      var _this7 = this;

      var attachments = message.attachments; // We clean the attachments but making sure every attachment has unique name.
      // If the file do not have a name, Chrome will assign "blob" when it is appended to FormData.

      var attachmentNames = (0, _dedupeFilenames["default"])(attachments.map(function (media) {
        return media.name || 'blob';
      }));
      var cleansedAttachments = attachments.map(function (attachment, index) {
        return _objectSpread({}, attachment, {
          name: attachmentNames[index]
        });
      });
      var formData; // If we're not connected to the bot, get connected
      // Will throw an error if we are not connected

      return this.checkConnection(true).flatMap(function (_) {
        // To send this message to DirectLine we need to deconstruct it into a "template" activity
        // and one blob for each attachment.
        formData = new FormData();
        formData.append('activity', new Blob([JSON.stringify(_objectSpread({}, message, {
          // Removing contentUrl from attachment, we will send it via multipart
          attachments: cleansedAttachments.map(function (_ref) {
            var string = _ref.contentUrl,
                others = (0, _objectWithoutProperties2["default"])(_ref, ["contentUrl"]);
            return _objectSpread({}, others);
          })
        }))], {
          type: 'application/vnd.microsoft.activity'
        }));
        return _Observable.Observable.from(cleansedAttachments, _this7.services.scheduler).flatMap(function (media) {
          return _this7.services.ajax({
            method: "GET",
            url: media.contentUrl,
            responseType: 'arraybuffer'
          })["do"](function (ajaxResponse) {
            return formData.append('file', new Blob([ajaxResponse.response], {
              type: media.contentType
            }), media.name);
          });
        }).count();
      }).flatMap(function (_) {
        return _this7.services.ajax({
          method: "POST",
          url: "".concat(_this7.domain, "/conversations/").concat(_this7.conversationId, "/upload?userId=").concat(message.from.id),
          body: formData,
          timeout: _this7.timeout,
          headers: _objectSpread({}, _this7.commonHeaders())
        }).map(function (ajaxResponse) {
          return ajaxResponse.response.id;
        })["catch"](function (error) {
          return _this7.catchPostError(error);
        });
      })["catch"](function (error) {
        return _this7.catchPostError(error);
      });
    }
  }, {
    key: "catchPostError",
    value: function catchPostError(error) {
      if (error.status === 403) // token has expired (will fall through to return "retry")
        this.expiredToken();else if (error.status >= 400 && error.status < 500) // more unrecoverable errors
        return _Observable.Observable["throw"](error, this.services.scheduler);
      return _Observable.Observable.of("retry", this.services.scheduler);
    }
  }, {
    key: "catchExpiredToken",
    value: function catchExpiredToken(error) {
      return error === errorExpiredToken ? _Observable.Observable.of("retry", this.services.scheduler) : _Observable.Observable["throw"](error, this.services.scheduler);
    }
  }, {
    key: "pollingGetActivity$",
    value: function pollingGetActivity$() {
      var _this8 = this;

      var poller$ = _Observable.Observable.create(function (subscriber) {
        // A BehaviorSubject to trigger polling. Since it is a BehaviorSubject
        // the first event is produced immediately.
        var trigger$ = new _BehaviorSubject.BehaviorSubject({}); // TODO: remove Date.now, use reactive interval to space out every request

        trigger$.subscribe(function () {
          if (_this8.connectionStatus$.getValue() === ConnectionStatus.Online) {
            var startTimestamp = Date.now();

            _this8.services.ajax({
              headers: _objectSpread({
                Accept: 'application/json'
              }, _this8.commonHeaders()),
              method: 'GET',
              url: "".concat(_this8.domain, "/conversations/").concat(_this8.conversationId, "/activities?watermark=").concat(_this8.watermark),
              timeout: _this8.timeout
            }).subscribe(function (result) {
              subscriber.next(result);
              setTimeout(function () {
                return trigger$.next(null);
              }, Math.max(0, _this8.pollingInterval - Date.now() + startTimestamp));
            }, function (error) {
              switch (error.status) {
                case 403:
                  _this8.connectionStatus$.next(ConnectionStatus.ExpiredToken);

                  setTimeout(function () {
                    return trigger$.next(null);
                  }, _this8.pollingInterval);
                  break;

                case 404:
                  _this8.connectionStatus$.next(ConnectionStatus.Ended);

                  break;

                default:
                  // propagate the error
                  subscriber.error(error);
                  break;
              }
            });
          }
        });
      });

      return this.checkConnection().flatMap(function (_) {
        return poller$["catch"](function () {
          return _Observable.Observable.empty();
        }).map(function (ajaxResponse) {
          return ajaxResponse.response;
        }).flatMap(function (activityGroup) {
          return _this8.observableFromActivityGroup(activityGroup);
        });
      });
    }
  }, {
    key: "observableFromActivityGroup",
    value: function observableFromActivityGroup(activityGroup) {
      if (activityGroup.watermark) this.watermark = activityGroup.watermark;
      return _Observable.Observable.from(activityGroup.activities, this.services.scheduler);
    }
  }, {
    key: "webSocketActivity$",
    value: function webSocketActivity$() {
      var _this9 = this;

      return this.checkConnection().flatMap(function (_) {
        return _this9.observableWebSocket() // WebSockets can be closed by the server or the browser. In the former case we need to
        // retrieve a new streamUrl. In the latter case we could first retry with the current streamUrl,
        // but it's simpler just to always fetch a new one.
        .retryWhen(function (error$) {
          return error$.delay(_this9.getRetryDelay(), _this9.services.scheduler).mergeMap(function (error) {
            return _this9.reconnectToConversation();
          });
        });
      }).flatMap(function (activityGroup) {
        return _this9.observableFromActivityGroup(activityGroup);
      });
    } // Returns the delay duration in milliseconds

  }, {
    key: "getRetryDelay",
    value: function getRetryDelay() {
      return Math.floor(3000 + this.services.random() * 12000);
    } // Originally we used Observable.webSocket, but it's fairly opinionated and I ended up writing
    // a lot of code to work around their implementation details. Since WebChat is meant to be a reference
    // implementation, I decided roll the below, where the logic is more purposeful. - @billba

  }, {
    key: "observableWebSocket",
    value: function observableWebSocket() {
      var _this10 = this;

      return _Observable.Observable.create(function (subscriber) {
        konsole.log("creating WebSocket", _this10.streamUrl);
        var ws = new _this10.services.WebSocket(_this10.streamUrl);
        var sub;
        var closed;

        ws.onopen = function (open) {
          konsole.log("WebSocket open", open); // Chrome is pretty bad at noticing when a WebSocket connection is broken.
          // If we periodically ping the server with empty messages, it helps Chrome
          // realize when connection breaks, and close the socket. We then throw an
          // error, and that give us the opportunity to attempt to reconnect.

          sub = _Observable.Observable.interval(_this10.timeout, _this10.services.scheduler).subscribe(function (_) {
            try {
              ws.send("");
            } catch (e) {
              konsole.log("Ping error", e);
            }
          });
        };

        ws.onclose = function (close) {
          konsole.log("WebSocket close", close);
          if (sub) sub.unsubscribe(); // RxJS.retryWhen has a bug that would cause "error" signal to be sent after the observable is completed/errored.
          // We need to guard against extraneous "error" signal to workaround the bug.

          closed || subscriber.error(close);
          closed = true;
        };

        ws.onerror = function (error) {
          konsole.log("WebSocket error", error);
          if (sub) sub.unsubscribe(); // RxJS.retryWhen has a bug that would cause "error" signal to be sent after the observable is completed/errored.
          // We need to guard against extraneous "error" signal to workaround the bug.

          closed || subscriber.error(error);
          closed = true;
        };

        ws.onmessage = function (message) {
          return message.data && subscriber.next(JSON.parse(message.data));
        }; // This is the 'unsubscribe' method, which is called when this observable is disposed.
        // When the WebSocket closes itself, we throw an error, and this function is eventually called.
        // When the observable is closed first (e.g. when tearing down a WebChat instance) then
        // we need to manually close the WebSocket.


        return function () {
          if (ws.readyState === 0 || ws.readyState === 1) ws.close();
        };
      });
    }
  }, {
    key: "reconnectToConversation",
    value: function reconnectToConversation() {
      var _this11 = this;

      return this.checkConnection(true).flatMap(function (_) {
        return _this11.services.ajax({
          method: "GET",
          url: "".concat(_this11.domain, "/conversations/").concat(_this11.conversationId, "?watermark=").concat(_this11.watermark),
          timeout: _this11.timeout,
          headers: _objectSpread({
            "Accept": "application/json"
          }, _this11.commonHeaders())
        })["do"](function (result) {
          if (!_this11.secret) _this11.token = result.response.token;
          _this11.streamUrl = result.response.streamUrl;
        }).map(function (_) {
          return null;
        }).retryWhen(function (error$) {
          return error$.mergeMap(function (error) {
            if (error.status === 403) {
              // token has expired. We can't recover from this here, but the embedding
              // website might eventually call reconnect() with a new token and streamUrl.
              _this11.expiredToken();
            } else if (error.status === 404) {
              return _Observable.Observable["throw"](errorConversationEnded, _this11.services.scheduler);
            }

            return _Observable.Observable.of(error, _this11.services.scheduler);
          }).delay(_this11.timeout, _this11.services.scheduler).take(_this11.retries);
        });
      });
    }
  }, {
    key: "commonHeaders",
    value: function commonHeaders() {
      return {
        "Authorization": "Bearer ".concat(this.token),
        "x-ms-bot-agent": this._botAgent
      };
    }
  }, {
    key: "getBotAgent",
    value: function getBotAgent() {
      var customAgent = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
      var clientAgent = 'directlinejs';

      if (customAgent) {
        clientAgent += "; ".concat(customAgent);
      }

      return "".concat(DIRECT_LINE_VERSION, " (").concat(clientAgent, " ").concat("0.14.1", ")");
    }
  }, {
    key: "setUserId",
    value: function setUserId(userId) {
      if (this.connectionStatus$.getValue() === ConnectionStatus.Online) {
        throw new Error('DirectLineJS: It is connected, we cannot set user id.');
      }

      var userIdFromToken = this.parseToken(this.token);

      if (userIdFromToken) {
        return console.warn('DirectLineJS: user id is already set in token, will ignore this user id.');
      }

      if (/^dl_/.test(userId)) {
        return console.warn('DirectLineJS: user id prefixed with "dl_" is reserved and must be embedded into the Direct Line token to prevent forgery.');
      }

      this.userIdOnStartConversation = userId;
    }
  }, {
    key: "parseToken",
    value: function parseToken(token) {
      try {
        var _ref2 = (0, _jwtDecode["default"])(token),
            user = _ref2.user;

        return user;
      } catch (e) {
        if (e instanceof _jwtDecode.InvalidTokenError) {
          return undefined;
        }
      }
    }
  }]);
  return DirectLine;
}();

exports.DirectLine = DirectLine;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9kaXJlY3RMaW5lLnRzIl0sIm5hbWVzIjpbIkRJUkVDVF9MSU5FX1ZFUlNJT04iLCJDb25uZWN0aW9uU3RhdHVzIiwid3JhcEFqYXhXaXRoUmV0cnkiLCJzb3VyY2UiLCJzY2hlZHVsZXIiLCJub3RJbXBsZW1lbnRlZCIsIkVycm9yIiwiaW5uZXIiLCJyZXNwb25zZSQiLCJlcnIiLCJzdGF0dXMiLCJyZXRyeUFmdGVyVmFsdWUiLCJ4aHIiLCJnZXRSZXNwb25zZUhlYWRlciIsInJldHJ5QWZ0ZXIiLCJOdW1iZXIiLCJpc05hTiIsIk9ic2VydmFibGUiLCJ0aW1lciIsImZsYXRNYXAiLCJfIiwib3V0ZXIiLCJ1cmxPclJlcXVlc3QiLCJPYmplY3QiLCJhc3NpZ24iLCJnZXQiLCJ1cmwiLCJoZWFkZXJzIiwicG9zdCIsImJvZHkiLCJwdXQiLCJwYXRjaCIsImdldEpTT04iLCJtYWtlU2VydmljZXMiLCJzZXJ2aWNlcyIsIkFzeW5jU2NoZWR1bGVyIiwiYWpheCIsIldlYlNvY2tldCIsInJhbmRvbSIsIk1hdGgiLCJsaWZldGltZVJlZnJlc2hUb2tlbiIsImludGVydmFsUmVmcmVzaFRva2VuIiwiUE9MTElOR19JTlRFUlZBTF9MT1dFUl9CT1VORCIsImVycm9yRXhwaXJlZFRva2VuIiwiZXJyb3JDb252ZXJzYXRpb25FbmRlZCIsImVycm9yRmFpbGVkVG9Db25uZWN0Iiwia29uc29sZSIsImxvZyIsIm1lc3NhZ2UiLCJvcHRpb25hbFBhcmFtcyIsIndpbmRvdyIsImNvbnNvbGUiLCJEaXJlY3RMaW5lIiwib3B0aW9ucyIsIkJlaGF2aW9yU3ViamVjdCIsIlVuaW5pdGlhbGl6ZWQiLCJzZWNyZXQiLCJ0b2tlbiIsIndlYlNvY2tldCIsInVuZGVmaW5lZCIsImNvbnZlcnNhdGlvblN0YXJ0UHJvcGVydGllcyIsImxvY2FsZSIsInByb3RvdHlwZSIsInRvU3RyaW5nIiwiY2FsbCIsImxvY2FsZU9uU3RhcnRDb252ZXJzYXRpb24iLCJ3YXJuIiwiZG9tYWluIiwiY29udmVyc2F0aW9uSWQiLCJ3YXRlcm1hcmsiLCJzdHJlYW1VcmwiLCJ0aW1lb3V0IiwicmV0cmllcyIsIl9ib3RBZ2VudCIsImdldEJvdEFnZW50IiwiYm90QWdlbnQiLCJwYXJzZWRQb2xsaW5nSW50ZXJ2YWwiLCJwb2xsaW5nSW50ZXJ2YWwiLCJleHBpcmVkVG9rZW5FeGhhdXN0aW9uIiwic2V0Q29ubmVjdGlvblN0YXR1c0ZhbGxiYWNrIiwiRXhwaXJlZFRva2VuIiwiRmFpbGVkVG9Db25uZWN0IiwiYWN0aXZpdHkkIiwid2ViU29ja2V0QWN0aXZpdHkkIiwicG9sbGluZ0dldEFjdGl2aXR5JCIsInNoYXJlIiwib25jZSIsIm9icyIsImNvbm5lY3Rpb25TdGF0dXMkIiwiY29ubmVjdGlvblN0YXR1cyIsIm5leHQiLCJDb25uZWN0aW5nIiwiT25saW5lIiwib2YiLCJzdGFydENvbnZlcnNhdGlvbiIsImNvbnZlcnNhdGlvbiIsInJlZmVyZW5jZUdyYW1tYXJJZCIsInJlZnJlc2hUb2tlbkxvb3AiLCJlcnJvciIsIm1hcCIsImZpbHRlciIsIkVuZGVkIiwidGFrZSIsImNvbm5lY3Rpb25TdGF0dXNGcm9tIiwiY29ubmVjdGlvblN0YXR1c1RvIiwibWF4QXR0ZW1wdHMiLCJhdHRlbXB0cyIsImN1cnJTdGF0dXMiLCJnZXRWYWx1ZSIsInByb3RlY3RlZENvbm5lY3Rpb25TdGF0dXMiLCJtZXRob2QiLCJ1c2VyIiwiaWQiLCJ1c2VySWRPblN0YXJ0Q29udmVyc2F0aW9uIiwiY29tbW9uSGVhZGVycyIsImFqYXhSZXNwb25zZSIsInJlc3BvbnNlIiwicmV0cnlXaGVuIiwiZXJyb3IkIiwibWVyZ2VNYXAiLCJkZWxheSIsInRva2VuUmVmcmVzaFN1YnNjcmlwdGlvbiIsImludGVydmFsIiwicmVmcmVzaFRva2VuIiwic3Vic2NyaWJlIiwiRGF0ZSIsImNoZWNrQ29ubmVjdGlvbiIsImV4cGlyZWRUb2tlbiIsInVuc3Vic2NyaWJlIiwiZSIsIndpdGhDcmVkZW50aWFscyIsInNlc3Npb25JZCIsImNhdGNoRXhwaXJlZFRva2VuIiwiYWN0aXZpdHkiLCJmcm9tIiwidHlwZSIsImF0dGFjaG1lbnRzIiwibGVuZ3RoIiwicG9zdE1lc3NhZ2VXaXRoQXR0YWNobWVudHMiLCJjYXRjaFBvc3RFcnJvciIsImF0dGFjaG1lbnROYW1lcyIsIm1lZGlhIiwibmFtZSIsImNsZWFuc2VkQXR0YWNobWVudHMiLCJhdHRhY2htZW50IiwiaW5kZXgiLCJmb3JtRGF0YSIsIkZvcm1EYXRhIiwiYXBwZW5kIiwiQmxvYiIsIkpTT04iLCJzdHJpbmdpZnkiLCJzdHJpbmciLCJjb250ZW50VXJsIiwib3RoZXJzIiwicmVzcG9uc2VUeXBlIiwiY29udGVudFR5cGUiLCJjb3VudCIsInBvbGxlciQiLCJjcmVhdGUiLCJzdWJzY3JpYmVyIiwidHJpZ2dlciQiLCJzdGFydFRpbWVzdGFtcCIsIm5vdyIsIkFjY2VwdCIsInJlc3VsdCIsInNldFRpbWVvdXQiLCJtYXgiLCJlbXB0eSIsImFjdGl2aXR5R3JvdXAiLCJvYnNlcnZhYmxlRnJvbUFjdGl2aXR5R3JvdXAiLCJhY3Rpdml0aWVzIiwib2JzZXJ2YWJsZVdlYlNvY2tldCIsImdldFJldHJ5RGVsYXkiLCJyZWNvbm5lY3RUb0NvbnZlcnNhdGlvbiIsImZsb29yIiwid3MiLCJzdWIiLCJjbG9zZWQiLCJvbm9wZW4iLCJvcGVuIiwic2VuZCIsIm9uY2xvc2UiLCJjbG9zZSIsIm9uZXJyb3IiLCJvbm1lc3NhZ2UiLCJkYXRhIiwicGFyc2UiLCJyZWFkeVN0YXRlIiwiY3VzdG9tQWdlbnQiLCJjbGllbnRBZ2VudCIsInVzZXJJZCIsInVzZXJJZEZyb21Ub2tlbiIsInBhcnNlVG9rZW4iLCJ0ZXN0IiwiSW52YWxpZFRva2VuRXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFJQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFD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RyxnQkFBZ0IsQ0FBQzJGLE1BQTNELEVBQW1FO0FBQy9ELGNBQU0sSUFBSXRGLEtBQUosQ0FBVSx1REFBVixDQUFOO0FBQ0g7O0FBRUQsVUFBTTBMLGVBQWUsR0FBRyxLQUFLQyxVQUFMLENBQWdCLEtBQUt4SSxLQUFyQixDQUF4Qjs7QUFDQSxVQUFJdUksZUFBSixFQUFxQjtBQUNqQixlQUFPN0ksT0FBTyxDQUFDZSxJQUFSLENBQWEsMEVBQWIsQ0FBUDtBQUNIOztBQUVELFVBQUksT0FBUWdJLElBQVIsQ0FBYUgsTUFBYixDQUFKLEVBQTBCO0FBQ3RCLGVBQU81SSxPQUFPLENBQUNlLElBQVIsQ0FBYSwySEFBYixDQUFQO0FBQ0g7O0FBRUQsV0FBSytDLHlCQUFMLEdBQWlDOEUsTUFBakM7QUFDSDs7OytCQUVrQnRJLEssRUFBZTtBQUM5QixVQUFJO0FBQUEsb0JBQ2lCLDJCQUFzQkEsS0FBdEIsQ0FEakI7QUFBQSxZQUNRc0QsSUFEUixTQUNRQSxJQURSOztBQUVBLGVBQU9BLElBQVA7QUFDSCxPQUhELENBR0UsT0FBT2tCLENBQVAsRUFBVTtBQUNSLFlBQUlBLENBQUMsWUFBWWtFLDRCQUFqQixFQUFvQztBQUNoQyxpQkFBT3hJLFNBQVA7QUFDSDtBQUNKO0FBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBJbiBvcmRlciB0byBrZWVwIGZpbGUgc2l6ZSBkb3duLCBvbmx5IGltcG9ydCB0aGUgcGFydHMgb2YgcnhqcyB0aGF0IHdlIHVzZVxuXG5pbXBvcnQgJ2NvcmUtanMvZmVhdHVyZXMvcHJvbWlzZSc7XG5pbXBvcnQgJ3VybC1zZWFyY2gtcGFyYW1zLXBvbHlmaWxsJztcbmltcG9ydCB7IEFqYXhSZXNwb25zZSwgQWpheENyZWF0aW9uTWV0aG9kLCBBamF4UmVxdWVzdCwgQWpheEVycm9yIH0gZnJvbSAncnhqcy9vYnNlcnZhYmxlL2RvbS9BamF4T2JzZXJ2YWJsZSc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzL0JlaGF2aW9yU3ViamVjdCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcy9PYnNlcnZhYmxlJztcbmltcG9ydCB7IElTY2hlZHVsZXIgfSBmcm9tICdyeGpzL1NjaGVkdWxlcic7XG5pbXBvcnQgeyBTdWJzY3JpYmVyIH0gZnJvbSAncnhqcy9TdWJzY3JpYmVyJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMvU3Vic2NyaXB0aW9uJztcbmltcG9ydCB7IGFzeW5jIGFzIEFzeW5jU2NoZWR1bGVyIH0gZnJvbSAncnhqcy9zY2hlZHVsZXIvYXN5bmMnO1xuaW1wb3J0IGp3dERlY29kZSwgeyBKd3RQYXlsb2FkLCBJbnZhbGlkVG9rZW5FcnJvciB9IGZyb20gJ2p3dC1kZWNvZGUnO1xuXG5pbXBvcnQgJ3J4anMvYWRkL29wZXJhdG9yL2NhdGNoJztcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvY29tYmluZUxhdGVzdCc7XG5pbXBvcnQgJ3J4anMvYWRkL29wZXJhdG9yL2NvdW50JztcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvZGVsYXknO1xuaW1wb3J0ICdyeGpzL2FkZC9vcGVyYXRvci9kbyc7XG5pbXBvcnQgJ3J4anMvYWRkL29wZXJhdG9yL2ZpbHRlcic7XG5pbXBvcnQgJ3J4anMvYWRkL29wZXJhdG9yL21hcCc7XG5pbXBvcnQgJ3J4anMvYWRkL29wZXJhdG9yL21lcmdlTWFwJztcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvY29uY2F0TWFwJztcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvcmV0cnlXaGVuJztcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3Ivc2hhcmUnO1xuaW1wb3J0ICdyeGpzL2FkZC9vcGVyYXRvci90YWtlJztcblxuaW1wb3J0ICdyeGpzL2FkZC9vYnNlcnZhYmxlL2RvbS9hamF4JztcbmltcG9ydCAncnhqcy9hZGQvb2JzZXJ2YWJsZS9lbXB0eSc7XG5pbXBvcnQgJ3J4anMvYWRkL29ic2VydmFibGUvZnJvbSc7XG5pbXBvcnQgJ3J4anMvYWRkL29ic2VydmFibGUvaW50ZXJ2YWwnO1xuaW1wb3J0ICdyeGpzL2FkZC9vYnNlcnZhYmxlL29mJztcbmltcG9ydCAncnhqcy9hZGQvb2JzZXJ2YWJsZS90aHJvdyc7XG5cbmltcG9ydCBkZWR1cGVGaWxlbmFtZXMgZnJvbSAnLi9kZWR1cGVGaWxlbmFtZXMnO1xuaW1wb3J0IHsgb2JqZWN0RXhwcmVzc2lvbiB9IGZyb20gJ0BiYWJlbC90eXBlcyc7XG5cbmltcG9ydCB7IERpcmVjdExpbmVTdHJlYW1pbmcgfSBmcm9tICcuL2RpcmVjdExpbmVTdHJlYW1pbmcnO1xuZXhwb3J0IHsgRGlyZWN0TGluZVN0cmVhbWluZyB9O1xuXG5jb25zdCBESVJFQ1RfTElORV9WRVJTSU9OID0gJ0RpcmVjdExpbmUvMy4wJztcblxuZGVjbGFyZSB2YXIgcHJvY2Vzczoge1xuICAgIGFyY2g6IHN0cmluZztcbiAgICBlbnY6IHtcbiAgICAgICAgVkVSU0lPTjogc3RyaW5nO1xuICAgICAgICBucG1fcGFja2FnZV92ZXJzaW9uOiBzdHJpbmc7XG4gICAgfTtcbiAgICBwbGF0Zm9ybTogc3RyaW5nO1xuICAgIHJlbGVhc2U6IHN0cmluZztcbiAgICB2ZXJzaW9uOiBzdHJpbmc7XG59O1xuXG4vLyBEaXJlY3QgTGluZSAzLjAgdHlwZXNcblxuZXhwb3J0IGludGVyZmFjZSBDb252ZXJzYXRpb24ge1xuICAgIGNvbnZlcnNhdGlvbklkOiBzdHJpbmcsXG4gICAgdG9rZW46IHN0cmluZyxcbiAgICBlVGFnPzogc3RyaW5nLFxuICAgIHN0cmVhbVVybD86IHN0cmluZyxcbiAgICByZWZlcmVuY2VHcmFtbWFySWQ/OiBzdHJpbmdcbn1cblxuZXhwb3J0IHR5cGUgTWVkaWFUeXBlID0gXCJpbWFnZS9wbmdcIiB8IFwiaW1hZ2UvanBnXCIgfCBcImltYWdlL2pwZWdcIiB8IFwiaW1hZ2UvZ2lmXCIgfCBcImltYWdlL3N2Zyt4bWxcIiB8IFwiYXVkaW8vbXBlZ1wiIHwgXCJhdWRpby9tcDRcIiB8IFwidmlkZW8vbXA0XCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWVkaWEge1xuICAgIGNvbnRlbnRUeXBlOiBNZWRpYVR5cGUsXG4gICAgY29udGVudFVybDogc3RyaW5nLFxuICAgIG5hbWU/OiBzdHJpbmcsXG4gICAgdGh1bWJuYWlsVXJsPzogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVW5rbm93bk1lZGlhe1xuICAgIGNvbnRlbnRUeXBlOiBzdHJpbmcsXG4gICAgY29udGVudFVybDogc3RyaW5nLFxuICAgIG5hbWU/OiBzdHJpbmcsXG4gICAgdGh1bWJuYWlsVXJsPzogc3RyaW5nXG59XG5cbmV4cG9ydCB0eXBlIENhcmRBY3Rpb25UeXBlcyA9IFwiY2FsbFwiIHwgXCJkb3dubG9hZEZpbGVcInwgXCJpbUJhY2tcIiB8IFwibWVzc2FnZUJhY2tcIiB8IFwib3BlblVybFwiIHwgXCJwbGF5QXVkaW9cIiB8IFwicGxheVZpZGVvXCIgfCBcInBvc3RCYWNrXCIgfCBcInNpZ25pblwiIHwgXCJzaG93SW1hZ2VcIjtcblxuZXhwb3J0IHR5cGUgQ2FyZEFjdGlvbiA9IENhbGxDYXJkQWN0aW9uIHwgRG93bmxvYWRGaWxlQ2FyZEFjdGlvbiB8IElNQmFja0NhcmRBY3Rpb24gfCBNZXNzYWdlQmFja0NhcmRBY3Rpb24gfCBPcGVuVVJMQ2FyZEFjdGlvbiB8IFBsYXlBdWRpb0NhcmRBY3Rpb24gfCBQbGF5VmlkZW9DYXJkQWN0aW9uIHwgUG9zdEJhY2tDYXJkQWN0aW9uIHwgU2lnbkluQ2FyZEFjdGlvbiB8IFNob3dJbWFnZUNhcmRBY3Rpb247XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2FsbENhcmRBY3Rpb24ge1xuICAgIGltYWdlPzogc3RyaW5nLFxuICAgIHRpdGxlOiBzdHJpbmcsXG4gICAgdHlwZTogXCJjYWxsXCIsXG4gICAgdmFsdWU6IGFueVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIERvd25sb2FkRmlsZUNhcmRBY3Rpb24ge1xuICAgIGltYWdlPzogc3RyaW5nLFxuICAgIHRpdGxlOiBzdHJpbmcsXG4gICAgdHlwZTogXCJkb3dubG9hZEZpbGVcIixcbiAgICB2YWx1ZTogYW55XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSU1CYWNrQ2FyZEFjdGlvbiB7XG4gICAgaW1hZ2U/OiBzdHJpbmcsXG4gICAgdGl0bGU/OiBzdHJpbmcsXG4gICAgdHlwZTogXCJpbUJhY2tcIixcbiAgICB2YWx1ZTogc3RyaW5nXG59XG5cbmV4cG9ydCB0eXBlIE1lc3NhZ2VCYWNrQ2FyZEFjdGlvbiA9IE1lc3NhZ2VCYWNrV2l0aEltYWdlIHwgTWVzc2FnZUJhY2tXaXRoVGl0bGVcblxuZXhwb3J0IGludGVyZmFjZSBNZXNzYWdlQmFja1dpdGhJbWFnZSB7XG4gICAgZGlzcGxheVRleHQ/OiBzdHJpbmcsXG4gICAgaW1hZ2U6IHN0cmluZyxcbiAgICB0ZXh0Pzogc3RyaW5nLFxuICAgIHRpdGxlPzogc3RyaW5nLFxuICAgIHR5cGU6IFwibWVzc2FnZUJhY2tcIixcbiAgICB2YWx1ZT86IGFueVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1lc3NhZ2VCYWNrV2l0aFRpdGxlIHtcbiAgICBkaXNwbGF5VGV4dD86IHN0cmluZyxcbiAgICBpbWFnZT86IHN0cmluZyxcbiAgICB0ZXh0Pzogc3RyaW5nLFxuICAgIHRpdGxlOiBzdHJpbmcsXG4gICAgdHlwZTogXCJtZXNzYWdlQmFja1wiLFxuICAgIHZhbHVlPzogYW55XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlblVSTENhcmRBY3Rpb24ge1xuICAgIGltYWdlPzogc3RyaW5nLFxuICAgIHRpdGxlOiBzdHJpbmcsXG4gICAgdHlwZTogXCJvcGVuVXJsXCIsXG4gICAgdmFsdWU6IGFueVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFBsYXlBdWRpb0NhcmRBY3Rpb24ge1xuICAgIGltYWdlPzogc3RyaW5nLFxuICAgIHRpdGxlOiBzdHJpbmcsXG4gICAgdHlwZTogXCJwbGF5QXVkaW9cIixcbiAgICB2YWx1ZTogYW55XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGxheVZpZGVvQ2FyZEFjdGlvbiB7XG4gICAgaW1hZ2U/OiBzdHJpbmcsXG4gICAgdGl0bGU6IHN0cmluZyxcbiAgICB0eXBlOiBcInBsYXlWaWRlb1wiLFxuICAgIHZhbHVlOiBhbnlcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQb3N0QmFja0NhcmRBY3Rpb24ge1xuICAgIGltYWdlPzogc3RyaW5nLFxuICAgIHRpdGxlPzogc3RyaW5nLFxuICAgIHR5cGU6IFwicG9zdEJhY2tcIixcbiAgICB2YWx1ZTogYW55XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2hvd0ltYWdlQ2FyZEFjdGlvbiB7XG4gICAgaW1hZ2U/OiBzdHJpbmcsXG4gICAgdGl0bGU6IHN0cmluZyxcbiAgICB0eXBlOiBcInNob3dJbWFnZVwiLFxuICAgIHZhbHVlOiBhbnlcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTaWduSW5DYXJkQWN0aW9uIHtcbiAgICBpbWFnZT86IHN0cmluZyxcbiAgICB0aXRsZTogc3RyaW5nLFxuICAgIHR5cGU6IFwic2lnbmluXCIsXG4gICAgdmFsdWU6IGFueVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENhcmRJbWFnZSB7XG4gICAgYWx0Pzogc3RyaW5nLFxuICAgIHVybDogc3RyaW5nLFxuICAgIHRhcD86IENhcmRBY3Rpb25cbn1cblxuZXhwb3J0IGludGVyZmFjZSBIZXJvQ2FyZCB7XG4gICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vdm5kLm1pY3Jvc29mdC5jYXJkLmhlcm9cIixcbiAgICBjb250ZW50OiB7XG4gICAgICAgIHRpdGxlPzogc3RyaW5nLFxuICAgICAgICBzdWJ0aXRsZT86IHN0cmluZyxcbiAgICAgICAgdGV4dD86IHN0cmluZyxcbiAgICAgICAgaW1hZ2VzPzogQ2FyZEltYWdlW10sXG4gICAgICAgIGJ1dHRvbnM/OiBDYXJkQWN0aW9uW10sXG4gICAgICAgIHRhcD86IENhcmRBY3Rpb25cbiAgICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGh1bWJuYWlsIHtcbiAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi92bmQubWljcm9zb2Z0LmNhcmQudGh1bWJuYWlsXCIsXG4gICAgY29udGVudDoge1xuICAgICAgICB0aXRsZT86IHN0cmluZyxcbiAgICAgICAgc3VidGl0bGU/OiBzdHJpbmcsXG4gICAgICAgIHRleHQ/OiBzdHJpbmcsXG4gICAgICAgIGltYWdlcz86IENhcmRJbWFnZVtdLFxuICAgICAgICBidXR0b25zPzogQ2FyZEFjdGlvbltdLFxuICAgICAgICB0YXA/OiBDYXJkQWN0aW9uXG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNpZ25pbiB7XG4gICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vdm5kLm1pY3Jvc29mdC5jYXJkLnNpZ25pblwiLFxuICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgdGV4dD86IHN0cmluZyxcbiAgICAgICAgYnV0dG9ucz86IENhcmRBY3Rpb25bXVxuICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBPQXV0aCB7XG4gICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vdm5kLm1pY3Jvc29mdC5jYXJkLm9hdXRoXCIsXG4gICAgY29udGVudDoge1xuICAgICAgICB0ZXh0Pzogc3RyaW5nLFxuICAgICAgICBjb25uZWN0aW9ubmFtZTogc3RyaW5nLFxuICAgICAgICBidXR0b25zPzogQ2FyZEFjdGlvbltdXG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJlY2VpcHRJdGVtIHtcbiAgICB0aXRsZT86IHN0cmluZyxcbiAgICBzdWJ0aXRsZT86IHN0cmluZyxcbiAgICB0ZXh0Pzogc3RyaW5nLFxuICAgIGltYWdlPzogQ2FyZEltYWdlLFxuICAgIHByaWNlPzogc3RyaW5nLFxuICAgIHF1YW50aXR5Pzogc3RyaW5nLFxuICAgIHRhcD86IENhcmRBY3Rpb25cbn1cblxuZXhwb3J0IGludGVyZmFjZSBSZWNlaXB0IHtcbiAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi92bmQubWljcm9zb2Z0LmNhcmQucmVjZWlwdFwiLFxuICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgdGl0bGU/OiBzdHJpbmcsXG4gICAgICAgIGZhY3RzPzogeyBrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZyB9W10sXG4gICAgICAgIGl0ZW1zPzogUmVjZWlwdEl0ZW1bXSxcbiAgICAgICAgdGFwPzogQ2FyZEFjdGlvbixcbiAgICAgICAgdGF4Pzogc3RyaW5nLFxuICAgICAgICB2YXQ/OiBzdHJpbmcsXG4gICAgICAgIHRvdGFsPzogc3RyaW5nLFxuICAgICAgICBidXR0b25zPzogQ2FyZEFjdGlvbltdXG4gICAgfVxufVxuXG4vLyBEZXByZWNhdGVkIGZvcm1hdCBmb3IgU2t5cGUgY2hhbm5lbHMuIEZvciB0ZXN0aW5nIGxlZ2FjeSBib3RzIGluIEVtdWxhdG9yIG9ubHkuXG5leHBvcnQgaW50ZXJmYWNlIEZsZXhDYXJkIHtcbiAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi92bmQubWljcm9zb2Z0LmNhcmQuZmxleFwiLFxuICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgdGl0bGU/OiBzdHJpbmcsXG4gICAgICAgIHN1YnRpdGxlPzogc3RyaW5nLFxuICAgICAgICB0ZXh0Pzogc3RyaW5nLFxuICAgICAgICBpbWFnZXM/OiBDYXJkSW1hZ2VbXSxcbiAgICAgICAgYnV0dG9ucz86IENhcmRBY3Rpb25bXSxcbiAgICAgICAgYXNwZWN0Pzogc3RyaW5nXG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1ZGlvQ2FyZCB7XG4gICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vdm5kLm1pY3Jvc29mdC5jYXJkLmF1ZGlvXCIsXG4gICAgY29udGVudDoge1xuICAgICAgICB0aXRsZT86IHN0cmluZyxcbiAgICAgICAgc3VidGl0bGU/OiBzdHJpbmcsXG4gICAgICAgIHRleHQ/OiBzdHJpbmcsXG4gICAgICAgIG1lZGlhPzogeyB1cmw6IHN0cmluZywgcHJvZmlsZT86IHN0cmluZyB9W10sXG4gICAgICAgIGJ1dHRvbnM/OiBDYXJkQWN0aW9uW10sXG4gICAgICAgIGF1dG9sb29wPzogYm9vbGVhbixcbiAgICAgICAgYXV0b3N0YXJ0PzogYm9vbGVhblxuICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBWaWRlb0NhcmQge1xuICAgIGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL3ZuZC5taWNyb3NvZnQuY2FyZC52aWRlb1wiLFxuICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgdGl0bGU/OiBzdHJpbmcsXG4gICAgICAgIHN1YnRpdGxlPzogc3RyaW5nLFxuICAgICAgICB0ZXh0Pzogc3RyaW5nLFxuICAgICAgICBtZWRpYT86IHsgdXJsOiBzdHJpbmcsIHByb2ZpbGU/OiBzdHJpbmcgfVtdLFxuICAgICAgICBidXR0b25zPzogQ2FyZEFjdGlvbltdLFxuICAgICAgICBpbWFnZT86IHsgdXJsOiBzdHJpbmcsIGFsdD86IHN0cmluZyB9LFxuICAgICAgICBhdXRvbG9vcD86IGJvb2xlYW4sXG4gICAgICAgIGF1dG9zdGFydD86IGJvb2xlYW5cbiAgICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWRhcHRpdmVDYXJkIHtcbiAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi92bmQubWljcm9zb2Z0LmNhcmQuYWRhcHRpdmVcIixcbiAgICBjb250ZW50OiBhbnk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQW5pbWF0aW9uQ2FyZCB7XG4gICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vdm5kLm1pY3Jvc29mdC5jYXJkLmFuaW1hdGlvblwiLFxuICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgdGl0bGU/OiBzdHJpbmcsXG4gICAgICAgIHN1YnRpdGxlPzogc3RyaW5nLFxuICAgICAgICB0ZXh0Pzogc3RyaW5nLFxuICAgICAgICBtZWRpYT86IHsgdXJsOiBzdHJpbmcsIHByb2ZpbGU/OiBzdHJpbmcgfVtdLFxuICAgICAgICBidXR0b25zPzogQ2FyZEFjdGlvbltdLFxuICAgICAgICBpbWFnZT86IHsgdXJsOiBzdHJpbmcsIGFsdD86IHN0cmluZyB9LFxuICAgICAgICBhdXRvbG9vcD86IGJvb2xlYW4sXG4gICAgICAgIGF1dG9zdGFydD86IGJvb2xlYW5cbiAgICB9XG59XG5cbmV4cG9ydCB0eXBlIEtub3duTWVkaWEgPSBNZWRpYSB8IEhlcm9DYXJkIHwgVGh1bWJuYWlsIHwgU2lnbmluIHwgT0F1dGggfCBSZWNlaXB0IHwgQXVkaW9DYXJkIHwgVmlkZW9DYXJkIHwgQW5pbWF0aW9uQ2FyZCB8IEZsZXhDYXJkIHwgQWRhcHRpdmVDYXJkO1xuZXhwb3J0IHR5cGUgQXR0YWNobWVudCA9IEtub3duTWVkaWEgfCBVbmtub3duTWVkaWE7XG5cbmV4cG9ydCB0eXBlIFVzZXJSb2xlID0gXCJib3RcIiB8IFwiY2hhbm5lbFwiIHwgXCJ1c2VyXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXNlciB7XG4gICAgaWQ6IHN0cmluZyxcbiAgICBuYW1lPzogc3RyaW5nLFxuICAgIGljb25Vcmw/OiBzdHJpbmcsXG4gICAgcm9sZT86IFVzZXJSb2xlXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUFjdGl2aXR5IHtcbiAgICB0eXBlOiBzdHJpbmcsXG4gICAgY2hhbm5lbERhdGE/OiBhbnksXG4gICAgY2hhbm5lbElkPzogc3RyaW5nLFxuICAgIGNvbnZlcnNhdGlvbj86IHsgaWQ6IHN0cmluZyB9LFxuICAgIGVUYWc/OiBzdHJpbmcsXG4gICAgZnJvbTogVXNlcixcbiAgICBpZD86IHN0cmluZyxcbiAgICB0aW1lc3RhbXA/OiBzdHJpbmdcbn1cblxuZXhwb3J0IHR5cGUgQXR0YWNobWVudExheW91dCA9IFwibGlzdFwiIHwgXCJjYXJvdXNlbFwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIE1lc3NhZ2UgZXh0ZW5kcyBJQWN0aXZpdHkge1xuICAgIHR5cGU6IFwibWVzc2FnZVwiLFxuICAgIHRleHQ/OiBzdHJpbmcsXG4gICAgbG9jYWxlPzogc3RyaW5nLFxuICAgIHRleHRGb3JtYXQ/OiBcInBsYWluXCIgfCBcIm1hcmtkb3duXCIgfCBcInhtbFwiLFxuICAgIGF0dGFjaG1lbnRMYXlvdXQ/OiBBdHRhY2htZW50TGF5b3V0LFxuICAgIGF0dGFjaG1lbnRzPzogQXR0YWNobWVudFtdLFxuICAgIGVudGl0aWVzPzogYW55W10sXG4gICAgc3VnZ2VzdGVkQWN0aW9ucz86IHsgYWN0aW9uczogQ2FyZEFjdGlvbltdLCB0bz86IHN0cmluZ1tdIH0sXG4gICAgc3BlYWs/OiBzdHJpbmcsXG4gICAgaW5wdXRIaW50Pzogc3RyaW5nLFxuICAgIHZhbHVlPzogb2JqZWN0XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVHlwaW5nIGV4dGVuZHMgSUFjdGl2aXR5IHtcbiAgICB0eXBlOiBcInR5cGluZ1wiXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXZlbnRBY3Rpdml0eSBleHRlbmRzIElBY3Rpdml0eSB7XG4gICAgdHlwZTogXCJldmVudFwiLFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICB2YWx1ZTogYW55XG59XG5cbmV4cG9ydCB0eXBlIEFjdGl2aXR5ID0gTWVzc2FnZSB8IFR5cGluZyB8IEV2ZW50QWN0aXZpdHk7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWN0aXZpdHlHcm91cCB7XG4gICAgYWN0aXZpdGllczogQWN0aXZpdHlbXSxcbiAgICB3YXRlcm1hcms6IHN0cmluZ1xufVxuXG4vLyBUaGVzZSB0eXBlcyBhcmUgc3BlY2lmaWMgdG8gdGhpcyBjbGllbnQgbGlicmFyeSwgbm90IHRvIERpcmVjdCBMaW5lIDMuMFxuXG5leHBvcnQgZW51bSBDb25uZWN0aW9uU3RhdHVzIHtcbiAgICBVbmluaXRpYWxpemVkLCAgICAgICAgICAgICAgLy8gdGhlIHN0YXR1cyB3aGVuIHRoZSBEaXJlY3RMaW5lIG9iamVjdCBpcyBmaXJzdCBjcmVhdGVkL2NvbnN0cnVjdGVkXG4gICAgQ29ubmVjdGluZywgICAgICAgICAgICAgICAgIC8vIGN1cnJlbnRseSB0cnlpbmcgdG8gY29ubmVjdCB0byB0aGUgY29udmVyc2F0aW9uXG4gICAgT25saW5lLCAgICAgICAgICAgICAgICAgICAgIC8vIHN1Y2Nlc3NmdWxseSBjb25uZWN0ZWQgdG8gdGhlIGNvbnZlcnNhdGlvbi4gQ29ubmVjdGlvbiBpcyBoZWFsdGh5IHNvIGZhciBhcyB3ZSBrbm93LlxuICAgIEV4cGlyZWRUb2tlbiwgICAgICAgICAgICAgICAvLyBsYXN0IG9wZXJhdGlvbiBlcnJvcmVkIG91dCB3aXRoIGFuIGV4cGlyZWQgdG9rZW4uIFBvc3NpYmx5IHdhaXRpbmcgZm9yIHNvbWVvbmUgdG8gc3VwcGx5IGEgbmV3IG9uZS5cbiAgICBGYWlsZWRUb0Nvbm5lY3QsICAgICAgICAgICAgLy8gdGhlIGluaXRpYWwgYXR0ZW1wdCB0byBjb25uZWN0IHRvIHRoZSBjb252ZXJzYXRpb24gZmFpbGVkLiBObyByZWNvdmVyeSBwb3NzaWJsZS5cbiAgICBFbmRlZCAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGJvdCBlbmRlZCB0aGUgY29udmVyc2F0aW9uXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGlyZWN0TGluZU9wdGlvbnMge1xuICAgIHNlY3JldD86IHN0cmluZyxcbiAgICB0b2tlbj86IHN0cmluZyxcbiAgICBjb252ZXJzYXRpb25JZD86IHN0cmluZyxcbiAgICB3YXRlcm1hcms/OiBzdHJpbmcsXG4gICAgZG9tYWluPzogc3RyaW5nLFxuICAgIHdlYlNvY2tldD86IGJvb2xlYW4sXG4gICAgcG9sbGluZ0ludGVydmFsPzogbnVtYmVyLFxuICAgIHN0cmVhbVVybD86IHN0cmluZyxcbiAgICB0aW1lb3V0PzogbnVtYmVyLFxuICAgIC8vIEF0dGFjaGVkIHRvIGFsbCByZXF1ZXN0cyB0byBpZGVudGlmeSByZXF1ZXN0aW5nIGFnZW50LlxuICAgIGJvdEFnZW50Pzogc3RyaW5nLFxuICAgIGNvbnZlcnNhdGlvblN0YXJ0UHJvcGVydGllcz86IGFueVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlcnZpY2VzIHtcbiAgICBzY2hlZHVsZXI6IElTY2hlZHVsZXI7XG4gICAgV2ViU29ja2V0OiB0eXBlb2YgV2ViU29ja2V0O1xuICAgIGFqYXg6IEFqYXhDcmVhdGlvbk1ldGhvZDtcbiAgICByYW5kb206ICgpID0+IG51bWJlcjtcbn1cblxuY29uc3Qgd3JhcEFqYXhXaXRoUmV0cnkgPSAoc291cmNlOiBBamF4Q3JlYXRpb25NZXRob2QsIHNjaGVkdWxlcjogSVNjaGVkdWxlcik6IEFqYXhDcmVhdGlvbk1ldGhvZCA9PntcblxuICAgIGNvbnN0IG5vdEltcGxlbWVudGVkID0gKCk6IG5ldmVyID0+IHsgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTsgfTtcblxuICAgIGNvbnN0IGlubmVyID0gKHJlc3BvbnNlJCA6IE9ic2VydmFibGU8QWpheFJlc3BvbnNlPikgPT4ge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UkXG4gICAgICAgIC5jYXRjaDxBamF4UmVzcG9uc2UsIEFqYXhSZXNwb25zZT4oKGVycikgPT4ge1xuICAgICAgICAgICAgaWYoZXJyLnN0YXR1cyA9PT0gNDI5KXtcbiAgICAgICAgICAgICAgICBjb25zdCByZXRyeUFmdGVyVmFsdWUgPSBlcnIueGhyLmdldFJlc3BvbnNlSGVhZGVyKCdSZXRyeS1BZnRlcicpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJldHJ5QWZ0ZXIgPSBOdW1iZXIocmV0cnlBZnRlclZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZighaXNOYU4ocmV0cnlBZnRlcikpe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS50aW1lcihyZXRyeUFmdGVyLCBzY2hlZHVsZXIpXG4gICAgICAgICAgICAgICAgICAgIC5mbGF0TWFwKF8gPT4gT2JzZXJ2YWJsZS50aHJvdyhlcnIsIHNjaGVkdWxlcikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUudGhyb3coZXJyLCBzY2hlZHVsZXIpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgY29uc3Qgb3V0ZXIgPSAodXJsT3JSZXF1ZXN0OiBzdHJpbmd8IEFqYXhSZXF1ZXN0KSA9PiB7XG4gICAgICAgIHJldHVybiBpbm5lcihzb3VyY2UodXJsT3JSZXF1ZXN0KSk7XG4gICAgfTtcblxuICAgIHJldHVybiBPYmplY3QuYXNzaWduKG91dGVyLCB7XG4gICAgICAgIGdldDogKHVybDogc3RyaW5nLCBoZWFkZXJzPzogT2JqZWN0KTogT2JzZXJ2YWJsZTxBamF4UmVzcG9uc2U+ID0+IG5vdEltcGxlbWVudGVkKCksXG4gICAgICAgIHBvc3Q6ICh1cmw6IHN0cmluZywgYm9keT86IGFueSwgaGVhZGVycz86IE9iamVjdCk6IE9ic2VydmFibGU8QWpheFJlc3BvbnNlPiA9PiBub3RJbXBsZW1lbnRlZCgpLFxuICAgICAgICBwdXQ6ICh1cmw6IHN0cmluZywgYm9keT86IGFueSwgaGVhZGVycz86IE9iamVjdCk6IE9ic2VydmFibGU8QWpheFJlc3BvbnNlPiA9PiBub3RJbXBsZW1lbnRlZCgpLFxuICAgICAgICBwYXRjaDogKHVybDogc3RyaW5nLCBib2R5PzogYW55LCBoZWFkZXJzPzogT2JqZWN0KTogT2JzZXJ2YWJsZTxBamF4UmVzcG9uc2U+ID0+IG5vdEltcGxlbWVudGVkKCksXG4gICAgICAgIGRlbGV0ZTogKHVybDogc3RyaW5nLCBoZWFkZXJzPzogT2JqZWN0KTogT2JzZXJ2YWJsZTxBamF4UmVzcG9uc2U+ID0+IG5vdEltcGxlbWVudGVkKCksXG4gICAgICAgIGdldEpTT046IDxUPih1cmw6IHN0cmluZywgaGVhZGVycz86IE9iamVjdCk6IE9ic2VydmFibGU8VD4gPT4gbm90SW1wbGVtZW50ZWQoKVxuICAgIH0pO1xufVxuXG5jb25zdCBtYWtlU2VydmljZXMgPSAoc2VydmljZXM6IFBhcnRpYWw8U2VydmljZXM+KTogU2VydmljZXMgPT4ge1xuICAgIGNvbnN0IHNjaGVkdWxlciA9IHNlcnZpY2VzLnNjaGVkdWxlciB8fCBBc3luY1NjaGVkdWxlcjtcbiAgICByZXR1cm4ge1xuICAgICAgICBzY2hlZHVsZXIsXG4gICAgICAgIGFqYXg6IHdyYXBBamF4V2l0aFJldHJ5KHNlcnZpY2VzLmFqYXggfHwgT2JzZXJ2YWJsZS5hamF4LCBzY2hlZHVsZXIpLFxuICAgICAgICBXZWJTb2NrZXQ6IHNlcnZpY2VzLldlYlNvY2tldCB8fCBXZWJTb2NrZXQsXG4gICAgICAgIHJhbmRvbTogc2VydmljZXMucmFuZG9tIHx8IE1hdGgucmFuZG9tLFxuICAgIH1cbn1cblxuY29uc3QgbGlmZXRpbWVSZWZyZXNoVG9rZW4gPSAzMCAqIDYwICogMTAwMDtcbmNvbnN0IGludGVydmFsUmVmcmVzaFRva2VuID0gbGlmZXRpbWVSZWZyZXNoVG9rZW4gLyAyO1xuXG5jb25zdCBQT0xMSU5HX0lOVEVSVkFMX0xPV0VSX0JPVU5EOiBudW1iZXIgPSAyMDA7IC8vbXNcblxuY29uc3QgZXJyb3JFeHBpcmVkVG9rZW4gPSBuZXcgRXJyb3IoXCJleHBpcmVkIHRva2VuXCIpO1xuY29uc3QgZXJyb3JDb252ZXJzYXRpb25FbmRlZCA9IG5ldyBFcnJvcihcImNvbnZlcnNhdGlvbiBlbmRlZFwiKTtcbmNvbnN0IGVycm9yRmFpbGVkVG9Db25uZWN0ID0gbmV3IEVycm9yKFwiZmFpbGVkIHRvIGNvbm5lY3RcIik7XG5cbmNvbnN0IGtvbnNvbGUgPSB7XG4gICAgbG9nOiAobWVzc2FnZT86IGFueSwgLi4uIG9wdGlvbmFsUGFyYW1zOiBhbnlbXSkgPT4ge1xuICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgKHdpbmRvdyBhcyBhbnkpW1wiYm90Y2hhdERlYnVnXCJdICYmIG1lc3NhZ2UpXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhtZXNzYWdlLCAuLi4gb3B0aW9uYWxQYXJhbXMpO1xuICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJQm90Q29ubmVjdGlvbiB7XG4gICAgY29ubmVjdGlvblN0YXR1cyQ6IEJlaGF2aW9yU3ViamVjdDxDb25uZWN0aW9uU3RhdHVzPixcbiAgICBhY3Rpdml0eSQ6IE9ic2VydmFibGU8QWN0aXZpdHk+LFxuICAgIGVuZCgpOiB2b2lkLFxuICAgIHJlZmVyZW5jZUdyYW1tYXJJZD86IHN0cmluZyxcbiAgICBwb3N0QWN0aXZpdHkoYWN0aXZpdHk6IEFjdGl2aXR5KTogT2JzZXJ2YWJsZTxzdHJpbmc+LFxuICAgIGdldFNlc3Npb25JZD8gOiAoKSA9PiBPYnNlcnZhYmxlPHN0cmluZz5cbn1cblxuZXhwb3J0IGNsYXNzIERpcmVjdExpbmUgaW1wbGVtZW50cyBJQm90Q29ubmVjdGlvbiB7XG4gICAgcHVibGljIGNvbm5lY3Rpb25TdGF0dXMkID0gbmV3IEJlaGF2aW9yU3ViamVjdChDb25uZWN0aW9uU3RhdHVzLlVuaW5pdGlhbGl6ZWQpO1xuICAgIHB1YmxpYyBhY3Rpdml0eSQ6IE9ic2VydmFibGU8QWN0aXZpdHk+O1xuXG4gICAgcHJpdmF0ZSBkb21haW4gPSBcImh0dHBzOi8vZGlyZWN0bGluZS5ib3RmcmFtZXdvcmsuY29tL3YzL2RpcmVjdGxpbmVcIjtcbiAgICBwcml2YXRlIHdlYlNvY2tldDogYm9vbGVhbjtcblxuICAgIHByaXZhdGUgY29udmVyc2F0aW9uSWQ6IHN0cmluZztcbiAgICBwcml2YXRlIGV4cGlyZWRUb2tlbkV4aGF1c3Rpb246IEZ1bmN0aW9uO1xuICAgIHByaXZhdGUgc2VjcmV0OiBzdHJpbmc7XG4gICAgcHJpdmF0ZSB0b2tlbjogc3RyaW5nO1xuICAgIHByaXZhdGUgd2F0ZXJtYXJrID0gJyc7XG4gICAgcHJpdmF0ZSBzdHJlYW1Vcmw6IHN0cmluZztcbiAgICBwcml2YXRlIF9ib3RBZ2VudCA9ICcnO1xuICAgIHByaXZhdGUgc2VydmljZXM6IFNlcnZpY2VzO1xuICAgIHByaXZhdGUgX3VzZXJBZ2VudDogc3RyaW5nO1xuICAgIHB1YmxpYyByZWZlcmVuY2VHcmFtbWFySWQ6IHN0cmluZztcbiAgICBwcml2YXRlIHRpbWVvdXQgPSAyMCAqIDEwMDA7XG4gICAgcHJpdmF0ZSByZXRyaWVzOiBudW1iZXI7XG5cbiAgICBwcml2YXRlIGxvY2FsZU9uU3RhcnRDb252ZXJzYXRpb246IHN0cmluZztcbiAgICBwcml2YXRlIHVzZXJJZE9uU3RhcnRDb252ZXJzYXRpb246IHN0cmluZztcblxuICAgIHByaXZhdGUgcG9sbGluZ0ludGVydmFsOiBudW1iZXIgPSAxMDAwOyAvL21zXG5cbiAgICBwcml2YXRlIHRva2VuUmVmcmVzaFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuXG4gICAgY29uc3RydWN0b3Iob3B0aW9uczogRGlyZWN0TGluZU9wdGlvbnMgJiBQYXJ0aWFsPFNlcnZpY2VzPikge1xuICAgICAgICB0aGlzLnNlY3JldCA9IG9wdGlvbnMuc2VjcmV0O1xuICAgICAgICB0aGlzLnRva2VuID0gb3B0aW9ucy5zZWNyZXQgfHwgb3B0aW9ucy50b2tlbjtcbiAgICAgICAgdGhpcy53ZWJTb2NrZXQgPSAob3B0aW9ucy53ZWJTb2NrZXQgPT09IHVuZGVmaW5lZCA/IHRydWUgOiBvcHRpb25zLndlYlNvY2tldCkgJiYgdHlwZW9mIFdlYlNvY2tldCAhPT0gJ3VuZGVmaW5lZCcgJiYgV2ViU29ja2V0ICE9PSB1bmRlZmluZWQ7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMuY29udmVyc2F0aW9uU3RhcnRQcm9wZXJ0aWVzICYmIG9wdGlvbnMuY29udmVyc2F0aW9uU3RhcnRQcm9wZXJ0aWVzLmxvY2FsZSkge1xuICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvcHRpb25zLmNvbnZlcnNhdGlvblN0YXJ0UHJvcGVydGllcy5sb2NhbGUpID09PSAnW29iamVjdCBTdHJpbmddJykge1xuICAgICAgICAgICAgICAgIHRoaXMubG9jYWxlT25TdGFydENvbnZlcnNhdGlvbiA9IG9wdGlvbnMuY29udmVyc2F0aW9uU3RhcnRQcm9wZXJ0aWVzLmxvY2FsZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdEaXJlY3RMaW5lSlM6IGNvbnZlcnNhdGlvblN0YXJ0UHJvcGVydGllcy5sb2NhbGUgd2FzIGlnbm9yZWQ6IHRoZSBsb2NhbGUgbmFtZSBtYXkgYmUgYSBCQ1AgNDcgbGFuZ3VhZ2UgdGFnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy5kb21haW4pIHtcbiAgICAgICAgICAgIHRoaXMuZG9tYWluID0gb3B0aW9ucy5kb21haW47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy5jb252ZXJzYXRpb25JZCkge1xuICAgICAgICAgICAgdGhpcy5jb252ZXJzYXRpb25JZCA9IG9wdGlvbnMuY29udmVyc2F0aW9uSWQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy53YXRlcm1hcmspIHtcbiAgICAgICAgICAgIHRoaXMud2F0ZXJtYXJrID0gIG9wdGlvbnMud2F0ZXJtYXJrO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMuc3RyZWFtVXJsKSB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy50b2tlbiAmJiBvcHRpb25zLmNvbnZlcnNhdGlvbklkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdHJlYW1VcmwgPSBvcHRpb25zLnN0cmVhbVVybDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdEaXJlY3RMaW5lSlM6IHN0cmVhbVVybCB3YXMgaWdub3JlZDogeW91IG5lZWQgdG8gcHJvdmlkZSBhIHRva2VuIGFuZCBhIGNvbnZlcnNhdGlvbmlkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy50aW1lb3V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudGltZW91dCA9IG9wdGlvbnMudGltZW91dDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmV0cmllcyA9IChsaWZldGltZVJlZnJlc2hUb2tlbiAtIGludGVydmFsUmVmcmVzaFRva2VuKSAvIHRoaXMudGltZW91dDtcblxuICAgICAgICB0aGlzLl9ib3RBZ2VudCA9IHRoaXMuZ2V0Qm90QWdlbnQob3B0aW9ucy5ib3RBZ2VudCk7XG5cbiAgICAgICAgdGhpcy5zZXJ2aWNlcyA9IG1ha2VTZXJ2aWNlcyhvcHRpb25zKTtcblxuICAgICAgICBjb25zdCBwYXJzZWRQb2xsaW5nSW50ZXJ2YWwgPSB+fm9wdGlvbnMucG9sbGluZ0ludGVydmFsO1xuXG4gICAgICAgIGlmIChwYXJzZWRQb2xsaW5nSW50ZXJ2YWwgPCBQT0xMSU5HX0lOVEVSVkFMX0xPV0VSX0JPVU5EKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMucG9sbGluZ0ludGVydmFsICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgRGlyZWN0TGluZUpTOiBwcm92aWRlZCBwb2xsaW5nSW50ZXJ2YWwgKCR7IG9wdGlvbnMucG9sbGluZ0ludGVydmFsIH0pIGlzIHVuZGVyIGxvd2VyIGJvdW5kICgyMDBtcyksIHVzaW5nIGRlZmF1bHQgb2YgMTAwMG1zYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnBvbGxpbmdJbnRlcnZhbCA9IHBhcnNlZFBvbGxpbmdJbnRlcnZhbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZXhwaXJlZFRva2VuRXhoYXVzdGlvbiA9IHRoaXMuc2V0Q29ubmVjdGlvblN0YXR1c0ZhbGxiYWNrKFxuICAgICAgICAgICAgQ29ubmVjdGlvblN0YXR1cy5FeHBpcmVkVG9rZW4sXG4gICAgICAgICAgICBDb25uZWN0aW9uU3RhdHVzLkZhaWxlZFRvQ29ubmVjdCxcbiAgICAgICAgICAgIDVcbiAgICAgICAgKTtcblxuICAgICAgICB0aGlzLmFjdGl2aXR5JCA9ICh0aGlzLndlYlNvY2tldFxuICAgICAgICAgICAgPyB0aGlzLndlYlNvY2tldEFjdGl2aXR5JCgpXG4gICAgICAgICAgICA6IHRoaXMucG9sbGluZ0dldEFjdGl2aXR5JCgpXG4gICAgICAgICkuc2hhcmUoKTtcbiAgICB9XG5cbiAgICAvLyBFdmVyeSB0aW1lIHdlJ3JlIGFib3V0IHRvIG1ha2UgYSBEaXJlY3QgTGluZSBSRVNUIGNhbGwsIHdlIGNhbGwgdGhpcyBmaXJzdCB0byBzZWUgY2hlY2sgdGhlIGN1cnJlbnQgY29ubmVjdGlvbiBzdGF0dXMuXG4gICAgLy8gRWl0aGVyIHRocm93cyBhbiBlcnJvciAoaW5kaWNhdGluZyBhbiBlcnJvciBzdGF0ZSkgb3IgZW1pdHMgYSBudWxsLCBpbmRpY2F0aW5nIGEgKHByZXN1bWFibHkpIGhlYWx0aHkgY29ubmVjdGlvblxuICAgIHByaXZhdGUgY2hlY2tDb25uZWN0aW9uKG9uY2UgPSBmYWxzZSkge1xuICAgICAgICBsZXQgb2JzID0gIHRoaXMuY29ubmVjdGlvblN0YXR1cyRcbiAgICAgICAgLmZsYXRNYXAoY29ubmVjdGlvblN0YXR1cyA9PiB7XG4gICAgICAgICAgICBpZiAoY29ubmVjdGlvblN0YXR1cyA9PT0gQ29ubmVjdGlvblN0YXR1cy5VbmluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdHVzJC5uZXh0KENvbm5lY3Rpb25TdGF0dXMuQ29ubmVjdGluZyk7XG5cbiAgICAgICAgICAgICAgICAvL2lmIHRva2VuIGFuZCBzdHJlYW1VcmwgYXJlIGRlZmluZWQgaXQgbWVhbnMgcmVjb25uZWN0IGhhcyBhbHJlYWR5IGJlZW4gZG9uZS4gU2tpcHBpbmcgaXQuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudG9rZW4gJiYgdGhpcy5zdHJlYW1VcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdHVzJC5uZXh0KENvbm5lY3Rpb25TdGF0dXMuT25saW5lKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUub2YoY29ubmVjdGlvblN0YXR1cywgdGhpcy5zZXJ2aWNlcy5zY2hlZHVsZXIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXJ0Q29udmVyc2F0aW9uKCkuZG8oY29udmVyc2F0aW9uID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29udmVyc2F0aW9uSWQgPSBjb252ZXJzYXRpb24uY29udmVyc2F0aW9uSWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRva2VuID0gdGhpcy5zZWNyZXQgfHwgY29udmVyc2F0aW9uLnRva2VuO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHJlYW1VcmwgPSBjb252ZXJzYXRpb24uc3RyZWFtVXJsO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWZlcmVuY2VHcmFtbWFySWQgPSBjb252ZXJzYXRpb24ucmVmZXJlbmNlR3JhbW1hcklkO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnNlY3JldClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2hUb2tlbkxvb3AoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdHVzJC5uZXh0KENvbm5lY3Rpb25TdGF0dXMuT25saW5lKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdHVzJC5uZXh0KENvbm5lY3Rpb25TdGF0dXMuRmFpbGVkVG9Db25uZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLm1hcChfID0+IGNvbm5lY3Rpb25TdGF0dXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLm9mKGNvbm5lY3Rpb25TdGF0dXMsIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmZpbHRlcihjb25uZWN0aW9uU3RhdHVzID0+IGNvbm5lY3Rpb25TdGF0dXMgIT0gQ29ubmVjdGlvblN0YXR1cy5VbmluaXRpYWxpemVkICYmIGNvbm5lY3Rpb25TdGF0dXMgIT0gQ29ubmVjdGlvblN0YXR1cy5Db25uZWN0aW5nKVxuICAgICAgICAuZmxhdE1hcChjb25uZWN0aW9uU3RhdHVzID0+IHtcbiAgICAgICAgICAgIHN3aXRjaCAoY29ubmVjdGlvblN0YXR1cykge1xuICAgICAgICAgICAgICAgIGNhc2UgQ29ubmVjdGlvblN0YXR1cy5FbmRlZDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUudGhyb3coZXJyb3JDb252ZXJzYXRpb25FbmRlZCwgdGhpcy5zZXJ2aWNlcy5zY2hlZHVsZXIpO1xuXG4gICAgICAgICAgICAgICAgY2FzZSBDb25uZWN0aW9uU3RhdHVzLkZhaWxlZFRvQ29ubmVjdDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUudGhyb3coZXJyb3JGYWlsZWRUb0Nvbm5lY3QsIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKTtcblxuICAgICAgICAgICAgICAgIGNhc2UgQ29ubmVjdGlvblN0YXR1cy5FeHBpcmVkVG9rZW46XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLm9mKGNvbm5lY3Rpb25TdGF0dXMsIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKTtcblxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLm9mKGNvbm5lY3Rpb25TdGF0dXMsIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4gb25jZSA/IG9icy50YWtlKDEpIDogb2JzO1xuICAgIH1cblxuICAgIHNldENvbm5lY3Rpb25TdGF0dXNGYWxsYmFjayhcbiAgICAgICAgY29ubmVjdGlvblN0YXR1c0Zyb206IENvbm5lY3Rpb25TdGF0dXMsXG4gICAgICAgIGNvbm5lY3Rpb25TdGF0dXNUbzogQ29ubmVjdGlvblN0YXR1cyxcbiAgICAgICAgbWF4QXR0ZW1wdHMgPSA1XG4gICAgKSB7XG4gICAgICAgIG1heEF0dGVtcHRzLS07XG4gICAgICAgIGxldCBhdHRlbXB0cyA9IDA7XG4gICAgICAgIGxldCBjdXJyU3RhdHVzID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIChzdGF0dXM6IENvbm5lY3Rpb25TdGF0dXMpOiBDb25uZWN0aW9uU3RhdHVzID0+IHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IGNvbm5lY3Rpb25TdGF0dXNGcm9tICYmIGN1cnJTdGF0dXMgPT09IHN0YXR1cyAmJiBhdHRlbXB0cyA+PSBtYXhBdHRlbXB0cykge1xuICAgICAgICAgICAgICAgIGF0dGVtcHRzID0gMFxuICAgICAgICAgICAgICAgIHJldHVybiBjb25uZWN0aW9uU3RhdHVzVG87XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhdHRlbXB0cysrO1xuICAgICAgICAgICAgY3VyclN0YXR1cyA9IHN0YXR1cztcbiAgICAgICAgICAgIHJldHVybiBzdGF0dXM7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBleHBpcmVkVG9rZW4oKSB7XG4gICAgICAgIGNvbnN0IGNvbm5lY3Rpb25TdGF0dXMgPSB0aGlzLmNvbm5lY3Rpb25TdGF0dXMkLmdldFZhbHVlKCk7XG4gICAgICAgIGlmIChjb25uZWN0aW9uU3RhdHVzICE9IENvbm5lY3Rpb25TdGF0dXMuRW5kZWQgJiYgY29ubmVjdGlvblN0YXR1cyAhPSBDb25uZWN0aW9uU3RhdHVzLkZhaWxlZFRvQ29ubmVjdClcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cyQubmV4dChDb25uZWN0aW9uU3RhdHVzLkV4cGlyZWRUb2tlbik7XG5cbiAgICAgICAgY29uc3QgcHJvdGVjdGVkQ29ubmVjdGlvblN0YXR1cyA9IHRoaXMuZXhwaXJlZFRva2VuRXhoYXVzdGlvbih0aGlzLmNvbm5lY3Rpb25TdGF0dXMkLmdldFZhbHVlKCkpO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0dXMkLm5leHQocHJvdGVjdGVkQ29ubmVjdGlvblN0YXR1cyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGFydENvbnZlcnNhdGlvbigpIHtcbiAgICAgICAgLy9pZiBjb252ZXJzYXRpb25pZCBpcyBzZXQgaGVyZSwgaXQgbWVhbnMgd2UgbmVlZCB0byBjYWxsIHRoZSByZWNvbm5lY3QgYXBpLCBlbHNlIGl0IGlzIGEgbmV3IGNvbnZlcnNhdGlvblxuICAgICAgICBjb25zdCB1cmwgPSB0aGlzLmNvbnZlcnNhdGlvbklkXG4gICAgICAgICAgICA/IGAke3RoaXMuZG9tYWlufS9jb252ZXJzYXRpb25zLyR7dGhpcy5jb252ZXJzYXRpb25JZH0/d2F0ZXJtYXJrPSR7dGhpcy53YXRlcm1hcmt9YFxuICAgICAgICAgICAgOiBgJHt0aGlzLmRvbWFpbn0vY29udmVyc2F0aW9uc2A7XG4gICAgICAgIGNvbnN0IG1ldGhvZCA9IHRoaXMuY29udmVyc2F0aW9uSWQgPyBcIkdFVFwiIDogXCJQT1NUXCI7XG4gICAgICAgIGNvbnN0IGJvZHkgPSB0aGlzLmNvbnZlcnNhdGlvbklkXG4gICAgICAgICAgICA/IHVuZGVmaW5lZFxuICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgICAgICBpZDogdGhpcy51c2VySWRPblN0YXJ0Q29udmVyc2F0aW9uXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBsb2NhbGU6IHRoaXMubG9jYWxlT25TdGFydENvbnZlcnNhdGlvblxuICAgICAgICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdGhpcy5zZXJ2aWNlcy5hamF4KHtcbiAgICAgICAgICAgIG1ldGhvZCxcbiAgICAgICAgICAgIHVybCxcbiAgICAgICAgICAgIGJvZHksXG4gICAgICAgICAgICB0aW1lb3V0OiB0aGlzLnRpbWVvdXQsXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgXCJBY2NlcHRcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICAgICAgLi4udGhpcy5jb21tb25IZWFkZXJzKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbi8vICAgICAgLmRvKGFqYXhSZXNwb25zZSA9PiBrb25zb2xlLmxvZyhcImNvbnZlcnNhdGlvbiBhamF4UmVzcG9uc2VcIiwgYWpheFJlc3BvbnNlLnJlc3BvbnNlKSlcbiAgICAgICAgLm1hcChhamF4UmVzcG9uc2UgPT4gYWpheFJlc3BvbnNlLnJlc3BvbnNlIGFzIENvbnZlcnNhdGlvbilcbiAgICAgICAgLnJldHJ5V2hlbihlcnJvciQgPT5cbiAgICAgICAgICAgIC8vIGZvciBub3cgd2UgZGVlbSA0eHggYW5kIDV4eCBlcnJvcnMgYXMgdW5yZWNvdmVyYWJsZVxuICAgICAgICAgICAgLy8gZm9yIGV2ZXJ5dGhpbmcgZWxzZSAodGltZW91dHMpLCByZXRyeSBmb3IgYSB3aGlsZVxuICAgICAgICAgICAgZXJyb3IkLm1lcmdlTWFwKChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvci5zdGF0dXMgPj0gNDAwICYmIGVycm9yLnN0YXR1cyA8IDYwMFxuICAgICAgICAgICAgICAgID8gT2JzZXJ2YWJsZS50aHJvdyhlcnJvciwgdGhpcy5zZXJ2aWNlcy5zY2hlZHVsZXIpXG4gICAgICAgICAgICAgICAgOiBPYnNlcnZhYmxlLm9mKGVycm9yLCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcilcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZGVsYXkodGhpcy50aW1lb3V0LCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcilcbiAgICAgICAgICAgIC50YWtlKHRoaXMucmV0cmllcylcbiAgICAgICAgKVxuICAgIH1cblxuICAgIHByaXZhdGUgcmVmcmVzaFRva2VuTG9vcCgpIHtcbiAgICAgICAgdGhpcy50b2tlblJlZnJlc2hTdWJzY3JpcHRpb24gPSBPYnNlcnZhYmxlLmludGVydmFsKGludGVydmFsUmVmcmVzaFRva2VuLCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcilcbiAgICAgICAgLmZsYXRNYXAoXyA9PiB0aGlzLnJlZnJlc2hUb2tlbigpKVxuICAgICAgICAuc3Vic2NyaWJlKHRva2VuID0+IHtcbiAgICAgICAgICAgIGtvbnNvbGUubG9nKFwicmVmcmVzaGluZyB0b2tlblwiLCB0b2tlbiwgXCJhdFwiLCBuZXcgRGF0ZSgpKTtcbiAgICAgICAgICAgIHRoaXMudG9rZW4gPSB0b2tlbjtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZWZyZXNoVG9rZW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNrQ29ubmVjdGlvbih0cnVlKVxuICAgICAgICAuZmxhdE1hcChfID0+XG4gICAgICAgICAgICB0aGlzLnNlcnZpY2VzLmFqYXgoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgdXJsOiBgJHt0aGlzLmRvbWFpbn0vdG9rZW5zL3JlZnJlc2hgLFxuICAgICAgICAgICAgICAgIHRpbWVvdXQ6IHRoaXMudGltZW91dCxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnRoaXMuY29tbW9uSGVhZGVycygpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5tYXAoYWpheFJlc3BvbnNlID0+IGFqYXhSZXNwb25zZS5yZXNwb25zZS50b2tlbiBhcyBzdHJpbmcpXG4gICAgICAgICAgICAucmV0cnlXaGVuKGVycm9yJCA9PiBlcnJvciRcbiAgICAgICAgICAgICAgICAubWVyZ2VNYXAoZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3Iuc3RhdHVzID09PSA0MDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZSB0b2tlbiBpcyBleHBpcmVkIHRoZXJlJ3Mgbm8gcmVhc29uIHRvIGtlZXAgdHJ5aW5nXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGlyZWRUb2tlbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUudGhyb3coZXJyb3IsIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvci5zdGF0dXMgPT09IDQwNCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGJvdCBpcyBnb25lLCB3ZSBzaG91bGQgc3RvcCByZXRyeWluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUudGhyb3coZXJyb3IsIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLm9mKGVycm9yLCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuZGVsYXkodGhpcy50aW1lb3V0LCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcilcbiAgICAgICAgICAgICAgICAudGFrZSh0aGlzLnJldHJpZXMpXG4gICAgICAgICAgICApXG4gICAgICAgIClcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVjb25uZWN0KGNvbnZlcnNhdGlvbjogQ29udmVyc2F0aW9uKSB7XG4gICAgICAgIHRoaXMudG9rZW4gPSBjb252ZXJzYXRpb24udG9rZW47XG4gICAgICAgIHRoaXMuc3RyZWFtVXJsID0gY29udmVyc2F0aW9uLnN0cmVhbVVybDtcbiAgICAgICAgaWYgKHRoaXMuY29ubmVjdGlvblN0YXR1cyQuZ2V0VmFsdWUoKSA9PT0gQ29ubmVjdGlvblN0YXR1cy5FeHBpcmVkVG9rZW4pXG4gICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0dXMkLm5leHQoQ29ubmVjdGlvblN0YXR1cy5PbmxpbmUpO1xuICAgIH1cblxuICAgIGVuZCgpIHtcbiAgICAgICAgaWYgKHRoaXMudG9rZW5SZWZyZXNoU3Vic2NyaXB0aW9uKVxuICAgICAgICAgICAgdGhpcy50b2tlblJlZnJlc2hTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cyQubmV4dChDb25uZWN0aW9uU3RhdHVzLkVuZGVkKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgaWYgKGUgPT09IGVycm9yQ29udmVyc2F0aW9uRW5kZWQpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgdGhyb3coZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRTZXNzaW9uSWQoKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcbiAgICAgICAgLy8gSWYgd2UncmUgbm90IGNvbm5lY3RlZCB0byB0aGUgYm90LCBnZXQgY29ubmVjdGVkXG4gICAgICAgIC8vIFdpbGwgdGhyb3cgYW4gZXJyb3IgaWYgd2UgYXJlIG5vdCBjb25uZWN0ZWRcbiAgICAgICAga29uc29sZS5sb2coXCJnZXRTZXNzaW9uSWRcIik7XG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNrQ29ubmVjdGlvbih0cnVlKVxuICAgICAgICAgICAgLmZsYXRNYXAoXyA9PlxuICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZXMuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBgJHt0aGlzLmRvbWFpbn0vc2Vzc2lvbi9nZXRzZXNzaW9uaWRgLFxuICAgICAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ6IHRoaXMudGltZW91dCxcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi50aGlzLmNvbW1vbkhlYWRlcnMoKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAubWFwKGFqYXhSZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhamF4UmVzcG9uc2UgJiYgYWpheFJlc3BvbnNlLnJlc3BvbnNlICYmIGFqYXhSZXNwb25zZS5yZXNwb25zZS5zZXNzaW9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtvbnNvbGUubG9nKFwiZ2V0U2Vzc2lvbklkIHJlc3BvbnNlOiBcIiArIGFqYXhSZXNwb25zZS5yZXNwb25zZS5zZXNzaW9uSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFqYXhSZXNwb25zZS5yZXNwb25zZS5zZXNzaW9uSWQgYXMgc3RyaW5nO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGtvbnNvbGUubG9nKFwiZ2V0U2Vzc2lvbklkIGVycm9yOiBcIiArIGVycm9yLnN0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLm9mKCcnLCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB0aGlzLmNhdGNoRXhwaXJlZFRva2VuKGVycm9yKSk7XG4gICAgfVxuXG4gICAgcG9zdEFjdGl2aXR5KGFjdGl2aXR5OiBBY3Rpdml0eSkge1xuICAgICAgICAvLyBJZiB1c2VyIGlkIGlzIHNldCwgY2hlY2sgaWYgaXQgbWF0Y2ggYWN0aXZpdHkuZnJvbS5pZCBhbmQgYWx3YXlzIG92ZXJyaWRlIGl0IGluIGFjdGl2aXR5XG4gICAgICAgIGlmICh0aGlzLnVzZXJJZE9uU3RhcnRDb252ZXJzYXRpb24gJiYgYWN0aXZpdHkuZnJvbSAmJiBhY3Rpdml0eS5mcm9tLmlkICE9PSB0aGlzLnVzZXJJZE9uU3RhcnRDb252ZXJzYXRpb24pIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignRGlyZWN0TGluZUpTOiBBY3Rpdml0eS5mcm9tLmlkIGRvZXMgbm90IG1hdGNoIHdpdGggdXNlciBpZCwgaWdub3JpbmcgYWN0aXZpdHkuZnJvbS5pZCcpO1xuICAgICAgICAgICAgYWN0aXZpdHkuZnJvbS5pZCA9IHRoaXMudXNlcklkT25TdGFydENvbnZlcnNhdGlvbjtcbiAgICAgICAgfVxuICAgICAgICAvLyBVc2UgcG9zdE1lc3NhZ2VXaXRoQXR0YWNobWVudHMgZm9yIG1lc3NhZ2VzIHdpdGggYXR0YWNobWVudHMgdGhhdCBhcmUgbG9jYWwgZmlsZXMgKGUuZy4gYW4gaW1hZ2UgdG8gdXBsb2FkKVxuICAgICAgICAvLyBUZWNobmljYWxseSB3ZSBjb3VsZCB1c2UgaXQgZm9yICphbGwqIGFjdGl2aXRpZXMsIGJ1dCBwb3N0QWN0aXZpdHkgaXMgbXVjaCBsaWdodGVyIHdlaWdodFxuICAgICAgICAvLyBTbywgc2luY2UgV2ViQ2hhdCBpcyBwYXJ0aWFsbHkgYSByZWZlcmVuY2UgaW1wbGVtZW50YXRpb24gb2YgRGlyZWN0IExpbmUsIHdlIGltcGxlbWVudCBib3RoLlxuICAgICAgICBpZiAoYWN0aXZpdHkudHlwZSA9PT0gXCJtZXNzYWdlXCIgJiYgYWN0aXZpdHkuYXR0YWNobWVudHMgJiYgYWN0aXZpdHkuYXR0YWNobWVudHMubGVuZ3RoID4gMClcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBvc3RNZXNzYWdlV2l0aEF0dGFjaG1lbnRzKGFjdGl2aXR5KTtcblxuICAgICAgICAvLyBJZiB3ZSdyZSBub3QgY29ubmVjdGVkIHRvIHRoZSBib3QsIGdldCBjb25uZWN0ZWRcbiAgICAgICAgLy8gV2lsbCB0aHJvdyBhbiBlcnJvciBpZiB3ZSBhcmUgbm90IGNvbm5lY3RlZFxuICAgICAgICBrb25zb2xlLmxvZyhcInBvc3RBY3Rpdml0eVwiLCBhY3Rpdml0eSk7XG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNrQ29ubmVjdGlvbih0cnVlKVxuICAgICAgICAuZmxhdE1hcChfID0+XG4gICAgICAgICAgICB0aGlzLnNlcnZpY2VzLmFqYXgoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgdXJsOiBgJHt0aGlzLmRvbWFpbn0vY29udmVyc2F0aW9ucy8ke3RoaXMuY29udmVyc2F0aW9uSWR9L2FjdGl2aXRpZXNgLFxuICAgICAgICAgICAgICAgIGJvZHk6IGFjdGl2aXR5LFxuICAgICAgICAgICAgICAgIHRpbWVvdXQ6IHRoaXMudGltZW91dCxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgICAgICAgICAuLi50aGlzLmNvbW1vbkhlYWRlcnMoKVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm1hcChhamF4UmVzcG9uc2UgPT4gYWpheFJlc3BvbnNlLnJlc3BvbnNlLmlkIGFzIHN0cmluZylcbiAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB0aGlzLmNhdGNoUG9zdEVycm9yKGVycm9yKSlcbiAgICAgICAgKVxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4gdGhpcy5jYXRjaEV4cGlyZWRUb2tlbihlcnJvcikpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcG9zdE1lc3NhZ2VXaXRoQXR0YWNobWVudHMobWVzc2FnZTogTWVzc2FnZSkge1xuICAgICAgICBjb25zdCB7IGF0dGFjaG1lbnRzIH0gPSBtZXNzYWdlO1xuICAgICAgICAvLyBXZSBjbGVhbiB0aGUgYXR0YWNobWVudHMgYnV0IG1ha2luZyBzdXJlIGV2ZXJ5IGF0dGFjaG1lbnQgaGFzIHVuaXF1ZSBuYW1lLlxuICAgICAgICAvLyBJZiB0aGUgZmlsZSBkbyBub3QgaGF2ZSBhIG5hbWUsIENocm9tZSB3aWxsIGFzc2lnbiBcImJsb2JcIiB3aGVuIGl0IGlzIGFwcGVuZGVkIHRvIEZvcm1EYXRhLlxuICAgICAgICBjb25zdCBhdHRhY2htZW50TmFtZXM6IHN0cmluZ1tdID0gZGVkdXBlRmlsZW5hbWVzKGF0dGFjaG1lbnRzLm1hcCgobWVkaWE6IE1lZGlhKSA9PiBtZWRpYS5uYW1lIHx8ICdibG9iJykpO1xuICAgICAgICBjb25zdCBjbGVhbnNlZEF0dGFjaG1lbnRzID0gYXR0YWNobWVudHMubWFwKChhdHRhY2htZW50OiBNZWRpYSwgaW5kZXg6IG51bWJlcikgPT4gKHtcbiAgICAgICAgICAgIC4uLmF0dGFjaG1lbnQsXG4gICAgICAgICAgICBuYW1lOiBhdHRhY2htZW50TmFtZXNbaW5kZXhdXG4gICAgICAgIH0pKTtcbiAgICAgICAgbGV0IGZvcm1EYXRhOiBGb3JtRGF0YTtcblxuICAgICAgICAvLyBJZiB3ZSdyZSBub3QgY29ubmVjdGVkIHRvIHRoZSBib3QsIGdldCBjb25uZWN0ZWRcbiAgICAgICAgLy8gV2lsbCB0aHJvdyBhbiBlcnJvciBpZiB3ZSBhcmUgbm90IGNvbm5lY3RlZFxuICAgICAgICByZXR1cm4gdGhpcy5jaGVja0Nvbm5lY3Rpb24odHJ1ZSlcbiAgICAgICAgLmZsYXRNYXAoXyA9PiB7XG4gICAgICAgICAgICAvLyBUbyBzZW5kIHRoaXMgbWVzc2FnZSB0byBEaXJlY3RMaW5lIHdlIG5lZWQgdG8gZGVjb25zdHJ1Y3QgaXQgaW50byBhIFwidGVtcGxhdGVcIiBhY3Rpdml0eVxuICAgICAgICAgICAgLy8gYW5kIG9uZSBibG9iIGZvciBlYWNoIGF0dGFjaG1lbnQuXG4gICAgICAgICAgICBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdhY3Rpdml0eScsIG5ldyBCbG9iKFtKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgLi4ubWVzc2FnZSxcbiAgICAgICAgICAgICAgICAvLyBSZW1vdmluZyBjb250ZW50VXJsIGZyb20gYXR0YWNobWVudCwgd2Ugd2lsbCBzZW5kIGl0IHZpYSBtdWx0aXBhcnRcbiAgICAgICAgICAgICAgICBhdHRhY2htZW50czogY2xlYW5zZWRBdHRhY2htZW50cy5tYXAoKHsgY29udGVudFVybDogc3RyaW5nLCAuLi5vdGhlcnMgfSkgPT4gKHsgLi4ub3RoZXJzIH0pKVxuICAgICAgICAgICAgfSldLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi92bmQubWljcm9zb2Z0LmFjdGl2aXR5JyB9KSk7XG5cbiAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLmZyb20oY2xlYW5zZWRBdHRhY2htZW50cywgdGhpcy5zZXJ2aWNlcy5zY2hlZHVsZXIpXG4gICAgICAgICAgICAuZmxhdE1hcCgobWVkaWE6IE1lZGlhKSA9PlxuICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZXMuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBtZWRpYS5jb250ZW50VXJsLFxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZVR5cGU6ICdhcnJheWJ1ZmZlcidcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5kbyhhamF4UmVzcG9uc2UgPT5cbiAgICAgICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdmaWxlJywgbmV3IEJsb2IoW2FqYXhSZXNwb25zZS5yZXNwb25zZV0sIHsgdHlwZTogbWVkaWEuY29udGVudFR5cGUgfSksIG1lZGlhLm5hbWUpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLmNvdW50KClcbiAgICAgICAgfSlcbiAgICAgICAgLmZsYXRNYXAoXyA9PlxuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlcy5hamF4KHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgIHVybDogYCR7dGhpcy5kb21haW59L2NvbnZlcnNhdGlvbnMvJHt0aGlzLmNvbnZlcnNhdGlvbklkfS91cGxvYWQ/dXNlcklkPSR7bWVzc2FnZS5mcm9tLmlkfWAsXG4gICAgICAgICAgICAgICAgYm9keTogZm9ybURhdGEsXG4gICAgICAgICAgICAgICAgdGltZW91dDogdGhpcy50aW1lb3V0LFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4udGhpcy5jb21tb25IZWFkZXJzKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm1hcChhamF4UmVzcG9uc2UgPT4gYWpheFJlc3BvbnNlLnJlc3BvbnNlLmlkIGFzIHN0cmluZylcbiAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB0aGlzLmNhdGNoUG9zdEVycm9yKGVycm9yKSlcbiAgICAgICAgKVxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4gdGhpcy5jYXRjaFBvc3RFcnJvcihlcnJvcikpO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2F0Y2hQb3N0RXJyb3IoZXJyb3I6IGFueSkge1xuICAgICAgICBpZiAoZXJyb3Iuc3RhdHVzID09PSA0MDMpXG4gICAgICAgICAgICAvLyB0b2tlbiBoYXMgZXhwaXJlZCAod2lsbCBmYWxsIHRocm91Z2ggdG8gcmV0dXJuIFwicmV0cnlcIilcbiAgICAgICAgICAgIHRoaXMuZXhwaXJlZFRva2VuKCk7XG4gICAgICAgIGVsc2UgaWYgKGVycm9yLnN0YXR1cyA+PSA0MDAgJiYgZXJyb3Iuc3RhdHVzIDwgNTAwKVxuICAgICAgICAgICAgLy8gbW9yZSB1bnJlY292ZXJhYmxlIGVycm9yc1xuICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUudGhyb3coZXJyb3IsIHRoaXMuc2VydmljZXMuc2NoZWR1bGVyKTtcbiAgICAgICAgcmV0dXJuIE9ic2VydmFibGUub2YoXCJyZXRyeVwiLCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjYXRjaEV4cGlyZWRUb2tlbihlcnJvcjogYW55KSB7XG4gICAgICAgIHJldHVybiBlcnJvciA9PT0gZXJyb3JFeHBpcmVkVG9rZW5cbiAgICAgICAgPyBPYnNlcnZhYmxlLm9mKFwicmV0cnlcIiwgdGhpcy5zZXJ2aWNlcy5zY2hlZHVsZXIpXG4gICAgICAgIDogT2JzZXJ2YWJsZS50aHJvdyhlcnJvciwgdGhpcy5zZXJ2aWNlcy5zY2hlZHVsZXIpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcG9sbGluZ0dldEFjdGl2aXR5JCgpIHtcbiAgICAgICAgY29uc3QgcG9sbGVyJDogT2JzZXJ2YWJsZTxBamF4UmVzcG9uc2U+ID0gT2JzZXJ2YWJsZS5jcmVhdGUoKHN1YnNjcmliZXI6IFN1YnNjcmliZXI8YW55PikgPT4ge1xuICAgICAgICAgICAgLy8gQSBCZWhhdmlvclN1YmplY3QgdG8gdHJpZ2dlciBwb2xsaW5nLiBTaW5jZSBpdCBpcyBhIEJlaGF2aW9yU3ViamVjdFxuICAgICAgICAgICAgLy8gdGhlIGZpcnN0IGV2ZW50IGlzIHByb2R1Y2VkIGltbWVkaWF0ZWx5LlxuICAgICAgICAgICAgY29uc3QgdHJpZ2dlciQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGFueT4oe30pO1xuXG4gICAgICAgICAgICAvLyBUT0RPOiByZW1vdmUgRGF0ZS5ub3csIHVzZSByZWFjdGl2ZSBpbnRlcnZhbCB0byBzcGFjZSBvdXQgZXZlcnkgcmVxdWVzdFxuXG4gICAgICAgICAgICB0cmlnZ2VyJC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb25TdGF0dXMkLmdldFZhbHVlKCkgPT09IENvbm5lY3Rpb25TdGF0dXMuT25saW5lKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0VGltZXN0YW1wID0gRGF0ZS5ub3coKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlcnZpY2VzLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnRoaXMuY29tbW9uSGVhZGVycygpXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogYCR7IHRoaXMuZG9tYWluIH0vY29udmVyc2F0aW9ucy8keyB0aGlzLmNvbnZlcnNhdGlvbklkIH0vYWN0aXZpdGllcz93YXRlcm1hcms9JHsgdGhpcy53YXRlcm1hcmsgfWAsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiB0aGlzLnRpbWVvdXRcbiAgICAgICAgICAgICAgICAgICAgfSkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgICAgICAgICAgKHJlc3VsdDogQWpheFJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaWJlci5uZXh0KHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0cmlnZ2VyJC5uZXh0KG51bGwpLCBNYXRoLm1heCgwLCB0aGlzLnBvbGxpbmdJbnRlcnZhbCAtIERhdGUubm93KCkgKyBzdGFydFRpbWVzdGFtcCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIChlcnJvcjogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChlcnJvci5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0MDM6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0dXMkLm5leHQoQ29ubmVjdGlvblN0YXR1cy5FeHBpcmVkVG9rZW4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0cmlnZ2VyJC5uZXh0KG51bGwpLCB0aGlzLnBvbGxpbmdJbnRlcnZhbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQwNDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cyQubmV4dChDb25uZWN0aW9uU3RhdHVzLkVuZGVkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBwcm9wYWdhdGUgdGhlIGVycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tDb25uZWN0aW9uKClcbiAgICAgICAgLmZsYXRNYXAoXyA9PiBwb2xsZXIkXG4gICAgICAgICAgICAuY2F0Y2goKCkgPT4gT2JzZXJ2YWJsZS5lbXB0eTxBamF4UmVzcG9uc2U+KCkpXG4gICAgICAgICAgICAubWFwKGFqYXhSZXNwb25zZSA9PiBhamF4UmVzcG9uc2UucmVzcG9uc2UgYXMgQWN0aXZpdHlHcm91cClcbiAgICAgICAgICAgIC5mbGF0TWFwKGFjdGl2aXR5R3JvdXAgPT4gdGhpcy5vYnNlcnZhYmxlRnJvbUFjdGl2aXR5R3JvdXAoYWN0aXZpdHlHcm91cCkpKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9ic2VydmFibGVGcm9tQWN0aXZpdHlHcm91cChhY3Rpdml0eUdyb3VwOiBBY3Rpdml0eUdyb3VwKSB7XG4gICAgICAgIGlmIChhY3Rpdml0eUdyb3VwLndhdGVybWFyaylcbiAgICAgICAgICAgIHRoaXMud2F0ZXJtYXJrID0gYWN0aXZpdHlHcm91cC53YXRlcm1hcms7XG4gICAgICAgIHJldHVybiBPYnNlcnZhYmxlLmZyb20oYWN0aXZpdHlHcm91cC5hY3Rpdml0aWVzLCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB3ZWJTb2NrZXRBY3Rpdml0eSQoKTogT2JzZXJ2YWJsZTxBY3Rpdml0eT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jaGVja0Nvbm5lY3Rpb24oKVxuICAgICAgICAuZmxhdE1hcChfID0+XG4gICAgICAgICAgICB0aGlzLm9ic2VydmFibGVXZWJTb2NrZXQ8QWN0aXZpdHlHcm91cD4oKVxuICAgICAgICAgICAgLy8gV2ViU29ja2V0cyBjYW4gYmUgY2xvc2VkIGJ5IHRoZSBzZXJ2ZXIgb3IgdGhlIGJyb3dzZXIuIEluIHRoZSBmb3JtZXIgY2FzZSB3ZSBuZWVkIHRvXG4gICAgICAgICAgICAvLyByZXRyaWV2ZSBhIG5ldyBzdHJlYW1VcmwuIEluIHRoZSBsYXR0ZXIgY2FzZSB3ZSBjb3VsZCBmaXJzdCByZXRyeSB3aXRoIHRoZSBjdXJyZW50IHN0cmVhbVVybCxcbiAgICAgICAgICAgIC8vIGJ1dCBpdCdzIHNpbXBsZXIganVzdCB0byBhbHdheXMgZmV0Y2ggYSBuZXcgb25lLlxuICAgICAgICAgICAgLnJldHJ5V2hlbihlcnJvciQgPT4gZXJyb3IkLmRlbGF5KHRoaXMuZ2V0UmV0cnlEZWxheSgpLCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcikubWVyZ2VNYXAoZXJyb3IgPT4gdGhpcy5yZWNvbm5lY3RUb0NvbnZlcnNhdGlvbigpKSlcbiAgICAgICAgKVxuICAgICAgICAuZmxhdE1hcChhY3Rpdml0eUdyb3VwID0+IHRoaXMub2JzZXJ2YWJsZUZyb21BY3Rpdml0eUdyb3VwKGFjdGl2aXR5R3JvdXApKVxuICAgIH1cblxuICAgIC8vIFJldHVybnMgdGhlIGRlbGF5IGR1cmF0aW9uIGluIG1pbGxpc2Vjb25kc1xuICAgIHByaXZhdGUgZ2V0UmV0cnlEZWxheSgpIHtcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoMzAwMCArIHRoaXMuc2VydmljZXMucmFuZG9tKCkgKiAxMjAwMCk7XG4gICAgfVxuXG4gICAgLy8gT3JpZ2luYWxseSB3ZSB1c2VkIE9ic2VydmFibGUud2ViU29ja2V0LCBidXQgaXQncyBmYWlybHkgb3BpbmlvbmF0ZWQgYW5kIEkgZW5kZWQgdXAgd3JpdGluZ1xuICAgIC8vIGEgbG90IG9mIGNvZGUgdG8gd29yayBhcm91bmQgdGhlaXIgaW1wbGVtZW50YXRpb24gZGV0YWlscy4gU2luY2UgV2ViQ2hhdCBpcyBtZWFudCB0byBiZSBhIHJlZmVyZW5jZVxuICAgIC8vIGltcGxlbWVudGF0aW9uLCBJIGRlY2lkZWQgcm9sbCB0aGUgYmVsb3csIHdoZXJlIHRoZSBsb2dpYyBpcyBtb3JlIHB1cnBvc2VmdWwuIC0gQGJpbGxiYVxuICAgIHByaXZhdGUgb2JzZXJ2YWJsZVdlYlNvY2tldDxUPigpIHtcbiAgICAgICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKChzdWJzY3JpYmVyOiBTdWJzY3JpYmVyPFQ+KSA9PiB7XG4gICAgICAgICAgICBrb25zb2xlLmxvZyhcImNyZWF0aW5nIFdlYlNvY2tldFwiLCB0aGlzLnN0cmVhbVVybCk7XG4gICAgICAgICAgICBjb25zdCB3cyA9IG5ldyB0aGlzLnNlcnZpY2VzLldlYlNvY2tldCh0aGlzLnN0cmVhbVVybCk7XG4gICAgICAgICAgICBsZXQgc3ViOiBTdWJzY3JpcHRpb247XG4gICAgICAgICAgICBsZXQgY2xvc2VkOiBib29sZWFuO1xuXG4gICAgICAgICAgICB3cy5vbm9wZW4gPSBvcGVuID0+IHtcbiAgICAgICAgICAgICAgICBrb25zb2xlLmxvZyhcIldlYlNvY2tldCBvcGVuXCIsIG9wZW4pO1xuICAgICAgICAgICAgICAgIC8vIENocm9tZSBpcyBwcmV0dHkgYmFkIGF0IG5vdGljaW5nIHdoZW4gYSBXZWJTb2NrZXQgY29ubmVjdGlvbiBpcyBicm9rZW4uXG4gICAgICAgICAgICAgICAgLy8gSWYgd2UgcGVyaW9kaWNhbGx5IHBpbmcgdGhlIHNlcnZlciB3aXRoIGVtcHR5IG1lc3NhZ2VzLCBpdCBoZWxwcyBDaHJvbWVcbiAgICAgICAgICAgICAgICAvLyByZWFsaXplIHdoZW4gY29ubmVjdGlvbiBicmVha3MsIGFuZCBjbG9zZSB0aGUgc29ja2V0LiBXZSB0aGVuIHRocm93IGFuXG4gICAgICAgICAgICAgICAgLy8gZXJyb3IsIGFuZCB0aGF0IGdpdmUgdXMgdGhlIG9wcG9ydHVuaXR5IHRvIGF0dGVtcHQgdG8gcmVjb25uZWN0LlxuICAgICAgICAgICAgICAgIHN1YiA9IE9ic2VydmFibGUuaW50ZXJ2YWwodGhpcy50aW1lb3V0LCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcikuc3Vic2NyaWJlKF8gPT4ge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd3Muc2VuZChcIlwiKVxuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtvbnNvbGUubG9nKFwiUGluZyBlcnJvclwiLCBlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB3cy5vbmNsb3NlID0gY2xvc2UgPT4ge1xuICAgICAgICAgICAgICAgIGtvbnNvbGUubG9nKFwiV2ViU29ja2V0IGNsb3NlXCIsIGNsb3NlKTtcbiAgICAgICAgICAgICAgICBpZiAoc3ViKSBzdWIudW5zdWJzY3JpYmUoKTtcblxuICAgICAgICAgICAgICAgIC8vIFJ4SlMucmV0cnlXaGVuIGhhcyBhIGJ1ZyB0aGF0IHdvdWxkIGNhdXNlIFwiZXJyb3JcIiBzaWduYWwgdG8gYmUgc2VudCBhZnRlciB0aGUgb2JzZXJ2YWJsZSBpcyBjb21wbGV0ZWQvZXJyb3JlZC5cbiAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGd1YXJkIGFnYWluc3QgZXh0cmFuZW91cyBcImVycm9yXCIgc2lnbmFsIHRvIHdvcmthcm91bmQgdGhlIGJ1Zy5cbiAgICAgICAgICAgICAgICBjbG9zZWQgfHwgc3Vic2NyaWJlci5lcnJvcihjbG9zZSk7XG4gICAgICAgICAgICAgICAgY2xvc2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgd3Mub25lcnJvciA9IGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICBrb25zb2xlLmxvZyhcIldlYlNvY2tldCBlcnJvclwiLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgaWYgKHN1Yikgc3ViLnVuc3Vic2NyaWJlKCk7XG5cbiAgICAgICAgICAgICAgICAvLyBSeEpTLnJldHJ5V2hlbiBoYXMgYSBidWcgdGhhdCB3b3VsZCBjYXVzZSBcImVycm9yXCIgc2lnbmFsIHRvIGJlIHNlbnQgYWZ0ZXIgdGhlIG9ic2VydmFibGUgaXMgY29tcGxldGVkL2Vycm9yZWQuXG4gICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBndWFyZCBhZ2FpbnN0IGV4dHJhbmVvdXMgXCJlcnJvclwiIHNpZ25hbCB0byB3b3JrYXJvdW5kIHRoZSBidWcuXG4gICAgICAgICAgICAgICAgY2xvc2VkIHx8IHN1YnNjcmliZXIuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgIGNsb3NlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHdzLm9ubWVzc2FnZSA9IG1lc3NhZ2UgPT4gbWVzc2FnZS5kYXRhICYmIHN1YnNjcmliZXIubmV4dChKU09OLnBhcnNlKG1lc3NhZ2UuZGF0YSkpO1xuXG4gICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSAndW5zdWJzY3JpYmUnIG1ldGhvZCwgd2hpY2ggaXMgY2FsbGVkIHdoZW4gdGhpcyBvYnNlcnZhYmxlIGlzIGRpc3Bvc2VkLlxuICAgICAgICAgICAgLy8gV2hlbiB0aGUgV2ViU29ja2V0IGNsb3NlcyBpdHNlbGYsIHdlIHRocm93IGFuIGVycm9yLCBhbmQgdGhpcyBmdW5jdGlvbiBpcyBldmVudHVhbGx5IGNhbGxlZC5cbiAgICAgICAgICAgIC8vIFdoZW4gdGhlIG9ic2VydmFibGUgaXMgY2xvc2VkIGZpcnN0IChlLmcuIHdoZW4gdGVhcmluZyBkb3duIGEgV2ViQ2hhdCBpbnN0YW5jZSkgdGhlblxuICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBtYW51YWxseSBjbG9zZSB0aGUgV2ViU29ja2V0LlxuICAgICAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAod3MucmVhZHlTdGF0ZSA9PT0gMCB8fCB3cy5yZWFkeVN0YXRlID09PSAxKSB3cy5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSBhcyBPYnNlcnZhYmxlPFQ+XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZWNvbm5lY3RUb0NvbnZlcnNhdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tDb25uZWN0aW9uKHRydWUpXG4gICAgICAgIC5mbGF0TWFwKF8gPT5cbiAgICAgICAgICAgIHRoaXMuc2VydmljZXMuYWpheCh7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICAgICAgICAgIHVybDogYCR7dGhpcy5kb21haW59L2NvbnZlcnNhdGlvbnMvJHt0aGlzLmNvbnZlcnNhdGlvbklkfT93YXRlcm1hcms9JHt0aGlzLndhdGVybWFya31gLFxuICAgICAgICAgICAgICAgIHRpbWVvdXQ6IHRoaXMudGltZW91dCxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIFwiQWNjZXB0XCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgICAgICAgICAuLi50aGlzLmNvbW1vbkhlYWRlcnMoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZG8ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuc2VjcmV0KVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRva2VuID0gcmVzdWx0LnJlc3BvbnNlLnRva2VuO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RyZWFtVXJsID0gcmVzdWx0LnJlc3BvbnNlLnN0cmVhbVVybDtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAubWFwKF8gPT4gbnVsbClcbiAgICAgICAgICAgIC5yZXRyeVdoZW4oZXJyb3IkID0+IGVycm9yJFxuICAgICAgICAgICAgICAgIC5tZXJnZU1hcChlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnJvci5zdGF0dXMgPT09IDQwMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdG9rZW4gaGFzIGV4cGlyZWQuIFdlIGNhbid0IHJlY292ZXIgZnJvbSB0aGlzIGhlcmUsIGJ1dCB0aGUgZW1iZWRkaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZWJzaXRlIG1pZ2h0IGV2ZW50dWFsbHkgY2FsbCByZWNvbm5lY3QoKSB3aXRoIGEgbmV3IHRva2VuIGFuZCBzdHJlYW1VcmwuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGlyZWRUb2tlbigpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS50aHJvdyhlcnJvckNvbnZlcnNhdGlvbkVuZGVkLCB0aGlzLnNlcnZpY2VzLnNjaGVkdWxlcik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5vZihlcnJvciwgdGhpcy5zZXJ2aWNlcy5zY2hlZHVsZXIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmRlbGF5KHRoaXMudGltZW91dCwgdGhpcy5zZXJ2aWNlcy5zY2hlZHVsZXIpXG4gICAgICAgICAgICAgICAgLnRha2UodGhpcy5yZXRyaWVzKVxuICAgICAgICAgICAgKVxuICAgICAgICApXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjb21tb25IZWFkZXJzKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgXCJBdXRob3JpemF0aW9uXCI6IGBCZWFyZXIgJHt0aGlzLnRva2VufWAsXG4gICAgICAgICAgICBcIngtbXMtYm90LWFnZW50XCI6IHRoaXMuX2JvdEFnZW50XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRCb3RBZ2VudChjdXN0b21BZ2VudDogc3RyaW5nID0gJycpOiBzdHJpbmcge1xuICAgICAgICBsZXQgY2xpZW50QWdlbnQgPSAnZGlyZWN0bGluZWpzJ1xuXG4gICAgICAgIGlmIChjdXN0b21BZ2VudCkge1xuICAgICAgICAgICAgY2xpZW50QWdlbnQgKz0gYDsgJHtjdXN0b21BZ2VudH1gXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYCR7RElSRUNUX0xJTkVfVkVSU0lPTn0gKCR7Y2xpZW50QWdlbnR9ICR7cHJvY2Vzcy5lbnYubnBtX3BhY2thZ2VfdmVyc2lvbn0pYDtcbiAgICB9XG5cbiAgICBzZXRVc2VySWQodXNlcklkOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKHRoaXMuY29ubmVjdGlvblN0YXR1cyQuZ2V0VmFsdWUoKSA9PT0gQ29ubmVjdGlvblN0YXR1cy5PbmxpbmUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRGlyZWN0TGluZUpTOiBJdCBpcyBjb25uZWN0ZWQsIHdlIGNhbm5vdCBzZXQgdXNlciBpZC4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHVzZXJJZEZyb21Ub2tlbiA9IHRoaXMucGFyc2VUb2tlbih0aGlzLnRva2VuKTtcbiAgICAgICAgaWYgKHVzZXJJZEZyb21Ub2tlbikge1xuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignRGlyZWN0TGluZUpTOiB1c2VyIGlkIGlzIGFscmVhZHkgc2V0IGluIHRva2VuLCB3aWxsIGlnbm9yZSB0aGlzIHVzZXIgaWQuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoL15kbF8vdS50ZXN0KHVzZXJJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ0RpcmVjdExpbmVKUzogdXNlciBpZCBwcmVmaXhlZCB3aXRoIFwiZGxfXCIgaXMgcmVzZXJ2ZWQgYW5kIG11c3QgYmUgZW1iZWRkZWQgaW50byB0aGUgRGlyZWN0IExpbmUgdG9rZW4gdG8gcHJldmVudCBmb3JnZXJ5LicpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy51c2VySWRPblN0YXJ0Q29udmVyc2F0aW9uID0gdXNlcklkO1xuICAgIH1cblxuICAgIHByaXZhdGUgcGFyc2VUb2tlbih0b2tlbjogc3RyaW5nKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB7IHVzZXIgfSA9IGp3dERlY29kZTxKd3RQYXlsb2FkPih0b2tlbikgYXMgeyBba2V5OiBzdHJpbmddOiBhbnk7IH07XG4gICAgICAgICAgICByZXR1cm4gdXNlcjtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBJbnZhbGlkVG9rZW5FcnJvcikge1xuICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbn1cbiJdfQ==