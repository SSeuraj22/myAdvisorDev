"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = _default;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _SpeechToText = require("web-speech-cognitive-services/lib/SpeechServices/SpeechToText");

var _abortControllerEs = _interopRequireDefault(require("abort-controller-es5"));

var _createCustomEvent = _interopRequireDefault(require("./createCustomEvent"));

var _createErrorEvent = _interopRequireDefault(require("./createErrorEvent"));

var _createTaskQueue2 = _interopRequireDefault(require("./createTaskQueue"));

var _eventTargetShimEs = _interopRequireWildcard(require("event-target-shim-es5"));

var _playCognitiveServicesStream = _interopRequireDefault(require("./playCognitiveServicesStream"));

var _playWhiteNoise = _interopRequireDefault(require("./playWhiteNoise"));

var _SpeechSynthesisAudioStreamUtterance = _interopRequireDefault(require("./SpeechSynthesisAudioStreamUtterance"));

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

function _default(_ref) {
  var audioContext = _ref.audioContext,
      enableTelemetry = _ref.enableTelemetry,
      _ref$ponyfill = _ref.ponyfill,
      ponyfill = _ref$ponyfill === void 0 ? {
    AudioContext: window.AudioContext || window.webkitAudioContext
  } : _ref$ponyfill,
      recognizer = _ref.recognizer,
      textNormalization = _ref.textNormalization;

  if (!ponyfill.AudioContext) {
    console.warn('botframework-directlinespeech-sdk: This browser does not support Web Audio API. Speech support is disabled.');
    return function () {
      return {};
    };
  }

  return function () {
    var _createSpeechRecognit = (0, _SpeechToText.createSpeechRecognitionPonyfillFromRecognizer)({
      createRecognizer: function createRecognizer() {
        return recognizer;
      },
      enableTelemetry: enableTelemetry,
      looseEvents: true,
      textNormalization: textNormalization
    }),
        SpeechGrammarList = _createSpeechRecognit.SpeechGrammarList,
        SpeechRecognition = _createSpeechRecognit.SpeechRecognition;

    if (!audioContext) {
      audioContext = new ponyfill.AudioContext();
    }

    var _createTaskQueue = (0, _createTaskQueue2.default)(),
        cancelAll = _createTaskQueue.cancelAll,
        push = _createTaskQueue.push;

    var SpeechSynthesis = /*#__PURE__*/function (_EventTargetShim) {
      (0, _inherits2.default)(SpeechSynthesis, _EventTargetShim);

      var _super = _createSuper(SpeechSynthesis);

      function SpeechSynthesis() {
        (0, _classCallCheck2.default)(this, SpeechSynthesis);
        return _super.apply(this, arguments);
      }

      (0, _createClass2.default)(SpeechSynthesis, [{
        key: "cancel",
        value: function cancel() {
          cancelAll();
        } // Returns an empty array.
        // Synthesis is done on the bot side, the content of the voice list is not meaningful on the client side.

      }, {
        key: "getVoices",
        value: function getVoices() {
          return [];
        }
      }, {
        key: "speak",
        value: function speak(utterance) {
          var _push = push(function () {
            var controller = new _abortControllerEs.default();
            var signal = controller.signal;
            return {
              abort: controller.abort.bind(controller),
              result: (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {
                return _regenerator.default.wrap(function _callee$(_context) {
                  while (1) {
                    switch (_context.prev = _context.next) {
                      case 0:
                        utterance.dispatchEvent((0, _createCustomEvent.default)('start'));
                        _context.prev = 1;

                        if (!utterance.audioStream) {
                          _context.next = 7;
                          break;
                        }

                        _context.next = 5;
                        return (0, _playCognitiveServicesStream.default)(audioContext, utterance.audioStream, {
                          signal: signal
                        });

                      case 5:
                        _context.next = 9;
                        break;

                      case 7:
                        _context.next = 9;
                        return (0, _playWhiteNoise.default)(audioContext);

                      case 9:
                        _context.next = 15;
                        break;

                      case 11:
                        _context.prev = 11;
                        _context.t0 = _context["catch"](1);

                        if (!(_context.t0.message !== 'aborted')) {
                          _context.next = 15;
                          break;
                        }

                        return _context.abrupt("return", utterance.dispatchEvent((0, _createErrorEvent.default)(_context.t0)));

                      case 15:
                        utterance.dispatchEvent((0, _createCustomEvent.default)('end'));

                      case 16:
                      case "end":
                        return _context.stop();
                    }
                  }
                }, _callee, null, [[1, 11]]);
              }))()
            };
          }),
              result = _push.result; // Catching the error to prevent uncaught promise error due to cancellation.


          result.catch(function (error) {
            if (!/^cancelled/i.test(error.message)) {
              throw error;
            }
          });
        }
      }]);
      return SpeechSynthesis;
    }(_eventTargetShimEs.default);

    (0, _eventTargetShimEs.defineEventAttribute)(SpeechSynthesis, 'voiceschanged');
    return {
      SpeechGrammarList: SpeechGrammarList,
      SpeechRecognition: SpeechRecognition,
      speechSynthesis: new SpeechSynthesis(),
      SpeechSynthesisUtterance: _SpeechSynthesisAudioStreamUtterance.default
    };
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jcmVhdGVXZWJTcGVlY2hQb255ZmlsbEZhY3RvcnkuanMiXSwibmFtZXMiOlsiYXVkaW9Db250ZXh0IiwiZW5hYmxlVGVsZW1ldHJ5IiwicG9ueWZpbGwiLCJBdWRpb0NvbnRleHQiLCJ3aW5kb3ciLCJ3ZWJraXRBdWRpb0NvbnRleHQiLCJyZWNvZ25pemVyIiwidGV4dE5vcm1hbGl6YXRpb24iLCJjb25zb2xlIiwid2FybiIsImNyZWF0ZVJlY29nbml6ZXIiLCJsb29zZUV2ZW50cyIsIlNwZWVjaEdyYW1tYXJMaXN0IiwiU3BlZWNoUmVjb2duaXRpb24iLCJjYW5jZWxBbGwiLCJwdXNoIiwiU3BlZWNoU3ludGhlc2lzIiwidXR0ZXJhbmNlIiwiY29udHJvbGxlciIsIkFib3J0Q29udHJvbGxlciIsInNpZ25hbCIsImFib3J0IiwiYmluZCIsInJlc3VsdCIsImRpc3BhdGNoRXZlbnQiLCJhdWRpb1N0cmVhbSIsIm1lc3NhZ2UiLCJjYXRjaCIsImVycm9yIiwidGVzdCIsIkV2ZW50VGFyZ2V0U2hpbSIsInNwZWVjaFN5bnRoZXNpcyIsIlNwZWVjaFN5bnRoZXNpc1V0dGVyYW5jZSIsIlNwZWVjaFN5bnRoZXNpc0F1ZGlvU3RyZWFtVXR0ZXJhbmNlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7OztBQUVlLHdCQVFaO0FBQUEsTUFQREEsWUFPQyxRQVBEQSxZQU9DO0FBQUEsTUFOREMsZUFNQyxRQU5EQSxlQU1DO0FBQUEsMkJBTERDLFFBS0M7QUFBQSxNQUxEQSxRQUtDLDhCQUxVO0FBQ1RDLElBQUFBLFlBQVksRUFBRUMsTUFBTSxDQUFDRCxZQUFQLElBQXVCQyxNQUFNLENBQUNDO0FBRG5DLEdBS1Y7QUFBQSxNQUZEQyxVQUVDLFFBRkRBLFVBRUM7QUFBQSxNQUREQyxpQkFDQyxRQUREQSxpQkFDQzs7QUFDRCxNQUFJ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QixFQUFqQkEsaUJBRks7QUFHTGtCLE1BQUFBLGVBQWUsRUFBRSxJQUFJZixlQUFKLEVBSFo7QUFJTGdCLE1BQUFBLHdCQUF3QixFQUFFQztBQUpyQixLQUFQO0FBTUQsR0F0RUQ7QUF1RUQiLCJzb3VyY2VSb290IjoiZGlyZWN0bGluZXNwZWVjaDovLy8iLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQgY2xhc3MtbWV0aG9kcy11c2UtdGhpczogW1wiZXJyb3JcIiwgeyBcImV4Y2VwdE1ldGhvZHNcIjogW1wiY2FuY2VsXCIsIFwiZ2V0Vm9pY2VzXCIsIFwic3BlYWtcIl0gfV0gKi9cblxuaW1wb3J0IHsgY3JlYXRlU3BlZWNoUmVjb2duaXRpb25Qb255ZmlsbEZyb21SZWNvZ25pemVyIH0gZnJvbSAnd2ViLXNwZWVjaC1jb2duaXRpdmUtc2VydmljZXMvbGliL1NwZWVjaFNlcnZpY2VzL1NwZWVjaFRvVGV4dCc7XG5cbmltcG9ydCBBYm9ydENvbnRyb2xsZXIgZnJvbSAnYWJvcnQtY29udHJvbGxlci1lczUnO1xuaW1wb3J0IGNyZWF0ZUN1c3RvbUV2ZW50IGZyb20gJy4vY3JlYXRlQ3VzdG9tRXZlbnQnO1xuaW1wb3J0IGNyZWF0ZUVycm9yRXZlbnQgZnJvbSAnLi9jcmVhdGVFcnJvckV2ZW50JztcbmltcG9ydCBjcmVhdGVUYXNrUXVldWUgZnJvbSAnLi9jcmVhdGVUYXNrUXVldWUnO1xuaW1wb3J0IEV2ZW50VGFyZ2V0U2hpbSwgeyBkZWZpbmVFdmVudEF0dHJpYnV0ZSB9IGZyb20gJ2V2ZW50LXRhcmdldC1zaGltLWVzNSc7XG5pbXBvcnQgcGxheUNvZ25pdGl2ZVNlcnZpY2VzU3RyZWFtIGZyb20gJy4vcGxheUNvZ25pdGl2ZVNlcnZpY2VzU3RyZWFtJztcbmltcG9ydCBwbGF5V2hpdGVOb2lzZSBmcm9tICcuL3BsYXlXaGl0ZU5vaXNlJztcbmltcG9ydCBTcGVlY2hTeW50aGVzaXNBdWRpb1N0cmVhbVV0dGVyYW5jZSBmcm9tICcuL1NwZWVjaFN5bnRoZXNpc0F1ZGlvU3RyZWFtVXR0ZXJhbmNlJztcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24oe1xuICBhdWRpb0NvbnRleHQsXG4gIGVuYWJsZVRlbGVtZXRyeSxcbiAgcG9ueWZpbGwgPSB7XG4gICAgQXVkaW9Db250ZXh0OiB3aW5kb3cuQXVkaW9Db250ZXh0IHx8IHdpbmRvdy53ZWJraXRBdWRpb0NvbnRleHRcbiAgfSxcbiAgcmVjb2duaXplcixcbiAgdGV4dE5vcm1hbGl6YXRpb25cbn0pIHtcbiAgaWYgKCFwb255ZmlsbC5BdWRpb0NvbnRleHQpIHtcbiAgICBjb25zb2xlLndhcm4oXG4gICAgICAnYm90ZnJhbWV3b3JrLWRpcmVjdGxpbmVzcGVlY2gtc2RrOiBUaGlzIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBXZWIgQXVkaW8gQVBJLiBTcGVlY2ggc3VwcG9ydCBpcyBkaXNhYmxlZC4nXG4gICAgKTtcblxuICAgIHJldHVybiAoKSA9PiAoe30pO1xuICB9XG5cbiAgcmV0dXJuICgpID0+IHtcbiAgICBjb25zdCB7IFNwZWVjaEdyYW1tYXJMaXN0LCBTcGVlY2hSZWNvZ25pdGlvbiB9ID0gY3JlYXRlU3BlZWNoUmVjb2duaXRpb25Qb255ZmlsbEZyb21SZWNvZ25pemVyKHtcbiAgICAgIGNyZWF0ZVJlY29nbml6ZXI6ICgpID0+IHJlY29nbml6ZXIsXG4gICAgICBlbmFibGVUZWxlbWV0cnksXG4gICAgICBsb29zZUV2ZW50czogdHJ1ZSxcbiAgICAgIHRleHROb3JtYWxpemF0aW9uXG4gICAgfSk7XG5cbiAgICBpZiAoIWF1ZGlvQ29udGV4dCkge1xuICAgICAgYXVkaW9Db250ZXh0ID0gbmV3IHBvbnlmaWxsLkF1ZGlvQ29udGV4dCgpO1xuICAgIH1cblxuICAgIGNvbnN0IHsgY2FuY2VsQWxsLCBwdXNoIH0gPSBjcmVhdGVUYXNrUXVldWUoKTtcblxuICAgIGNsYXNzIFNwZWVjaFN5bnRoZXNpcyBleHRlbmRzIEV2ZW50VGFyZ2V0U2hpbSB7XG4gICAgICBjYW5jZWwoKSB7XG4gICAgICAgIGNhbmNlbEFsbCgpO1xuICAgICAgfVxuXG4gICAgICAvLyBSZXR1cm5zIGFuIGVtcHR5IGFycmF5LlxuICAgICAgLy8gU3ludGhlc2lzIGlzIGRvbmUgb24gdGhlIGJvdCBzaWRlLCB0aGUgY29udGVudCBvZiB0aGUgdm9pY2UgbGlzdCBpcyBub3QgbWVhbmluZ2Z1bCBvbiB0aGUgY2xpZW50IHNpZGUuXG4gICAgICBnZXRWb2ljZXMoKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cblxuICAgICAgc3BlYWsodXR0ZXJhbmNlKSB7XG4gICAgICAgIGNvbnN0IHsgcmVzdWx0IH0gPSBwdXNoKCgpID0+IHtcbiAgICAgICAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xuICAgICAgICAgIGNvbnN0IHsgc2lnbmFsIH0gPSBjb250cm9sbGVyO1xuXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFib3J0OiBjb250cm9sbGVyLmFib3J0LmJpbmQoY29udHJvbGxlciksXG4gICAgICAgICAgICByZXN1bHQ6IChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgIHV0dGVyYW5jZS5kaXNwYXRjaEV2ZW50KGNyZWF0ZUN1c3RvbUV2ZW50KCdzdGFydCcpKTtcblxuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGlmICh1dHRlcmFuY2UuYXVkaW9TdHJlYW0pIHtcbiAgICAgICAgICAgICAgICAgIGF3YWl0IHBsYXlDb2duaXRpdmVTZXJ2aWNlc1N0cmVhbShhdWRpb0NvbnRleHQsIHV0dGVyYW5jZS5hdWRpb1N0cmVhbSwgeyBzaWduYWwgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIGF3YWl0IHBsYXlXaGl0ZU5vaXNlKGF1ZGlvQ29udGV4dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIC8vIEVpdGhlciBkaXNwYXRjaCBcImVuZFwiIG9yIFwiZXJyb3JcIiBldmVudCwgYnV0IG5vdCBib3RoXG4gICAgICAgICAgICAgICAgaWYgKGVycm9yLm1lc3NhZ2UgIT09ICdhYm9ydGVkJykge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIHV0dGVyYW5jZS5kaXNwYXRjaEV2ZW50KGNyZWF0ZUVycm9yRXZlbnQoZXJyb3IpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICB1dHRlcmFuY2UuZGlzcGF0Y2hFdmVudChjcmVhdGVDdXN0b21FdmVudCgnZW5kJykpO1xuICAgICAgICAgICAgfSkoKVxuICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENhdGNoaW5nIHRoZSBlcnJvciB0byBwcmV2ZW50IHVuY2F1Z2h0IHByb21pc2UgZXJyb3IgZHVlIHRvIGNhbmNlbGxhdGlvbi5cbiAgICAgICAgcmVzdWx0LmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICBpZiAoIS9eY2FuY2VsbGVkL2l1LnRlc3QoZXJyb3IubWVzc2FnZSkpIHtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZGVmaW5lRXZlbnRBdHRyaWJ1dGUoU3BlZWNoU3ludGhlc2lzLCAndm9pY2VzY2hhbmdlZCcpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIFNwZWVjaEdyYW1tYXJMaXN0LFxuICAgICAgU3BlZWNoUmVjb2duaXRpb24sXG4gICAgICBzcGVlY2hTeW50aGVzaXM6IG5ldyBTcGVlY2hTeW50aGVzaXMoKSxcbiAgICAgIFNwZWVjaFN5bnRoZXNpc1V0dGVyYW5jZTogU3BlZWNoU3ludGhlc2lzQXVkaW9TdHJlYW1VdHRlcmFuY2VcbiAgICB9O1xuICB9O1xufVxuIl19